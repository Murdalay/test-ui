!function(t,r){"object"==typeof exports?module.exports=r(global):"function"==typeof define&&define.amd?define([],function(){return r(t)}):r(t)}(this,function(t){"use strict";function r(t){return u=t}function n(){return u="undefined"!=typeof Float32Array?Float32Array:Array}var e=1e-6,a={};!function(){if("undefined"!=typeof Float32Array){var t=new Float32Array(1),r=new Int32Array(t.buffer);a.invsqrt=function(n){var e=.5*n;t[0]=n;var a=1.5;r[0]=1597463007-(r[0]>>1);var u=t[0];return u*(a-e*u*u)}}else a.invsqrt=function(t){return 1/Math.sqrt(t)}}();var u=null;n();var i={};i.create=function(t){var r=new u(3);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2]):r[0]=r[1]=r[2]=0,r},i.createFrom=function(t,r,n){var e=new u(3);return e[0]=t,e[1]=r,e[2]=n,e},i.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},i.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e},i.add=function(t,r,n){return n&&t!==n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t)},i.subtract=function(t,r,n){return n&&t!==n?(n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n):(t[0]-=r[0],t[1]-=r[1],t[2]-=r[2],t)},i.multiply=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n):(t[0]*=r[0],t[1]*=r[1],t[2]*=r[2],t)},i.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r},i.scale=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t)},i.normalize=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=Math.sqrt(n*n+e*e+a*a);return u?1===u?(r[0]=n,r[1]=e,r[2]=a,r):(u=1/u,r[0]=n*u,r[1]=e*u,r[2]=a*u,r):(r[0]=0,r[1]=0,r[2]=0,r)},i.cross=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=r[0],o=r[1],c=r[2];return n[0]=a*c-u*o,n[1]=u*i-e*c,n[2]=e*o-a*i,n},i.length=function(t){var r=t[0],n=t[1],e=t[2];return Math.sqrt(r*r+n*n+e*e)},i.squaredLength=function(t){var r=t[0],n=t[1],e=t[2];return r*r+n*n+e*e},i.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]},i.direction=function(t,r,n){n||(n=t);var e=t[0]-r[0],a=t[1]-r[1],u=t[2]-r[2],i=Math.sqrt(e*e+a*a+u*u);return i?(i=1/i,n[0]=e*i,n[1]=a*i,n[2]=u*i,n):(n[0]=0,n[1]=0,n[2]=0,n)},i.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e},i.dist=function(t,r){var n=r[0]-t[0],e=r[1]-t[1],a=r[2]-t[2];return Math.sqrt(n*n+e*e+a*a)};var o=null,c=new u(4);i.unproject=function(t,r,n,e,a){a||(a=t),o||(o=l.create());var u=o,i=c;return i[0]=2*(t[0]-e[0])/e[2]-1,i[1]=2*(t[1]-e[1])/e[3]-1,i[2]=2*t[2]-1,i[3]=1,l.multiply(n,r,u),l.inverse(u)?(l.multiplyVec4(u,i),0===i[3]?null:(a[0]=i[0]/i[3],a[1]=i[1]/i[3],a[2]=i[2]/i[3],a)):null};var f=i.createFrom(1,0,0),s=i.createFrom(0,1,0),v=i.createFrom(0,0,1),M=i.create();i.rotationTo=function(t,r,n){n||(n=m.create());var e=i.dot(t,r),a=M;if(e>=1)m.set(b,n);else if(1e-6-1>e)i.cross(f,t,a),i.length(a)<1e-6&&i.cross(s,t,a),i.length(a)<1e-6&&i.cross(v,t,a),i.normalize(a),m.fromAngleAxis(Math.PI,a,n);else{var u=Math.sqrt(2*(1+e)),o=1/u;i.cross(t,r,a),n[0]=a[0]*o,n[1]=a[1]*o,n[2]=a[2]*o,n[3]=.5*u,m.normalize(n)}return n[3]>1?n[3]=1:n[3]<-1&&(n[3]=-1),n},i.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var h={};h.create=function(t){var r=new u(9);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8]):r[0]=r[1]=r[2]=r[3]=r[4]=r[5]=r[6]=r[7]=r[8]=0,r},h.createFrom=function(t,r,n,e,a,i,o,c,f){var s=new u(9);return s[0]=t,s[1]=r,s[2]=n,s[3]=e,s[4]=a,s[5]=i,s[6]=o,s[7]=c,s[8]=f,s},h.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],u=t[4],i=t[5],o=t[6],c=t[7],f=t[8];return r*(f*u-i*c)+n*(-f*a+i*o)+e*(c*a-u*o)},h.inverse=function(t,r){var n,e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=v*o-c*s,l=-v*i+c*f,m=s*i-o*f,b=e*M+a*l+u*m;return b?(n=1/b,r||(r=h.create()),r[0]=M*n,r[1]=(-v*a+u*s)*n,r[2]=(c*a-u*o)*n,r[3]=l*n,r[4]=(v*e-u*f)*n,r[5]=(-c*e+u*i)*n,r[6]=m*n,r[7]=(-s*e+a*f)*n,r[8]=(o*e-a*i)*n,r):null},h.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=r[0],h=r[1],l=r[2],m=r[3],b=r[4],y=r[5],d=r[6],p=r[7],q=r[8];return n[0]=M*e+h*i+l*f,n[1]=M*a+h*o+l*s,n[2]=M*u+h*c+l*v,n[3]=m*e+b*i+y*f,n[4]=m*a+b*o+y*s,n[5]=m*u+b*c+y*v,n[6]=d*e+p*i+q*f,n[7]=d*a+p*o+q*s,n[8]=d*u+p*c+q*v,n},h.multiplyVec2=function(t,r,n){n||(n=r);var e=r[0],a=r[1];return n[0]=e*t[0]+a*t[3]+t[6],n[1]=e*t[1]+a*t[4]+t[7],n},h.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2];return n[0]=e*t[0]+a*t[3]+u*t[6],n[1]=e*t[1]+a*t[4]+u*t[7],n[2]=e*t[2]+a*t[5]+u*t[8],n},h.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},h.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e&&Math.abs(t[3]-r[3])<e&&Math.abs(t[4]-r[4])<e&&Math.abs(t[5]-r[5])<e&&Math.abs(t[6]-r[6])<e&&Math.abs(t[7]-r[7])<e&&Math.abs(t[8]-r[8])<e},h.identity=function(t){return t||(t=h.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},h.transpose=function(t,r){if(!r||t===r){var n=t[1],e=t[2],a=t[5];return t[1]=t[3],t[2]=t[6],t[3]=n,t[5]=t[7],t[6]=e,t[7]=a,t}return r[0]=t[0],r[1]=t[3],r[2]=t[6],r[3]=t[1],r[4]=t[4],r[5]=t[7],r[6]=t[2],r[7]=t[5],r[8]=t[8],r},h.toMat4=function(t,r){return r||(r=l.create()),r[15]=1,r[14]=0,r[13]=0,r[12]=0,r[11]=0,r[10]=t[8],r[9]=t[7],r[8]=t[6],r[7]=0,r[6]=t[5],r[5]=t[4],r[4]=t[3],r[3]=0,r[2]=t[2],r[1]=t[1],r[0]=t[0],r},h.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"};var l={};l.create=function(t){var r=new u(16);return t&&(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15]),r},l.createFrom=function(t,r,n,e,a,i,o,c,f,s,v,M,h,l,m,b){var y=new u(16);return y[0]=t,y[1]=r,y[2]=n,y[3]=e,y[4]=a,y[5]=i,y[6]=o,y[7]=c,y[8]=f,y[9]=s,y[10]=v,y[11]=M,y[12]=h,y[13]=l,y[14]=m,y[15]=b,y},l.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},l.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e&&Math.abs(t[3]-r[3])<e&&Math.abs(t[4]-r[4])<e&&Math.abs(t[5]-r[5])<e&&Math.abs(t[6]-r[6])<e&&Math.abs(t[7]-r[7])<e&&Math.abs(t[8]-r[8])<e&&Math.abs(t[9]-r[9])<e&&Math.abs(t[10]-r[10])<e&&Math.abs(t[11]-r[11])<e&&Math.abs(t[12]-r[12])<e&&Math.abs(t[13]-r[13])<e&&Math.abs(t[14]-r[14])<e&&Math.abs(t[15]-r[15])<e},l.identity=function(t){return t||(t=l.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},l.transpose=function(t,r){if(!r||t===r){var n=t[1],e=t[2],a=t[3],u=t[6],i=t[7],o=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=n,t[6]=t[9],t[7]=t[13],t[8]=e,t[9]=u,t[11]=t[14],t[12]=a,t[13]=i,t[14]=o,t}return r[0]=t[0],r[1]=t[4],r[2]=t[8],r[3]=t[12],r[4]=t[1],r[5]=t[5],r[6]=t[9],r[7]=t[13],r[8]=t[2],r[9]=t[6],r[10]=t[10],r[11]=t[14],r[12]=t[3],r[13]=t[7],r[14]=t[11],r[15]=t[15],r},l.determinant=function(t){var r=t[0],n=t[1],e=t[2],a=t[3],u=t[4],i=t[5],o=t[6],c=t[7],f=t[8],s=t[9],v=t[10],M=t[11],h=t[12],l=t[13],m=t[14],b=t[15];return h*s*o*a-f*l*o*a-h*i*v*a+u*l*v*a+f*i*m*a-u*s*m*a-h*s*e*c+f*l*e*c+h*n*v*c-r*l*v*c-f*n*m*c+r*s*m*c+h*i*e*M-u*l*e*M-h*n*o*M+r*l*o*M+u*n*m*M-r*i*m*M-f*i*e*b+u*s*e*b+f*n*o*b-r*s*o*b-u*n*v*b+r*i*v*b},l.inverse=function(t,r){r||(r=t);var n,e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],m=t[12],b=t[13],y=t[14],d=t[15],p=e*c-a*o,q=e*f-u*o,A=e*s-i*o,g=a*f-u*c,x=a*s-i*c,w=u*s-i*f,F=v*b-M*m,T=v*y-h*m,R=v*d-l*m,V=M*y-h*b,z=M*d-l*b,I=h*d-l*y,j=p*I-q*z+A*V+g*R-x*T+w*F;return j?(n=1/j,r[0]=(c*I-f*z+s*V)*n,r[1]=(-a*I+u*z-i*V)*n,r[2]=(b*w-y*x+d*g)*n,r[3]=(-M*w+h*x-l*g)*n,r[4]=(-o*I+f*R-s*T)*n,r[5]=(e*I-u*R+i*T)*n,r[6]=(-m*w+y*A-d*q)*n,r[7]=(v*w-h*A+l*q)*n,r[8]=(o*z-c*R+s*F)*n,r[9]=(-e*z+a*R-i*F)*n,r[10]=(m*x-b*A+d*p)*n,r[11]=(-v*x+M*A-l*p)*n,r[12]=(-o*V+c*T-f*F)*n,r[13]=(e*V-a*T+u*F)*n,r[14]=(-m*g+b*q-y*p)*n,r[15]=(v*g-M*q+h*p)*n,r):null},l.toRotationMat=function(t,r){return r||(r=l.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},l.toMat3=function(t,r){return r||(r=h.create()),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[4],r[4]=t[5],r[5]=t[6],r[6]=t[8],r[7]=t[9],r[8]=t[10],r},l.toInverseMat3=function(t,r){var n,e=t[0],a=t[1],u=t[2],i=t[4],o=t[5],c=t[6],f=t[8],s=t[9],v=t[10],M=v*o-c*s,l=-v*i+c*f,m=s*i-o*f,b=e*M+a*l+u*m;return b?(n=1/b,r||(r=h.create()),r[0]=M*n,r[1]=(-v*a+u*s)*n,r[2]=(c*a-u*o)*n,r[3]=l*n,r[4]=(v*e-u*f)*n,r[5]=(-c*e+u*i)*n,r[6]=m*n,r[7]=(-s*e+a*f)*n,r[8]=(o*e-a*i)*n,r):null},l.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],m=t[12],b=t[13],y=t[14],d=t[15],p=r[0],q=r[1],A=r[2],g=r[3];return n[0]=p*e+q*o+A*v+g*m,n[1]=p*a+q*c+A*M+g*b,n[2]=p*u+q*f+A*h+g*y,n[3]=p*i+q*s+A*l+g*d,p=r[4],q=r[5],A=r[6],g=r[7],n[4]=p*e+q*o+A*v+g*m,n[5]=p*a+q*c+A*M+g*b,n[6]=p*u+q*f+A*h+g*y,n[7]=p*i+q*s+A*l+g*d,p=r[8],q=r[9],A=r[10],g=r[11],n[8]=p*e+q*o+A*v+g*m,n[9]=p*a+q*c+A*M+g*b,n[10]=p*u+q*f+A*h+g*y,n[11]=p*i+q*s+A*l+g*d,p=r[12],q=r[13],A=r[14],g=r[15],n[12]=p*e+q*o+A*v+g*m,n[13]=p*a+q*c+A*M+g*b,n[14]=p*u+q*f+A*h+g*y,n[15]=p*i+q*s+A*l+g*d,n},l.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2];return n[0]=t[0]*e+t[4]*a+t[8]*u+t[12],n[1]=t[1]*e+t[5]*a+t[9]*u+t[13],n[2]=t[2]*e+t[6]*a+t[10]*u+t[14],n},l.multiplyVec4=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2],i=r[3];return n[0]=t[0]*e+t[4]*a+t[8]*u+t[12]*i,n[1]=t[1]*e+t[5]*a+t[9]*u+t[13]*i,n[2]=t[2]*e+t[6]*a+t[10]*u+t[14]*i,n[3]=t[3]*e+t[7]*a+t[11]*u+t[15]*i,n},l.translate=function(t,r,n){var e,a,u,i,o,c,f,s,v,M,h,l,m=r[0],b=r[1],y=r[2];return n&&t!==n?(e=t[0],a=t[1],u=t[2],i=t[3],o=t[4],c=t[5],f=t[6],s=t[7],v=t[8],M=t[9],h=t[10],l=t[11],n[0]=e,n[1]=a,n[2]=u,n[3]=i,n[4]=o,n[5]=c,n[6]=f,n[7]=s,n[8]=v,n[9]=M,n[10]=h,n[11]=l,n[12]=e*m+o*b+v*y+t[12],n[13]=a*m+c*b+M*y+t[13],n[14]=u*m+f*b+h*y+t[14],n[15]=i*m+s*b+l*y+t[15],n):(t[12]=t[0]*m+t[4]*b+t[8]*y+t[12],t[13]=t[1]*m+t[5]*b+t[9]*y+t[13],t[14]=t[2]*m+t[6]*b+t[10]*y+t[14],t[15]=t[3]*m+t[7]*b+t[11]*y+t[15],t)},l.scale=function(t,r,n){var e=r[0],a=r[1],u=r[2];return n&&t!==n?(n[0]=t[0]*e,n[1]=t[1]*e,n[2]=t[2]*e,n[3]=t[3]*e,n[4]=t[4]*a,n[5]=t[5]*a,n[6]=t[6]*a,n[7]=t[7]*a,n[8]=t[8]*u,n[9]=t[9]*u,n[10]=t[10]*u,n[11]=t[11]*u,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t[4]*=a,t[5]*=a,t[6]*=a,t[7]*=a,t[8]*=u,t[9]*=u,t[10]*=u,t[11]*=u,t)},l.rotate=function(t,r,n,e){var a,u,i,o,c,f,s,v,M,h,l,m,b,y,d,p,q,A,g,x,w,F,T,R,V=n[0],z=n[1],I=n[2],j=Math.sqrt(V*V+z*z+I*I);return j?(1!==j&&(j=1/j,V*=j,z*=j,I*=j),a=Math.sin(r),u=Math.cos(r),i=1-u,o=t[0],c=t[1],f=t[2],s=t[3],v=t[4],M=t[5],h=t[6],l=t[7],m=t[8],b=t[9],y=t[10],d=t[11],p=V*V*i+u,q=z*V*i+I*a,A=I*V*i-z*a,g=V*z*i-I*a,x=z*z*i+u,w=I*z*i+V*a,F=V*I*i+z*a,T=z*I*i-V*a,R=I*I*i+u,e?t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]):e=t,e[0]=o*p+v*q+m*A,e[1]=c*p+M*q+b*A,e[2]=f*p+h*q+y*A,e[3]=s*p+l*q+d*A,e[4]=o*g+v*x+m*w,e[5]=c*g+M*x+b*w,e[6]=f*g+h*x+y*w,e[7]=s*g+l*x+d*w,e[8]=o*F+v*T+m*R,e[9]=c*F+M*T+b*R,e[10]=f*F+h*T+y*R,e[11]=s*F+l*T+d*R,e):null},l.rotateX=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[4],i=t[5],o=t[6],c=t[7],f=t[8],s=t[9],v=t[10],M=t[11];return n?t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[4]=u*a+f*e,n[5]=i*a+s*e,n[6]=o*a+v*e,n[7]=c*a+M*e,n[8]=u*-e+f*a,n[9]=i*-e+s*a,n[10]=o*-e+v*a,n[11]=c*-e+M*a,n},l.rotateY=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[0],i=t[1],o=t[2],c=t[3],f=t[8],s=t[9],v=t[10],M=t[11];return n?t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*a+f*-e,n[1]=i*a+s*-e,n[2]=o*a+v*-e,n[3]=c*a+M*-e,n[8]=u*e+f*a,n[9]=i*e+s*a,n[10]=o*e+v*a,n[11]=c*e+M*a,n},l.rotateZ=function(t,r,n){var e=Math.sin(r),a=Math.cos(r),u=t[0],i=t[1],o=t[2],c=t[3],f=t[4],s=t[5],v=t[6],M=t[7];return n?t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=u*a+f*e,n[1]=i*a+s*e,n[2]=o*a+v*e,n[3]=c*a+M*e,n[4]=u*-e+f*a,n[5]=i*-e+s*a,n[6]=o*-e+v*a,n[7]=c*-e+M*a,n},l.frustum=function(t,r,n,e,a,u,i){i||(i=l.create());var o=r-t,c=e-n,f=u-a;return i[0]=2*a/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2*a/c,i[6]=0,i[7]=0,i[8]=(r+t)/o,i[9]=(e+n)/c,i[10]=-(u+a)/f,i[11]=-1,i[12]=0,i[13]=0,i[14]=-(u*a*2)/f,i[15]=0,i},l.perspective=function(t,r,n,e,a){var u=n*Math.tan(t*Math.PI/360),i=u*r;return l.frustum(-i,i,-u,u,n,e,a)},l.ortho=function(t,r,n,e,a,u,i){i||(i=l.create());var o=r-t,c=e-n,f=u-a;return i[0]=2/o,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=2/c,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=-2/f,i[11]=0,i[12]=-(t+r)/o,i[13]=-(e+n)/c,i[14]=-(u+a)/f,i[15]=1,i},l.lookAt=function(t,r,n,e){e||(e=l.create());var a,u,i,o,c,f,s,v,M,h,m=t[0],b=t[1],y=t[2],d=n[0],p=n[1],q=n[2],A=r[0],g=r[1],x=r[2];return m===A&&b===g&&y===x?l.identity(e):(s=m-A,v=b-g,M=y-x,h=1/Math.sqrt(s*s+v*v+M*M),s*=h,v*=h,M*=h,a=p*M-q*v,u=q*s-d*M,i=d*v-p*s,h=Math.sqrt(a*a+u*u+i*i),h?(h=1/h,a*=h,u*=h,i*=h):(a=0,u=0,i=0),o=v*i-M*u,c=M*a-s*i,f=s*u-v*a,h=Math.sqrt(o*o+c*c+f*f),h?(h=1/h,o*=h,c*=h,f*=h):(o=0,c=0,f=0),e[0]=a,e[1]=o,e[2]=s,e[3]=0,e[4]=u,e[5]=c,e[6]=v,e[7]=0,e[8]=i,e[9]=f,e[10]=M,e[11]=0,e[12]=-(a*m+u*b+i*y),e[13]=-(o*m+c*b+f*y),e[14]=-(s*m+v*b+M*y),e[15]=1,e)},l.fromRotationTranslation=function(t,r,n){n||(n=l.create());var e=t[0],a=t[1],u=t[2],i=t[3],o=e+e,c=a+a,f=u+u,s=e*o,v=e*c,M=e*f,h=a*c,m=a*f,b=u*f,y=i*o,d=i*c,p=i*f;return n[0]=1-(h+b),n[1]=v+p,n[2]=M-d,n[3]=0,n[4]=v-p,n[5]=1-(s+b),n[6]=m+y,n[7]=0,n[8]=M+d,n[9]=m-y,n[10]=1-(s+h),n[11]=0,n[12]=r[0],n[13]=r[1],n[14]=r[2],n[15]=1,n},l.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"};var m={};m.create=function(t){var r=new u(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):r[0]=r[1]=r[2]=r[3]=0,r},m.createFrom=function(t,r,n,e){var a=new u(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=e,a},m.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},m.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e&&Math.abs(t[3]-r[3])<e},m.identity=function(t){return t||(t=m.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t};var b=m.identity();m.calculateW=function(t,r){var n=t[0],e=t[1],a=t[2];return r&&t!==r?(r[0]=n,r[1]=e,r[2]=a,r[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),r):(t[3]=-Math.sqrt(Math.abs(1-n*n-e*e-a*a)),t)},m.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]},m.inverse=function(t,r){var n=t[0],e=t[1],a=t[2],u=t[3],i=n*n+e*e+a*a+u*u,o=i?1/i:0;return r&&t!==r?(r[0]=-t[0]*o,r[1]=-t[1]*o,r[2]=-t[2]*o,r[3]=t[3]*o,r):(t[0]*=-o,t[1]*=-o,t[2]*=-o,t[3]*=o,t)},m.conjugate=function(t,r){return r&&t!==r?(r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=t[3],r):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},m.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},m.normalize=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=t[3],i=Math.sqrt(n*n+e*e+a*a+u*u);return 0===i?(r[0]=0,r[1]=0,r[2]=0,r[3]=0,r):(i=1/i,r[0]=n*i,r[1]=e*i,r[2]=a*i,r[3]=u*i,r)},m.add=function(t,r,n){return n&&t!==n?(n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n):(t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t[3]+=r[3],t)},m.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=r[0],c=r[1],f=r[2],s=r[3];return n[0]=e*s+i*o+a*f-u*c,n[1]=a*s+i*c+u*o-e*f,n[2]=u*s+i*f+e*c-a*o,n[3]=i*s-e*o-a*c-u*f,n},m.multiplyVec3=function(t,r,n){n||(n=r);var e=r[0],a=r[1],u=r[2],i=t[0],o=t[1],c=t[2],f=t[3],s=f*e+o*u-c*a,v=f*a+c*e-i*u,M=f*u+i*a-o*e,h=-i*e-o*a-c*u;return n[0]=s*f+h*-i+v*-c-M*-o,n[1]=v*f+h*-o+M*-i-s*-c,n[2]=M*f+h*-c+s*-o-v*-i,n},m.scale=function(t,r,n){return n&&t!==n?(n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n):(t[0]*=r,t[1]*=r,t[2]*=r,t[3]*=r,t)},m.toMat3=function(t,r){r||(r=h.create());var n=t[0],e=t[1],a=t[2],u=t[3],i=n+n,o=e+e,c=a+a,f=n*i,s=n*o,v=n*c,M=e*o,l=e*c,m=a*c,b=u*i,y=u*o,d=u*c;return r[0]=1-(M+m),r[1]=s+d,r[2]=v-y,r[3]=s-d,r[4]=1-(f+m),r[5]=l+b,r[6]=v+y,r[7]=l-b,r[8]=1-(f+M),r},m.toMat4=function(t,r){r||(r=l.create());var n=t[0],e=t[1],a=t[2],u=t[3],i=n+n,o=e+e,c=a+a,f=n*i,s=n*o,v=n*c,M=e*o,h=e*c,m=a*c,b=u*i,y=u*o,d=u*c;return r[0]=1-(M+m),r[1]=s+d,r[2]=v-y,r[3]=0,r[4]=s-d,r[5]=1-(f+m),r[6]=h+b,r[7]=0,r[8]=v+y,r[9]=h-b,r[10]=1-(f+M),r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},m.slerp=function(t,r,n,e){e||(e=t);var a,u,i,o,c=t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3];return Math.abs(c)>=1?(e!==t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]),e):(a=Math.acos(c),u=Math.sqrt(1-c*c),Math.abs(u)<.001?(e[0]=.5*t[0]+.5*r[0],e[1]=.5*t[1]+.5*r[1],e[2]=.5*t[2]+.5*r[2],e[3]=.5*t[3]+.5*r[3],e):(i=Math.sin((1-n)*a)/u,o=Math.sin(n*a)/u,e[0]=t[0]*i+r[0]*o,e[1]=t[1]*i+r[1]*o,e[2]=t[2]*i+r[2]*o,e[3]=t[3]*i+r[3]*o,e))},m.fromRotationMatrix=function(t,r){r||(r=m.create());var n,e=t[0]+t[4]+t[8];if(e>0)n=Math.sqrt(e+1),r[3]=.5*n,n=.5/n,r[0]=(t[7]-t[5])*n,r[1]=(t[2]-t[6])*n,r[2]=(t[3]-t[1])*n;else{var a=m.fromRotationMatrix.s_iNext=m.fromRotationMatrix.s_iNext||[1,2,0],u=0;t[4]>t[0]&&(u=1),t[8]>t[3*u+u]&&(u=2);var i=a[u],o=a[i];n=Math.sqrt(t[3*u+u]-t[3*i+i]-t[3*o+o]+1),r[u]=.5*n,n=.5/n,r[3]=(t[3*o+i]-t[3*i+o])*n,r[i]=(t[3*i+u]+t[3*u+i])*n,r[o]=(t[3*o+u]+t[3*u+o])*n}return r},h.toQuat4=m.fromRotationMatrix,function(){var t=h.create();m.fromAxes=function(r,n,e,a){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=e[0],t[4]=e[1],t[7]=e[2],t[2]=r[0],t[5]=r[1],t[8]=r[2],m.fromRotationMatrix(t,a)}}(),m.identity=function(t){return t||(t=m.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},m.fromAngleAxis=function(t,r,n){n||(n=m.create());var e=.5*t,a=Math.sin(e);return n[3]=Math.cos(e),n[0]=a*r[0],n[1]=a*r[1],n[2]=a*r[2],n},m.toAngleAxis=function(t,r){r||(r=t);var n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){r[3]=2*Math.acos(t[3]);var e=a.invsqrt(n);r[0]=t[0]*e,r[1]=t[1]*e,r[2]=t[2]*e}else r[3]=0,r[0]=1,r[1]=0,r[2]=0;return r},m.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var y={};y.create=function(t){var r=new u(2);return t?(r[0]=t[0],r[1]=t[1]):(r[0]=0,r[1]=0),r},y.createFrom=function(t,r){var n=new u(2);return n[0]=t,n[1]=r,n},y.add=function(t,r,n){return n||(n=r),n[0]=t[0]+r[0],n[1]=t[1]+r[1],n},y.subtract=function(t,r,n){return n||(n=r),n[0]=t[0]-r[0],n[1]=t[1]-r[1],n},y.multiply=function(t,r,n){return n||(n=r),n[0]=t[0]*r[0],n[1]=t[1]*r[1],n},y.divide=function(t,r,n){return n||(n=r),n[0]=t[0]/r[0],n[1]=t[1]/r[1],n},y.scale=function(t,r,n){return n||(n=t),n[0]=t[0]*r,n[1]=t[1]*r,n},y.dist=function(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.sqrt(n*n+e*e)},y.set=function(t,r){return r[0]=t[0],r[1]=t[1],r},y.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e},y.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r},y.normalize=function(t,r){r||(r=t);var n=t[0]*t[0]+t[1]*t[1];return n>0?(n=Math.sqrt(n),r[0]=t[0]/n,r[1]=t[1]/n):r[0]=r[1]=0,r},y.cross=function(t,r,n){var e=t[0]*r[1]-t[1]*r[0];return n?(n[0]=n[1]=0,n[2]=e,n):e},y.length=function(t){var r=t[0],n=t[1];return Math.sqrt(r*r+n*n)},y.squaredLength=function(t){var r=t[0],n=t[1];return r*r+n*n},y.dot=function(t,r){return t[0]*r[0]+t[1]*r[1]},y.direction=function(t,r,n){n||(n=t);var e=t[0]-r[0],a=t[1]-r[1],u=e*e+a*a;return u?(u=1/Math.sqrt(u),n[0]=e*u,n[1]=a*u,n):(n[0]=0,n[1]=0,n[2]=0,n)},y.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e},y.str=function(t){return"["+t[0]+", "+t[1]+"]"};var d={};d.create=function(t){var r=new u(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):r[0]=r[1]=r[2]=r[3]=0,r},d.createFrom=function(t,r,n,e){var a=new u(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=e,a},d.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},d.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e&&Math.abs(t[3]-r[3])<e},d.identity=function(t){return t||(t=d.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},d.transpose=function(t,r){if(!r||t===r){var n=t[1];return t[1]=t[2],t[2]=n,t}return r[0]=t[0],r[1]=t[2],r[2]=t[1],r[3]=t[3],r},d.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},d.inverse=function(t,r){r||(r=t);var n=t[0],e=t[1],a=t[2],u=t[3],i=n*u-a*e;return i?(i=1/i,r[0]=u*i,r[1]=-e*i,r[2]=-a*i,r[3]=n*i,r):null},d.multiply=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3];return n[0]=e*r[0]+a*r[2],n[1]=e*r[1]+a*r[3],n[2]=u*r[0]+i*r[2],n[3]=u*r[1]+i*r[3],n},d.rotate=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=Math.sin(r),c=Math.cos(r);return n[0]=e*c+a*o,n[1]=e*-o+a*c,n[2]=u*c+i*o,n[3]=u*-o+i*c,n},d.multiplyVec2=function(t,r,n){n||(n=r);var e=r[0],a=r[1];return n[0]=e*t[0]+a*t[1],n[1]=e*t[2]+a*t[3],n},d.scale=function(t,r,n){n||(n=t);var e=t[0],a=t[1],u=t[2],i=t[3],o=r[0],c=r[1];return n[0]=e*o,n[1]=a*c,n[2]=u*o,n[3]=i*c,n},d.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var p={};return p.create=function(t){var r=new u(4);return t?(r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3]):(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r},p.createFrom=function(t,r,n,e){var a=new u(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=e,a},p.add=function(t,r,n){return n||(n=r),n[0]=t[0]+r[0],n[1]=t[1]+r[1],n[2]=t[2]+r[2],n[3]=t[3]+r[3],n},p.subtract=function(t,r,n){return n||(n=r),n[0]=t[0]-r[0],n[1]=t[1]-r[1],n[2]=t[2]-r[2],n[3]=t[3]-r[3],n},p.multiply=function(t,r,n){return n||(n=r),n[0]=t[0]*r[0],n[1]=t[1]*r[1],n[2]=t[2]*r[2],n[3]=t[3]*r[3],n},p.divide=function(t,r,n){return n||(n=r),n[0]=t[0]/r[0],n[1]=t[1]/r[1],n[2]=t[2]/r[2],n[3]=t[3]/r[3],n},p.scale=function(t,r,n){return n||(n=t),n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[3]=t[3]*r,n},p.set=function(t,r){return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},p.equal=function(t,r){return t===r||Math.abs(t[0]-r[0])<e&&Math.abs(t[1]-r[1])<e&&Math.abs(t[2]-r[2])<e&&Math.abs(t[3]-r[3])<e},p.negate=function(t,r){return r||(r=t),r[0]=-t[0],r[1]=-t[1],r[2]=-t[2],r[3]=-t[3],r},p.length=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return Math.sqrt(r*r+n*n+e*e+a*a)},p.squaredLength=function(t){var r=t[0],n=t[1],e=t[2],a=t[3];return r*r+n*n+e*e+a*a},p.lerp=function(t,r,n,e){return e||(e=t),e[0]=t[0]+n*(r[0]-t[0]),e[1]=t[1]+n*(r[1]-t[1]),e[2]=t[2]+n*(r[2]-t[2]),e[3]=t[3]+n*(r[3]-t[3]),e},p.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"},t&&(t.glMatrixArrayType=u,t.MatrixArray=u,t.setMatrixArrayType=r,t.determineMatrixArrayType=n,t.glMath=a,t.vec2=y,t.vec3=i,t.vec4=p,t.mat2=d,t.mat3=h,t.mat4=l,t.quat4=m),{glMatrixArrayType:u,MatrixArray:u,setMatrixArrayType:r,determineMatrixArrayType:n,glMath:a,vec2:y,vec3:i,vec4:p,mat2:d,mat3:h,mat4:l,quat4:m}});
function clone_recursive(n,e){if(null==n||"object"!=typeof n)return n;if(n.constructor!=Object&&n.constructor!=Array)return n;if(n.constructor==Date||n.constructor==RegExp||n.constructor==Function||n.constructor==String||n.constructor==Number||n.constructor==Boolean)return new n.constructor(n);e=e||new n.constructor;for(var t in n)e[t]="undefined"==typeof e[t]?clone_recursive(n[t],null):e[t];return e}function clone(n){return clone_recursive(n,null)}function make(n){return $(document.createElement(n))}function makeButton(n,e,t){return n=n||"",e=e?' title="'+e+'"':"",t=t?" "+t:"",$('<button class="btn btn-xs'+t+'"'+e+">"+n+"</button>")}function resolve_graph(n,e){for(var t=0,o=n.length;o>t;t++)if(n[t].uid===e)return n[t];return-1!==e&&msg("ERROR: Failed to resolve graph("+e+")"),null}function load_style(n){var e=document.createElement("link");e.rel="stylesheet",e.href=n,document.getElementById("head").appendChild(e)}function sort_dict(n){var e,t=[];for(e in n)t.push(e);return t.sort(function(n,e){var t=n.toLowerCase(),o=e.toLowerCase();return o>t?-1:t>o?1:0}),t}function msg(n){var e=E2.dom.dbg;return void 0===e?void console.log(n):(n&&("ERROR: "===n.substring(0,7)?(console.error(n),e.append('<span style="color:#f20">'+n+"</span>\n")):"WARNING: "===n.substring(0,9)?(console.warn(n),e.append('<span style="color:#fa0">'+n+"</span>\n")):"INFO: "===n.substring(0,6)?(console.log(n),e.append('<span style="color:#04f">'+n+"</span>\n")):(console.log(n),e.append(n+"\n"))),void e.scrollTop(e[0].scrollHeight))}function ExpandableTextfield(n,e,t){var o=this;this.node=n,this.tf=e,this.def_width=t,this.update=function(){""+o.tf.val();o.node.geometry_updated()};var r=function(n){return function(){n.update()}}(this);e.change(r),e.keyup(r)}function load_script(n,e,t){var o=document.createElement("script");if(o.src=n,!e)throw new Error("load_script without listener");o.onload=e,o.onerror=t,document.getElementsByTagName("head")[0].appendChild(o)}window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame}(),Array.prototype.remove=function(n){var e=this.indexOf(n);-1!==e&&this.splice(e,1)};
function Texture(t,e,r){var i=this.gl=t.context;this.renderer=t,this.min_filter=this.mag_filter=r||i.LINEAR,this.wrap_s=this.wrap_t=i.REPEAT,this.texture=e||i.createTexture(),this.width=0,this.height=0,this.image=null,this.complete=!0}function TextureCache(t,e){this.gl=t,this.core=e,this.textures={}}Texture.prototype.create=function(t,e){this.upload(new Image(t,e),"Internal Create")},Texture.prototype.drop=function(){this.gl.deleteTexture(this.texture),this.texture=null},Texture.prototype.load=function(t,e){var r=new Image;r.onload=function(t,e,i){return function(){msg("INFO: Finished loading texture '"+e+"'."),t.upload(r,e),i.asset_tracker.signal_completed()}}(this,t,e),r.onerror=function(t,e,r){return function(){var i=r.renderer.default_tex;msg("ERROR: Failed to load texture '"+e+"'","Renderer"),r.asset_tracker.signal_failed(),t.drop(),t.texture=i.texture,t.width=i.width,t.height=i.height}}(this,t,e),this.complete=!1,e.asset_tracker.signal_started(),r.crossOrigin="Anonymous",r.src=t},Texture.prototype.enable=function(t){var e=this.gl;(e.bound_tex_stage!==t||e.bound_tex!==this.texture)&&(e.activeTexture(t||e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.texture),this.renderer.extensions.set_anisotropy(4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.min_filter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,this.mag_filter),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,this.wrap_s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,this.wrap_t),e.bound_tex_stage=t,e.bound_tex=this.texture)},Texture.prototype.disable=function(){var t=this.gl;t.bindTexture(t.TEXTURE_2D,null)},Texture.prototype.isPow2=function(t){var e=Math.log(t)/Math.log(2),r=Math.floor(e);return e-r===0},Texture.prototype.upload=function(t,e){var r=t.width||t.videoWidth,i=t.height||t.videoHeight;if(!this.isPow2(r))return void msg("ERROR: The width ("+r+") of the texture '"+e+"' is not a power of two.");if(!this.isPow2(i))return void msg("ERROR: The height ("+i+") of the texture '"+e+"' is not a power of two.");var o=this.gl,n=window.devicePixelRatio||1,s=n*r,h=n*i;this.width=s,this.height=h,this.image=t,this.enable(),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,!0),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t),this.disable(),this.complete=!0},Texture.prototype.set_filtering=function(t,e){this.min_filter=t,this.mag_filter=e},TextureCache.prototype.get=function(t){var e=this.textures[t];if(void 0!==e)return msg("INFO: Returning cahed version of texture '"+t+"'."),e.count++,e.texture;var r=new Texture(this.core.renderer);return msg("INFO: Fetching texture '"+t+"'."),r.load(t,this.core),this.textures[t]={count:0,texture:r},r},TextureCache.prototype.clear=function(){this.textures={}},TextureCache.prototype.count=function(){var t=0,e=this.textures;for(var r in e)e.hasOwnProperty(r)&&++t;return t};
function Mesh(e,t,r,i,s,n,a,h){this.gl=e,this.prim_type=t,this.vertex_buffers={},this.index_buffer=null,this.t_cache=r,this.material=new Material,this.vertex_count=0,this.stream_count=0,this.streams_loaded=0,this.max_prims=null,this.instances=a;for(var f in VertexBuffer.vertex_type)this.vertex_buffers[f]=null;if(i){var o=function(e,t,r,i,a){var f=new Image;t=parseFloat(t),r=parseFloat(r),n.signal_started(),f.onload=function(e){return function(){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=f.width,t.height=f.height,r.imageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.globalCompositeOperation="copy",r.drawImage(f,0,0);for(var s=r.getImageData(0,0,f.width,f.height),a=s.width*s.height,o=new DataView(s.data.buffer),u=new ArrayBuffer(a),d=new DataView(u),_=[],l=0,m=0;a>m;l+=4,m++)d.setUint8(m,o.getUint8(l));for(l=0;a>l;l+=4)_.push(d.getFloat32(l,!1));i.bind_data(_),e.vertex_count=a/12,e.streams_loaded++,msg("INFO: Finished loading stream from "+f.src+" with "+a/4+" elements. ("+e.streams_loaded+" / "+e.stream_count+")"),n.signal_completed(),h()}}(a),f.onerror=function(){n.signal_failed()},f.onabort=function(){n.signal_failed()},f.crossOrigin="Anonymous",f.src=s+e+".png"};if(i.vertices&&(this.stream_count++,o(i.vertices,i.v_lo,i.v_rng,this.vertex_buffers.VERTEX=new VertexBuffer(e,VertexBuffer.vertex_type.VERTEX),this)),i.normals&&(this.stream_count++,o(i.normals,i.n_lo,i.n_rng,this.vertex_buffers.NORMAL=new VertexBuffer(e,VertexBuffer.vertex_type.NORMAL),this)),i.uv0&&(this.stream_count++,o(i.uv0,i.uv0_lo,i.uv0_rng,this.vertex_buffers.UV0=new VertexBuffer(e,VertexBuffer.vertex_type.UV0),this)),i.indices){var u=this.index_buffer=new IndexBuffer(e);u.bind_data(i.indices)}}}Mesh.prototype.generate_shader=function(){this.shader=ComposeShader(E2.app.player.core.renderer.shader_cache,this,this.material,null,null,null,null)},Mesh.prototype.get_stride=function(){return[1,2,2,2,3,3,3][this.prim_type]},Mesh.prototype.render=function(e,t,r,i){var s=this.vertex_buffers.VERTEX,r=r||this.shader,n=this.gl,a=i?i:this.material;if(s&&r&&r.linked&&!(this.streams_loaded<this.stream_count)){if(n.bound_mesh!==this||n.bound_shader!==this.shader){r.enable();for(var h in VertexBuffer.vertex_type){var f=this.vertex_buffers[h];f&&f.bind_to_shader(r)}r.bind_camera(e),r.apply_uniforms(this,a),n.bound_shader=r}var o=this.index_buffer?this.index_buffer.count:s.count;if(null!==this.max_prims){var u=this.max_prims*this.get_stride();o>u&&(o=u)}if(this.instances){var d=this.instances,_=mat4.create();if(this.index_buffer){this.index_buffer.enable();for(var l=0,m=d.length;m>l;l++)t.invert?mat4.multiply(d[l],t,_):mat4.multiply(t,d[l],_),r.bind_transform(_),n.drawElements(this.prim_type,o,n.UNSIGNED_SHORT,0)}else for(var l=0,m=d.length;m>l;l++)t.invert?mat4.multiply(d[l],t,_):mat4.multiply(t,d[l],_),r.bind_transform(_),n.drawArrays(this.prim_type,0,o)}else r.bind_transform(t),this.index_buffer?(n.bound_mesh!==this&&this.index_buffer.enable(),n.drawElements(this.prim_type,o,n.UNSIGNED_SHORT,0)):n.drawArrays(this.prim_type,0,o);n.bound_mesh=this}},"undefined"!=typeof module&&(module.exports=Mesh);
function Scene(e,t,r,a){this.gl=e,this.texture_cache=E2.app.player.core.renderer.texture_cache,this.shader_cache=E2.app.player.core.renderer.shader_cache,this.meshes=[],this.materials={},this.id="n/a",this.vertex_count=0,this.core=t,this.bounding_box=null,this.init_bb(),r&&this.load_json(r,a)}Scene.prototype.init_bb=function(e){return e&&e.bounding_box?(e.bounding_box.lo=vec3.create(e.bounding_box.lo),e.bounding_box.hi=vec3.create(e.bounding_box.hi),void(this.bounding_box=e.bounding_box)):void(this.bounding_box={lo:vec3.createFrom(0,0,0),hi:vec3.createFrom(0,0,0)})},Scene.prototype.load_json=function(e,t,r){var a,n=this.gl;this.id=e.id,this.init_bb(e);for(a in e.materials)e.materials.hasOwnProperty(a)&&(this.materials[a]=new Material(n,this.texture_cache,e.materials[a],t));for(a in e.meshes)if(e.meshes.hasOwnProperty(a))for(var s=e.meshes[a],i=0,c=s.batches.length;c>i;i++){var o=s.batches[i],h=new Mesh(n,n.TRIANGLES,this.texture_cache,o,t,this.core.asset_tracker,s.instances,r);h.id=a+"_b"+i,h.material=this.materials[o.material],h.shader=ComposeShader(this.shader_cache,h,h.material,null,null,null,null),this.meshes.push(h),this.vertex_count+=h.vertex_count}},Scene.prototype.render=function(e,t,r,a,n){var s=this.meshes;if(e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.enable(e.DEPTH_TEST),e.depthMask(!0),e.depthFunc(e.LEQUAL),e.enable(e.BLEND),e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),a)for(var i=0,c=s.length;c>i;i++)s[i].render(t,r,a[i],n);else for(var i=0,c=s.length;c>i;i++){var o=s[i];o.render(t,r,o.shader,n)}},Scene.prototype.build_overload_shaders=function(e){for(var t=this.shader_cache,r=this.meshes,a=[],n=0,s=r.length;s>n;n++){var i=r[n],c=t.get(Material.get_caps_hash(i,e));a[n]=c?c:ComposeShader(t,i,e,null,null,null,null)}return a},Scene.prototype.create_autofit_camera=function(){var e=this.bounding_box,t=new Camera;if(!e)return t;var r=E2.app.player.core.renderer.canvas,a=[3*e.hi[0],3*e.hi[1],3*e.hi[2]],n=vec3.create(),s=vec3.create();vec3.subtract(e.hi,e.lo,n);var i=8*Math.sqrt(n[0]*n[0]+n[1]*n[1]+n[2]+n[2]);return vec3.add(e.lo,vec3.scale(n,.5,s),s),a[0]=s[0],msg("INFO: New autofit camera: "+a+" ... "+s[0]+","+s[1]+","+s[2]+" ... "+i),mat4.perspective(45,r.width()/r.height(),1,1+i,t.projection),mat4.lookAt(a,s,vec3.createFrom(0,0,1),t.view),t},Scene.load=function(e,t,r,a){var n=new Scene(e,r,null,null);return r.asset_tracker.signal_started(),$.ajax({url:t,dataType:"json",success:function(e){var s=t.substr(0,t.lastIndexOf("/")+1),i=r.renderer;n.load_json(e,s,a),msg('INFO: Scene - Finished loading assets from "'+s+'". Meshes: '+n.meshes.length+", Shaders: "+n.shader_cache.count()+", Textures: "+n.texture_cache.count()+", Vertices: "+n.vertex_count),msg("INFO: Global cache state: "+i.texture_cache.count()+" textures. "+i.shader_cache.count()+" shaders."),r.asset_tracker.signal_completed()},error:function(e,a,n){msg('ERROR: Failed to load scene "'+t+'": '+a+", "+n,"Renderer"),r.asset_tracker.signal_failed()}}),n};
function Material(e,t,s,l){if(this.t_cache=t,this.depth_test=!0,this.depth_write=!0,this.depth_func=Material.depth_func.LEQUAL,this.alpha_clip=!1,this.shinyness=1,this.double_sided=!1,this.blend_mode=Renderer.blend_mode.NORMAL,this.ambient_color=vec4.createFrom(0,0,0,1),this.diffuse_color=vec4.createFrom(1,1,1,1),this.textures=[null,null,null,null],this.uv_offsets=[null,null,null,null],this.uv_scales=[null,null,null,null],this.lights=[null,null,null,null,null,null,null,null],s){var _=function(e,t){var l=s[t];l&&(e[t]=vec4.createFrom(l[0],l[1],l[2],l[3]))},i=function(e,_,i){var r=s[_];if(r){{var u=r.url;u.length}e.textures[i]=t.get(l+u),r.offset&&(e.uv_offsets[i]=vec2.create(r.offset)),r.scale&&(e.uv_scales[i]=vec2.create(r.scale))}};_(this,"diffuse_color"),_(this,"ambient_color"),i(this,"diffuse_color_map",Material.texture_type.DIFFUSE_COLOR),i(this,"specular_color_map",Material.texture_type.SPECULAR_COLOR),i(this,"emission_color_map",Material.texture_type.EMISSION_COLOR),i(this,"normal_map",Material.texture_type.NORMAL),this.depth_test=s.depth_test?s.depth_test:!0,this.depth_write=s.depth_write?s.depth_write:!0,this.alpha_clip=s.alpha_clip?s.alpha_clip:!1,this.shinyness=s.shinyness?s.shinyness:0,this.double_sided=s.double_sided?!0:!1}}Material.texture_type={DIFFUSE_COLOR:0,SPECULAR_COLOR:1,EMISSION_COLOR:2,NORMAL:3,COUNT:4},Material.depth_func={NEVER:0,LESS:1,EQUAL:2,LEQUAL:3,GREATER:4,NOTEQUAL:5,GEQUAL:6,ALWAYS:7,COUNT:8},Material.prototype.enable=function(){var e=E2.app.player.core.renderer,t=e.context;if(this.depth_test){var s=[t.NEVER,t.LESS,t.EQUAL,t.LEQUAL,t.GREATER,t.NOTEQUAL,t.GEQUAL,t.ALWAYS];t.enable(t.DEPTH_TEST),t.depthFunc(s[this.depth_func])}else t.disable(t.DEPTH_TEST);t.depthMask(this.depth_write),e.set_blend_mode(this.blend_mode)},Material.get_caps_hash=function(e,t){var s="",l=Material.texture_type,_=t?t:e.material;for(var i in VertexBuffer.vertex_type)s+=e&&e.vertex_buffers[i]?"1":"0";s+=_.diffuse_color?"1":"0",s+=_.emission_color?"1":"0",s+=_.specular_color?"1":"0",s+=_.ambient_color?"1":"0",s+=_.alpha_clip?"1":"0";var r=function(e,t){var s="";return s+=e.textures[l.DIFFUSE_COLOR]||(t?t.textures[l.DIFFUSE_COLOR]:void 0)?"1":"0",s+=e.uv_offsets[l.DIFFUSE_COLOR]||(t?t.uv_offsets[l.DIFFUSE_COLOR]:void 0)?"1":"0",s+=e.uv_scales[l.DIFFUSE_COLOR]||(t?t.uv_scales[l.DIFFUSE_COLOR]:void 0)?"1":"0",s+=e.textures[l.SPECULAR_COLOR]||(t?t.textures[l.SPECULAR_COLOR]:void 0)?"1":"0",s+=e.uv_offsets[l.SPECULAR_COLOR]||(t?t.uv_offsets[l.SPECULAR_COLOR]:void 0)?"1":"0",s+=e.uv_scales[l.SPECULAR_COLOR]||(t?t.uv_scales[l.SPECULAR_COLOR]:void 0)?"1":"0",s+=e.textures[l.EMISSION_COLOR]||(t?t.textures[l.EMISSION_COLOR]:void 0)?"1":"0",s+=e.uv_offsets[l.EMISSION_COLOR]||(t?t.uv_offsets[l.EMISSION_COLOR]:void 0)?"1":"0",s+=e.uv_scales[l.EMISSION_COLOR]||(t?t.uv_scales[l.EMISSION_COLOR]:void 0)?"1":"0",s+=e.textures[l.NORMAL_COLOR]||(t?t.textures[l.NORMAL_COLOR]:void 0)?"1":"0",s+=e.uv_offsets[l.NORMAL_COLOR]||(t?t.uv_offsets[l.NORMAL_COLOR]:void 0)?"1":"0",s+=e.uv_scales[l.NORMAL_COLOR]||(t?t.uv_scales[l.NORMAL_COLOR]:void 0)?"1":"0"};s+=t?r(t,e?e.material:null):r(_,null);for(var u=0;8>u;u++)s+=_.lights[u]?_.lights[u].type===Light.type.POINT?"2":"1":"0";return s},"undefined"!=typeof module&&(module.exports=Material);
function Extensions(e){this.gl=e,this.max_anisotropy=0,this.anisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.anisotropic&&(this.max_anisotropy=e.getParameter(this.anisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}function Renderer(e,t,r){this.vr_hmd=e[0],this.vr_sensor=e[1],this.canvas_id=t,this.canvas=$(t),this.framebuffer_stack=[],this.def_ambient=vec4.createFrom(0,0,0,1),this.def_diffuse=vec4.createFrom(1,1,1,1),this.def_specular=vec4.createFrom(1,1,1,1),this.up_vec=vec3.createFrom(0,0,1),this.fs_listeners=[],this._listeners={},this.org_width=this.canvas.width(),this.org_height=this.canvas.height(),this.screenshot={pending:!1,width:512,height:256,framebuffer:null,renderbuffer:null,texture:null,pixels:null};try{var n={alpha:!1,preserveDrawingBuffer:!1,antialias:!0};this.context=this.canvas[0].getContext("webgl",n),this.context||(this.context=this.canvas[0].getContext("experimental-webgl",n))}catch(i){this.context=null}!this.context,this.extensions=new Extensions(this.context),this.texture_cache=new TextureCache(this.context,r),this.shader_cache=new ShaderCache(this.context),this.fullscreen=!1,this.default_tex=new Texture(this);var s="vizor.io";("undefined"===s||"vizor.io"===s)&&(s="vizor.io"),this.default_tex.load("//"+s+"/images/no_texture.png",r),document.addEventListener("fullscreenchange",this.on_fullscreen_change.bind(this)),document.addEventListener("webkitfullscreenchange",this.on_fullscreen_change.bind(this)),document.addEventListener("mozfullscreenchange",this.on_fullscreen_change.bind(this)),this.camera_screenspace=new Camera(this.context),this.light_default=new Light,this.material_default=new Material,this.color_white=vec4.createFrom(1,1,1,1),this.color_black=vec4.createFrom(0,0,0,1),this.vector_origin=vec3.createFrom(0,0,0),this.vector_unity=vec3.createFrom(1,1,1),this.matrix_identity=mat4.create(),mat4.identity(this.matrix_identity)}function VertexBuffer(e,t){this.gl=e,this.type=t,this.buffer=e.createBuffer(),this.count=0}function IndexBuffer(e){this.gl=e,this.buffer=e.createBuffer(),this.count=0}function Light(){this.type=Light.type.POINT,this.diffuse_color=vec4.createFrom(1,1,1,1),this.specular_color=vec4.createFrom(1,1,1,1),this.position=vec3.createFrom(0,1,0),this.direction=vec3.createFrom(0,-1,0),this.intensity=1}function Camera(){this.projection=mat4.create(),this.view=mat4.create(),mat4.identity(this.projection),mat4.identity(this.view)}Extensions.prototype.set_anisotropy=function(){this.anisotropic&&this.max_anisotropy>0&&this.gl.texParameterf(this.gl.TEXTURE_2D,this.anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this.max_anisotropy)},Renderer.prototype.on=function(e,t){t&&(this._listeners[e]||(this._listeners[e]=[]),this._listeners[e].push(t))},Renderer.prototype.off=function(e,t){this._listeners[e]=this._listeners.filter(function(e){return e!==t})},Renderer.prototype.emit=function(e){this._listeners[e]&&this._listeners[e].forEach(function(e){e()})},Renderer.blend_mode={NONE:0,ADDITIVE:1,SUBTRACTIVE:2,MULTIPLY:3,NORMAL:4},Renderer.prototype.begin_frame=function(){var e=this.context;if(e){e.clearColor(0,0,0,1),e.clearDepth(1),e.enable(e.CULL_FACE),e.cullFace(e.BACK),e.bound_tex=null,e.bound_tex_stage=null,e.bound_mesh=null,e.bound_shader=null;var t=this.screenshot;if(t.pending){var r=(t.framebuffer=e.glCreateFramebuffer(),e.glCreateTexture());e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,null);var n=this.screenshot.renderbuffer=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,n),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,t.width,t.height),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,n),e.bindRenderbuffer(e.RENDERBUFFER,null),e.bindTexture(e.TEXTURE_2D,null),e.viewport(0,0,t.width,t.height),t.texture=new Texture(e,r,e.LINEAR)}e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}},Renderer.prototype.end_frame=function(){var e=this.context;if(e){e.flush();var t=this.screenshot;if(t.pending){var r=this.canvas[0];e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,r.width,r.height);var n=new Uint8Array(t.width*t.height*4);e.readPixels(0,0,w,h,e.RGBA,e.UNSIGNED_BYTE,this.img_data),e.deleteFramebuffer(t.framebuffer),e.deleteRenderbuffer(t.renderbuffer),t.texture.drop(),t.framebuffer=null,t.renderbuffer=null,t.texture=null,t.pending=!1;for(var i=t.pixels=new Uint8Array(t.width*t.height*3),s=0,a=0;w*h*3>s;s+=3,a+=4)i[s]=n[a],i[s+1]=n[a+1],i[s+2]=n[a+2]}}},Renderer.prototype.push_framebuffer=function(e,t,r){var n=this.context;n.viewport(0,0,t,r),n.bindFramebuffer(n.FRAMEBUFFER,e),this.framebuffer_stack.push([e,t,r])},Renderer.prototype.pop_framebuffer=function(){var e=this.framebuffer_stack,t=this.context;if(e.pop(),e.length>0){var r=e[e.length-1];t.bindFramebuffer(t.FRAMEBUFFER,r[0]),t.viewport(0,0,r[1],r[2])}else{var n=this.canvas[0];t.bindFramebuffer(t.FRAMEBUFFER,null),t.viewport(0,0,n.width,n.height)}},Renderer.prototype.add_fs_listener=function(e){-1===this.fs_listeners.indexOf(e)&&this.fs_listeners.push(e)},Renderer.prototype.remove_fs_listener=function(e){var t=this.fs_listeners.indexOf(e);-1!==t&&this.fs_listeners.splice(t,1)},Renderer.prototype.on_fullscreen_change=function(){var e=E2.dom.webgl_canvas;this.fullscreen?(this.fullscreen=!1,e.removeClass("webgl-canvas-fs"),e.addClass("webgl-canvas-normal")):(this.fullscreen=!0,e.removeClass("webgl-canvas-normal"),e.addClass("webgl-canvas-fs")),this.update_viewport(),this.fs_listeners.forEach(function(e){e(this.fullscreen)})},Renderer.prototype.set_fullscreen=function(e){var t=E2.dom.webgl_canvas,r=t[0];if(e){if(!this.fullscreen){if(this.vr_hmd){var n={vrDisplay:this.vr_hmd};r.requestFullscreen&&r.requestFullscreen(n),r.webkitRequestFullscreen?r.webkitRequestFullscreen(n):r.mozRequestFullScreen&&r.mozRequestFullScreen(n)}else r.requestFullscreen&&r.requestFullscreen(),r.webkitRequestFullScreen?r.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):r.mozRequestFullScreen&&r.mozRequestFullScreen();t.removeClass("webgl-canvas-normal"),t.addClass("webgl-canvas-fs")}}else this.fullscreen&&(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())},Renderer.prototype.update_viewport=function(){var e,t=this.canvas[0],r=this;e=E2.app&&"function"==typeof E2.app.calculateCanvasArea?E2.app.calculateCanvasArea():{width:this.org_width,height:this.org_height};var n=e.width,i=e.height;r.fullscreen&&(E2.app&&"function"==typeof E2.app.calculateCanvasArea?(n=screen.width,i=screen.height):(n=$(window).width(),i=$(window).height()));window.devicePixelRatio||1;t.width=n,t.height=i,r.canvas.css("width",n),r.canvas.css("height",i),r.org_width=n,r.org_height=i,r.context.viewport(0,0,n,i),r.emit("resize")},Renderer.prototype.set_depth_enable=function(e){var t=this.context;return e?(t.enable(t.DEPTH_TEST),t.depthMask(!0),void t.depthFunc(t.LEQUAL)):(t.disable(t.DEPTH_TEST),void t.depthMask(!1))},Renderer.prototype.set_blend_mode=function(e){var t=this.context,r=Renderer.blend_mode;switch(e){case r.NONE:t.disable(t.BLEND);break;case r.ADDITIVE:t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.SRC_ALPHA,t.ONE);break;case r.SUBTRACTIVE:t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.ONE_MINUS_SRC_COLOR);break;case r.MULTIPLY:t.enable(t.BLEND),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:t.enable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}},VertexBuffer.vertex_type={VERTEX:0,NORMAL:1,COLOR:2,UV0:3,UV1:4,UV2:5,UV3:6},VertexBuffer.type_stride=[3,3,4,2,2,2,2],VertexBuffer.prototype.enable=function(){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,this.buffer)},VertexBuffer.prototype.bind_data=function(e,t){var r=this.gl;this.count=("[object ArrayBuffer]"===e.toString()?e.byteLength/4:e.length)/VertexBuffer.type_stride[this.type],this.enable(),r.bufferData(r.ARRAY_BUFFER,new Float32Array(e),"undefined"!=typeof t?t:r.STATIC_DRAW)},VertexBuffer.prototype.bind_to_shader=function(e){e.bind_array(this.type,this.buffer,VertexBuffer.type_stride[this.type])},IndexBuffer.prototype.enable=function(){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.buffer)},IndexBuffer.prototype.bind_data=function(e){var t=this.gl;this.count=e.length,this.enable(),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW)},Light.type={POINT:0,DIRECTIONAL:1,COUNT:2},"undefined"!=typeof module&&(module.exports.VertexBuffer=VertexBuffer,module.exports.IndexBuffer=IndexBuffer);
function ComposeShader(r,t,e,i,a,o,s,n,_){var l=E2.app.player.core.renderer.context,h=[],c=VertexBuffer.vertex_type,f=!1,v=e?e.lights:t.material.lights,u=Material.texture_type;for(var p in c){var m=c[p];h[m]=null!==t.vertex_buffers[p]}var d=[null,""],g=null;if(r){var y=Material.get_caps_hash(t,e);(i||a||o||s)&&(y+="_"+Math.floor(128e3*Math.random())),d=[r.get(y),y]}if(d[0])g=d[0];else{var x=l.createProgram();g=new ShaderProgram(l,x),g.apply_uniforms_custom=null,g.streams=h,g.material=e;var R=e?e:t.material,E=g.get_all_params(e,t.material,u.DIFFUSE_COLOR),b=g.get_all_params(e,t.material,u.SPECULAR_COLOR),S=g.get_all_params(e,t.material,u.NORMAL),L=g.get_all_params(e,t.material,u.EMISSION_COLOR),O=[],A=[],T=[],P=[],C=function(r){O.push(r),T.push(r)},U=function(r){A.push(r),P.push(r)};if(O.push("precision lowp float;"),O.push("attribute vec3 v_pos;"),h[c.COLOR]&&O.push("attribute vec4 v_col;"),h[c.NORMAL]&&O.push("attribute vec3 v_norm;"),h[c.UV0]&&O.push("attribute vec2 v_uv0;"),O.push("uniform vec4 d_col;"),O.push("uniform mat4 m_mat;"),O.push("uniform mat4 v_mat;"),O.push("uniform mat4 p_mat;"),O.push("varying vec4 f_col;"),i&&(O=O.concat(i)),A.push("precision lowp float;"),A.push("uniform vec4 a_col;"),A.push("varying vec4 f_col;"),a&&(A=A.concat(a)),h[c.NORMAL]){O.push("uniform mat3 n_mat;"),O.push("varying vec3 f_norm;"),A.push("varying vec3 f_norm;");for(var I=0;8>I;I++){var M=v[I];if(M){var V="l"+I;O.push("uniform vec3 "+V+"_pos;"),A.push("uniform vec3 "+V+"_pos;"),A.push("uniform vec4 "+V+"_d_col;"),A.push("uniform vec4 "+V+"_s_col;"),A.push("uniform float "+V+"_power;"),O.push("varying vec3 "+V+"_v2l;"),A.push("varying vec3 "+V+"_v2l;"),M.type===Light.type.DIRECTIONAL&&(O.push("uniform vec3 "+V+"_dir;"),A.push("uniform vec3 "+V+"_dir;")),f=!0}}f&&(O.push("varying vec3 eye_pos;"),A.push("uniform mat4 v_mat;"),A.push("varying vec3 eye_pos;"),A.push("uniform vec4 s_col;"),A.push("uniform float shinyness;"))}if(h[c.UV0]){O.push("varying vec2 f_uv0;"),A.push("varying vec2 f_uv0;");var w=function(r,t){r&&(A.push("uniform sampler2D "+t+"_tex;"),O.push("uniform sampler2D "+t+"_tex;"),r[1]&&A.push("uniform vec2 "+t+"_ofs;"),r[2]&&A.push("uniform vec2 "+t+"_scl;"))};w(E,"d"),w(b,"s"),w(S,"n"),w(L,"e")}var D=function(r,t,e){var i="f_uv"+r;return e[2]&&(i="("+i+" * "+t+"_scl)"),e[1]&&(i+=" + "+t+"_ofs"),i};if(o)C(o);else{if(C("void main(void) {"),C("    vec4 tp = m_mat * vec4(v_pos, 1.0);\n"),C("    gl_Position = p_mat * v_mat * tp;"),f){for(var I=0;8>I;I++){var M=v[I];if(M){var V="l"+I;C(M.type===Light.type.DIRECTIONAL?"    "+V+"_v2l = "+V+"_dir;":"    "+V+"_v2l = "+V+"_pos - tp.xyz;")}}C("    eye_pos = normalize(tp.xyz);")}C(h[c.COLOR]?"    f_col = d_col * v_col;":"    f_col = d_col;"),h[c.NORMAL]&&C("    f_norm = normalize(n_mat * v_norm);"),h[c.UV0]&&C("    f_uv0 = v_uv0;"),C("}")}if(s)U(s);else{if(U("void main(void) {"),U(f?"    vec4 fc = vec4(0.0, 0.0, 0.0, f_col.a);":"    vec4 fc = f_col;"),h[c.NORMAL]&&f){U(h[c.UV0]&&S?"    vec3 n_dir = normalize(f_norm * -(texture2D(n_tex, "+D(0,"n",S)+").rgb - 0.5 * 2.0));":"    vec3 n_dir = normalize(f_norm);");for(var I=0;8>I;I++){var M=v[I];if(M){var V="l"+I,N=V+"_v2l_n";U("    vec3 "+N+" = normalize("+V+"_v2l);"),U("    float "+V+"_dd = max(0.0, dot(n_dir, "+N+"));"),U("    float "+V+"_spec_fac = pow(max(0.0, dot(reflect(-"+N+", n_dir), eye_pos)), shinyness + 1.0);"),U("\n    fc.rgb += "+V+"_d_col.rgb * "+V+"_dd * "+V+"_power;");var k="    fc.rgb += shinyness * "+V+"_power * ";k+=V+"_s_col.rgb * s_col.rgb * "+V+"_spec_fac",h[c.UV0]&&b&&(k+=" * texture2D(s_tex, "+D(0,"s",b)+").rgb"),U(k+";\n")}}}f&&U("    fc.rgb *= f_col.rgb;"),h[c.UV0]&&(E&&U("    fc *= texture2D(d_tex, "+D(0,"d",E)+");"),L&&(U("    vec4 ec = texture2D(e_tex, "+D(0,"e",L)+");"),U("    fc.rgb += ec.rgb * ec.a;"))),U("    fc.rgb += a_col.rgb;\n"),R.alpha_clip&&U("    if(fc.a < 0.5)\n        discard;\n"),U("    gl_FragColor = fc;"),U("}")}g.vs_src=O.join("\n"),g.ps_src=A.join("\n"),g.vs_c_src=T.join("\n"),g.ps_c_src=P.join("\n");var X=new Shader(l,l.VERTEX_SHADER,g.vs_src,O.length,n),F=new Shader(l,l.FRAGMENT_SHADER,g.ps_src,A.length,_),z=X.compiled&&F.compiled,j=function(r){var t=l.getAttribLocation(x,r);return 0>t?void 0:t},B=function(r){var t=l.getUniformLocation(x,r);return t};if(z){if(g.attach(X),g.attach(F),g.link(),h[c.VERTEX]&&(g.v_pos=j("v_pos")),h[c.NORMAL]&&(g.v_norm=j("v_norm")),g.m_mat=B("m_mat"),g.v_mat=B("v_mat"),g.p_mat=B("p_mat"),g.a_col=B("a_col"),g.d_col=B("d_col"),f){g.s_col=B("s_col"),g.shinyness=B("shinyness"),g.n_mat=B("n_mat");for(var I=0;8>I;I++){var M=v[I];if(M){var V="l"+I;g[V+"_pos"]=B(V+"_pos"),g[V+"_d_col"]=B(V+"_d_col"),g[V+"_s_col"]=B(V+"_s_col"),g[V+"_power"]=B(V+"_power"),M.type===Light.type.DIRECTIONAL&&(g[V+"_dir"]=B(V+"_dir"))}}}if(h[c.COLOR]&&(g.v_col=j("v_col")),h[c.UV0]){g.v_uv0=j("v_uv0");var H=function(r,t,e){e&&(r[t+"_tex"]=B(t+"_tex"),e[1]&&(r[t+"_ofs"]=B(t+"_ofs")),e[2]&&(r[t+"_scl"]=B(t+"_scl")))};H(g,"d",E),H(g,"s",b),H(g,"n",S),H(g,"e",L)}}g.bind_array=function(r,t,e){var i=VertexBuffer.vertex_type,a=void 0;r===i.VERTEX?a=this.v_pos:r===i.UV0?a=this.v_uv0:r===i.NORMAL?a=this.v_norm:r===i.COLOR&&(a=this.v_col),void 0!==a&&(l.bindBuffer(l.ARRAY_BUFFER,t),l.enableVertexAttribArray(a),l.vertexAttribPointer(a,e,l.FLOAT,!1,0,0))},g.apply_uniforms=z?function(r,t){var e=E2.app.player.core.renderer,i=t?t:r.material;l.enableVertexAttribArray(this.v_pos),l.uniform4fv(this.a_col,i.ambient_color?i.ambient_color:e.def_ambient),l.uniform4fv(this.d_col,i.diffuse_color?i.diffuse_color:e.def_diffuse),void 0!==this.s_col&&l.uniform4fv(this.s_col,i.specular_color?i.specular_color:e.def_specular),void 0!==this.shinyness&&l.uniform1f(this.shinyness,i.shinyness);for(var a=0;8>a;a++){var o=v[a];if(o){var s="l"+a;l.uniform3fv(this[s+"_pos"],o.position),l.uniform4fv(this[s+"_d_col"],o.diffuse_color),l.uniform4fv(this[s+"_s_col"],o.specular_color),l.uniform1f(this[s+"_power"],o.intensity),o.type===Light.type.DIRECTIONAL&&l.uniform3fv(this[s+"_dir"],o.direction)}}if(void 0!==this.v_norm&&l.enableVertexAttribArray(this.v_norm),void 0!==this.v_uv0){var n=r.material,_=this.get_all_params(t,n,u.DIFFUSE_COLOR),h=this.get_all_params(t,n,u.SPECULAR_COLOR),c=this.get_all_params(t,n,u.NORMAL),f=this.get_all_params(t,n,u.EMISSION_COLOR),p=function(r){l.activeTexture(r),l.bindTexture(l.TEXTURE_2D,null)};l.enableVertexAttribArray(this.v_uv0),_&&void 0!==this.d_tex?g.bind_tex(this.d_tex,this.d_ofs,this.d_scl,0,l.TEXTURE0,_,e.default_tex):p(l.TEXTURE0),h&&void 0!==this.s_tex?g.bind_tex(this.s_tex,this.s_ofs,this.s_scl,1,l.TEXTURE1,h,e.default_tex):p(l.TEXTURE1),c&&void 0!==this.n_tex?g.bind_tex(this.n_tex,this.n_ofs,this.n_scl,2,l.TEXTURE2,c,e.default_tex):p(l.TEXTURE2),f&&void 0!==this.e_tex?g.bind_tex(this.e_tex,this.e_ofs,this.e_scl,3,l.TEXTURE3,f,e.default_tex):p(l.TEXTURE3)}this.apply_uniforms_custom&&this.apply_uniforms_custom(),i.double_sided?l.disable(l.CULL_FACE):l.enable(l.CULL_FACE),i.enable()}:function(){},r&&r.set_shader(d[1],g)}return g}function ShaderCache(){this.shaders={}}function Shader(r,t,e,i,a){this.shader=r.createShader(t),this.compiled=!1,this.linked=!1,this.compile_info="",this.link_info="",a=a||function(){};try{r.shaderSource(this.shader,e)}catch(o){return msg("ERROR: Shader source invalid: "+o),a({row:1,text:"Shader source invalid: "+o})}r.compileShader(this.shader);var s=r.getShaderParameter(this.shader,r.COMPILE_STATUS);if(s)this.compiled=!0,a();else{var n=r.getShaderInfoLog(this.shader),_=n.split("\n"),l=e.split("\n");this.compile_info=n,msg("ERROR: Shader compilation failed:\n");var h=[];_.forEach(function(r){if(r){var t=r.split(/ERROR\: \d+\:(\d+): (.*)/),e={row:parseInt(t[1],10)-i,text:r,type:"error"};msg(e.row+"\n	>>> "+l[e.row]),h.push(e)}}),a(h)}}function ShaderProgram(r,t){this.gl=r,this.program=t||r.createProgram(),this.n_mat=null}ShaderCache.prototype.get=function(r){return r in this.shaders?this.shaders[r]:null},ShaderCache.prototype.count=function(){var r=0;for(p in this.shaders)++r;return r},ShaderCache.prototype.set_shader=function(r,t){this.shaders[r]=t},ShaderCache.prototype.clear=function(){this.shaders={}},ShaderProgram.prototype.attach=function(r){this.gl.attachShader(this.program,r.shader)},ShaderProgram.prototype.link=function(){var r=this.gl,t=this.program;r.linkProgram(t),this.linked=!0,this.link_info="",r.getProgramParameter(t,r.LINK_STATUS)||(msg("ERROR: Shader linking failed:\n"+r.getProgramInfoLog(t)),this.link_info+=r.getProgramInfoLog(t),this.linked=!1),r.validateProgram(t),r.getProgramParameter(t,r.VALIDATE_STATUS)||(msg("ERROR: Shader validation failed:\n"+r.getProgramInfoLog(t)),this.link_info+=r.getProgramInfoLog(t),this.linked=!1)},ShaderProgram.prototype.enable=function(){this.gl.useProgram(this.program)},ShaderProgram.prototype.bind_camera=function(r){var t=this.gl;t.uniformMatrix4fv(this.v_mat,!1,r.view),t.uniformMatrix4fv(this.p_mat,!1,r.projection)},ShaderProgram.prototype.bind_transform=function(r){var t=this.gl;if(t.uniformMatrix4fv(this.m_mat,!1,r),this.n_mat){var e=mat3.create();mat4.toInverseMat3(r,e),mat3.transpose(e),t.uniformMatrix3fv(this.n_mat,!1,e)}},ShaderProgram.prototype.get_tex_param=function(r,t,e,i){return(r?r[e][i]:void 0)||(t?t[e][i]:void 0)},ShaderProgram.prototype.get_all_params=function(r,t,e){var i=this.get_tex_param(r,t,"textures",e);return i?[i,this.get_tex_param(r,t,"uv_offsets",e),this.get_tex_param(r,t,"uv_scales",e)]:null},ShaderProgram.prototype.bind_tex=function(r,t,e,i,a,o,s){var n=o[0].complete?o[0]:s,_=this.gl;_.uniform1i(r,i),o[1]&&_.uniform2f(t,o[1][0],o[1][1]),o[2]&&_.uniform2f(e,o[2][0],o[2][1]),n.enable(a)};
function ConnectionUI(t){this.src_pos=[0,0],this.dst_pos=[0,0],this.src_slot_div=null,this.dst_slot_div=null,this.flow=!1,this.selected=!1,this.deleting=!1,this.parent_conn=t,this.color="#000"}function Connection(t,n,s,i,o){this.src_node=t,this.dst_node=n,this.src_slot=s,this.dst_slot=i,this.ui=null,this.uid=E2.uid(),this.offset=o||0}ConnectionUI.prototype.resolve_slot_divs=function(){var t=this.parent_conn;this.src_slot_div=t.src_node.ui.dom.find("#n"+t.src_node.uid+(void 0!==t.src_slot.uid?"do"+t.src_slot.uid:"so"+t.src_slot.index)),this.dst_slot_div=t.dst_node.ui.dom.find("#n"+t.dst_node.uid+(void 0!==t.dst_slot.uid?"di"+t.dst_slot.uid:"si"+t.dst_slot.index)),E2.app.redrawConnection(t)},Connection.prototype.create_ui=function(){return this.ui=new ConnectionUI(this),this.ui},Connection.prototype.destroy_ui=function(){this.ui=null},Connection.prototype.reset=function(){this.ui&&this.ui.flow&&(this.ui.flow=!1,this.ui.color="#000")},Connection.prototype.r_update_inbound=function(t){if(t.queued_update=1,"input_proxy"!==t.plugin.id)for(var n=0,s=t.inputs.length;s>n;n++)this.r_update_inbound(t.inputs[n].src_node);else{var i=t.parent_graph.plugin;i&&i.parent_node.queued_update<0&&i.state.enabled&&this.r_update_inbound(i.parent_node)}},Connection.prototype.r_update_outbound=function(t){if(t.queued_update=1,"output_proxy"!==t.plugin.id)for(var n=0,s=t.outputs.length;s>n;n++)this.r_update_outbound(t.outputs[n].dst_node);else{var i=t.parent_graph.plugin;i&&i.parent_node.queued_update<0&&i.state.enabled&&this.r_update_outbound(i.parent_node)}},Connection.prototype.signal_change=function(t){var n=this.src_node;n.plugin.connection_changed&&(n.plugin.connection_changed(t,this,this.src_slot),n.plugin.reset&&n.plugin.reset()),n=this.dst_node,n.inputs_changed=!0,!t&&n.plugin.update_input&&(void 0===this.dst_slot.uid?void 0!==this.dst_slot.def&&(n.plugin.update_input(this.dst_slot,clone(this.dst_slot.def)),n.plugin.updated=!0):(n.plugin.update_input(this.dst_slot,E2.app.player.core.get_default_value(this.dst_slot.dt)),n.plugin.updated=!0)),n.plugin.connection_changed&&(n.plugin.connection_changed(t,this,this.dst_slot),n.plugin.updated=!0),t&&(this.r_update_inbound(n),this.r_update_outbound(n))},Connection.prototype.serialise=function(){var t={};return t.src_nuid=this.src_node.uid,t.dst_nuid=this.dst_node.uid,t.src_slot=this.src_slot.index,t.dst_slot=this.dst_slot.index,t.uid=this.uid,t.src_connected=this.src_slot.is_connected,t.dst_connected=this.dst_slot.is_connected,void 0!==this.src_slot.uid&&(t.src_dyn=!0),void 0!==this.dst_slot.uid&&(t.dst_dyn=!0),0!==this.offset&&(t.offset=this.offset),t},Connection.prototype.deserialise=function(t){this.src_node=""+t.src_nuid,this.dst_node=""+t.dst_nuid,this.src_node===this.dst_node,this.uid=t.uid||E2.uid(),this.src_slot={index:t.src_slot,dynamic:t.src_dyn?!0:!1,is_connected:t.src_connected},this.dst_slot={index:t.dst_slot,dynamic:t.dst_dyn?!0:!1,is_connected:t.dst_connected},this.offset=t.offset?t.offset:0},Connection.prototype.patch_up=function(t){function n(n){if(n instanceof Node)return n;for(var s=0,i=t.length;i>s;s++)if(t[s].uid===n)return t[s];return msg("ERROR: Failed to resolve node with uid = "+n),null}if(!(this.src_node instanceof Node&&this.dst_slot.is_connected&&this.src_slot.is_connected)){if(this.src_node=n(this.src_node),this.dst_node=n(this.dst_node),!this.src_node||!this.dst_node)return msg("ERROR: Source or destination node invalid - dropping connection."),console.log("Connection that failed",this),!1;var s=(this.src_slot.dynamic?this.src_node.dyn_outputs:this.src_node.plugin.output_slots)[this.src_slot.index],i=(this.dst_slot.dynamic?this.dst_node.dyn_inputs:this.dst_node.plugin.input_slots)[this.dst_slot.index];if(!s||!i)return msg("ERROR: Source or destination slot invalid - dropping connection."),console.log("Connection that failed",this),!1;this.src_slot=s,this.dst_slot=i;var o=E2.dt.ANY;return this.src_slot.dt.id!==this.dst_slot.dt.id&&this.src_slot.dt.id!==o.id&&this.dst_slot.dt.id!==o.id?(msg("ERROR: Connection data type mismatch - dropping connection."),console.log("Connection that failed",this.src_slot.dt,this.dst_slot.dt),!1):(this.src_node.addOutput(this),this.dst_node.addInput(this),this.dst_slot.is_connected=this.src_slot.is_connected=!0,!0)}},Connection.hydrate=function(t,n){var s=new Connection;return s.deserialise(n),s.patch_up(t.nodes),s},"undefined"!=typeof module&&(module.exports.Connection=Connection,module.exports.ConnectionUI=ConnectionUI);
(function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function n(e){return function(){return this[e].apply(this,arguments)}}var r=e.prototype,i=this,s=i.EventEmitter;r.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},r.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},r.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},r.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},r.on=n("addListener"),r.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},r.once=n("addOnceListener"),r.defineEvent=function(e){return this.getListeners(e),this},r.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},r.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},r.off=n("removeListener"),r.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},r.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},r.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},r.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},r.removeAllListeners=n("removeEvent"),r.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},r.trigger=n("emitEvent"),r.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},r.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},r._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},r._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=s,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof module&&module.exports?module.exports=e:i.EventEmitter=e}).call(this);
function Graph(t,e,n){EventEmitter.call(this),this.nodes=[],this.connections=[],this.core=t,this.registers=new Registers(t),this.parent_graph=e,this.roots=[],this.children=[],this.uid=void 0!==n?n:E2.uid()}if(Graph.prototype=Object.create(EventEmitter.prototype),Graph.prototype.get_node_uid=function(){return E2.core.get_uid()},Graph.prototype.update=function(){for(var t=this.nodes,e=this.roots,n=this.children,i=!1,o=0,r=t.length;r>o;o++)t[o].update_count=0;for(var o=0,r=e.length;r>o;o++)i=e[o].update_recursive(this.connections)||i;for(var o=0,r=n.length;r>o;o++){var s=n[o];s.plugin.texture||(i=s.update_recursive(this.connections)||i)}i&&this===E2.app.player.core.active_graph&&(E2.app.player.core.active_graph_dirty=i);for(var o=0,r=t.length;r>o;o++)t[o].plugin.updated=!1;return i},Graph.prototype.enum_all=function(t,e){if(t)for(var n=this.nodes,i=0,o=n.length;o>i;i++)t(n[i]);if(e)for(var r=this.connections,i=0,o=r.length;o>i;i++)e(r[i])},Graph.prototype.reset=function(){var t,e,n=this.nodes,i=this.connections;for(t=0,e=n.length;e>t;t++)n[t].reset();for(t=0,e=i.length;e>t;t++)i[t].reset()},Graph.prototype.play=function(){this.enum_all(function(t){t.plugin.play&&t.plugin.play()},null)},Graph.prototype.pause=function(){this.enum_all(function(t){t.plugin.pause&&t.plugin.pause()},null)},Graph.prototype.stop=function(){this.enum_all(function(t){t.plugin.stop&&t.plugin.stop()},null)},Graph.prototype.addNode=function(t,e){return this.registerNode(t,e?e.order:null),this.emit("nodeAdded",t,e),t},Graph.prototype.registerNode=function(t,e){return e?this.nodes.splice(e[0],0,t):this.nodes.push(t),this.nuid_lut&&(this.nuid_lut[t.uid]=t),t.plugin.output_slots.length||t.dyn_outputs.length||this.roots.push(t),t.plugin.isGraph&&(e?this.children.splice(e[1],0,t):this.children.push(t),-1===E2.core.graphs.indexOf(t.plugin.graph)&&E2.core.graphs.push(t.plugin.graph)),t},Graph.prototype.removeNode=function(t){function e(e){return t!==e}return this.nodes=this.nodes.filter(e),this.nuid_lut&&delete this.nuid_lut[t.uid],t.plugin.output_slots.length||t.dyn_outputs.length||(this.roots=this.roots.filter(e)),t.plugin.isGraph&&(this.children=this.children.filter(e),E2.core.graphs.splice(E2.core.graphs.indexOf(t.plugin.graph),1)),this.emit("nodeRemoved",t),t},Graph.prototype.renameNode=function(t,e){t.title=e,this.emit("nodeRenamed",t)},Graph.prototype.addConnection=function(t){return this.connections.push(t),t},Graph.prototype.connect=function(t){return this.addConnection(t)},Graph.prototype.disconnect=function(t){var e=this.connections.indexOf(t);-1!==e&&this.connections.splice(e,1),t.dst_node&&t.dst_node.removeInput(t),t.src_node&&t.src_node.removeOutput(t)},Graph.prototype.create_ui=function(){this.nuid_lut=[];for(var t=0,e=this.nodes.length;e>t;t++){var n=this.nodes[t];this.nuid_lut[n.uid]=n}this.enum_all(function(t){t.create_ui(),t.plugin.state_changed&&t.plugin.state_changed(t.ui.plugin_ui)},function(t){t.create_ui(),t.ui.resolve_slot_divs()})},Graph.prototype.destroy_ui=function(){this.enum_all(function(t){t.destroy_ui()},function(t){t.destroy_ui()}),delete this.nuid_lut},Graph.prototype.find_connection_to=function(t,e){if(e.type===E2.slot_type.input){var n=t.uid;return this.connections.filter(function(t){return t.dst_node.uid===n&&t.dst_slot===e})[0]}},Graph.prototype.find_connections_from=function(t,e){if(e.type!==E2.slot_type.output)return[];var n=t.uid;return this.connections.filter(function(t){return t.src_node.uid===n&&t.src_slot===e})},Graph.prototype.serialise=function(){var t={};return t.uid=this.uid,t.parent_uid=this.parent_graph?this.parent_graph.uid:-1,t.open=this.open,t.nodes=[],t.conns=[],this.enum_all(function(e){t.nodes.push(e.serialise())},function(e){t.conns.push(e.serialise())}),this.registers.serialise(t),t},Graph.prototype.deserialise=function(t){this.uid=""+t.uid,this.parent_graph=t.parent_uid,this.nodes=[],this.roots=[],this.children=[],this.open=t.open||!1;var e,n;for(e=0,n=t.nodes.length;n>e;e++){var i=new Node(null,null,null,null);i.deserialise(this.uid,t.nodes[e])&&this.registerNode(i)}for(this.connections=[],e=0,n=t.conns.length;n>e;e++){var o=new Connection(null,null,null,null);o.deserialise(t.conns[e]),this.connections.push(o)}t.registers&&this.registers.deserialise(t.registers)},Graph.prototype.patch_up=function(t){this.parent_graph instanceof Graph||(this.parent_graph=Graph.resolve_graph(t,this.parent_graph));var e,n,i=this.nodes,o=this.connections;for(e=0,n=i.length;n>e;e++)i[e].patch_up(t);for(prune=[],e=0,n=o.length;n>e;e++){var r=o[e];r.patch_up(this.nodes)||prune.push(r)}for(e=0,n=prune.length;n>e;e++)o.remove(prune[e])},Graph.prototype.initialise=function(){for(var t=this.nodes,e=0,n=t.length;n>e;e++)t[e].initialise();this.reset()},Graph.prototype.getTitle=function(){return this.title},Graph.prototype.reorder_children=function(t,e,n){function i(i){i.remove(t);var o=i.indexOf(e);n&&o++,i.splice(o,0,t)}i(this.children),i(this.nodes)},Graph.prototype.findConnectionByUid=function(t){var e;return this.connections.some(function(n){return n.uid===t?(e=n,!0):void 0}),e},Graph.prototype.findNodeByUid=function(t){var e;return this.nodes.some(function(n){return n.uid===t?(e=n,!0):void 0}),e||(msg("ERROR: Failed to resolve node("+t+") in graph("+this.uid+")"),console.log("Graph nodes",this.nodes)),e},Graph.lookup=function(t){return Graph.resolve_graph(E2.core.graphs,t)},Graph.resolve_graph=function(t,e){for(var n=0,i=t.length;i>n;n++)if(t[n].uid===e)return t[n];return-1!==e&&(msg("ERROR: Failed to resolve graph("+e+")"),console.log("Graphs",t)),null},"undefined"!=typeof module){module.exports=Graph;var Connection=require("./connection").Connection}
function Node(t,i,s,e){EventEmitter.call(this),this.inputs=[],this.outputs=[],this.queued_update=-1,this.dyn_inputs=[],this.dyn_outputs=[],this.uid=E2.uid(),i&&(this.parent_graph=t,this.x=s,this.y=e,this.ui=null,this.id=E2.core.pluginManager.keybyid[i],this.update_count=0,this.title=null,this.inputs_changed=!1,this.open=!0,this.set_plugin(E2.core.pluginManager.create(i,this)))}function LinkedSlotGroup(t,i,s,e){this.core=t,this.node=i,this.inputs=s,this.outputs=e,this.n_connected=0,this.dt=t.datatypes.ANY}Node.prototype=Object.create(EventEmitter.prototype),Node.prototype.getConnections=function(){return this.inputs.concat(this.outputs)},Node.prototype.getDynamicInputSlots=function(){return this.dyn_inputs},Node.prototype.getDynamicOutputSlots=function(){return this.dyn_outputs},Node.prototype.set_plugin=function(t){function i(t,i,s){t.index=i,t.type=s,t.dt||msg("ERROR: The slot '"+t.name+"' does not declare a datatype.")}this.plugin=t,this.plugin.updated=!0;for(var s=0,e=t.input_slots.length;e>s;s++)i(t.input_slots[s],s,E2.slot_type.input);for(var s=0,e=t.output_slots.length;e>s;s++)i(t.output_slots[s],s,E2.slot_type.output)},Node.prototype.setOpenState=function(t){this.open=t,this.emit("openStateChanged",t)},Node.prototype.create_ui=function(){this.ui=new NodeUI(this,this.x,this.y)},Node.prototype.destroy_ui=function(){this.ui&&(this.ui.dom.remove(),this.ui=null,this.plugin.destroy_ui&&this.plugin.destroy_ui())},Node.prototype.destroy=function(){var t=this.parent_graph,i=t.nodes.indexOf(this),s=[];this.plugin.destroy&&this.plugin.destroy(),-1!==i&&t.nodes.splice(i,1),s.push.apply(s,this.inputs),s.push.apply(s,this.outputs);for(var e=0,n=s.length;n>e;e++)t.disconnect(s[e]);this.destroy_ui()},Node.prototype.get_disp_name=function(){return this.title?this.title:this.id},Node.prototype.reset=function(){var t=this.plugin;t.reset&&(t.reset(),t.updated=!0)},Node.prototype.geometry_updated=function(){if(!(this.outputs.length<1)){for(var t=0,i=this.outputs.length;i>t;t++){var s=this.outputs[t];E2.app.getSlotPosition(s.src_node,s.ui.src_slot_div,E2.slot_type.output,s.ui.src_pos)}E2.app.updateCanvas(!0)}},Node.prototype.add_slot=function(t,i){var s=t===E2.slot_type.input,e=s?this.dyn_inputs:this.dyn_outputs;if((void 0===i.uid||null===i.uid)&&(i.uid=E2.uid()),!i.dt)return msg("ERROR: No datatype given for slot"),console.trace("No datatype given for slot"),!1;if(!i.name)return msg("ERROR: No name given for slot"),console.trace("No name given for slot"),!1;i.dynamic=!0,i.type=t,void 0===i.index&&(i.index=e.length),e.splice(i.index,0,i);for(var n=0,o=e.length;o>n;n++)e[n].index=n;if(this.ui){var u=this.ui.dom.find(s?".ic":".oc");if(!u)return i.uid;u.empty(),NodeUI.render_slots(this,"n"+this.uid,u,s?this.plugin.input_slots:this.plugin.output_slots,t),NodeUI.render_slots(this,"n"+this.uid,u,e,t),this.inputs.concat(this.outputs).map(function(t){t.ui.resolve_slot_divs()}),E2.app.updateCanvas(!0),this.update_connections()}return this.emit("slotAdded",i),i.uid},Node.prototype.remove_slot=function(t,i){var s=t===E2.slot_type.input,e=s?this.dyn_inputs:this.dyn_outputs;if(e.length){for(var n=null,o=-1,u=0,p=e.length;p>u;u++){var d=e[u];if(d.uid===i){n=d,o=u,e.splice(u,1);break}}if(n){if(e.length)for(var u=0,p=e.length;p>u;u++)e[u].index=u;this.ui&&this.ui.dom.find("#n"+this.uid+(s?"di":"do")+n.uid).remove();for(var r=s?this.inputs:this.outputs,h=[],a=!1,u=0,p=r.length;p>u;u++){var l=r[u],d=s?l.dst_slot:l.src_slot;d===n?(h.push(l),l.ui&&(a=!0)):void 0!==d.uid&&d.index>=o&&l.ui&&(l.ui.resolve_slot_divs(),E2.app.redrawConnection(l),a=!0)}for(var u=0,p=h.length;p>u;u++)this.parent_graph.disconnect(h[u]);this.emit("slotRemoved",n),a&&E2.app.updateCanvas(!0)}}},Node.prototype.findSlotByUid=function(t){var i;return this.dyn_inputs.concat(this.dyn_outputs).some(function(s){return s.uid===t?(i=s,!0):void 0}),i||console.error("Slot not found",slot_type,t),i},Node.prototype.find_dynamic_slot=function(t,i){for(var s=t===E2.slot_type.input?this.dyn_inputs:this.dyn_outputs,e=0,n=s.length;n>e;e++)if(s[e].uid===i)return s[e];console.error("Slot not found",t,i)},Node.prototype.rename_slot=function(t,i,s){var e=t===E2.slot_type.input,n=this.find_dynamic_slot(t,i);n&&(n.name=s,this.ui&&this.ui.dom.find("#n"+this.uid+(e?"di":"do")+n.uid).text(s))},Node.prototype.change_slot_datatype=function(t,i,s){var e=this.find_dynamic_slot(t,i),n=this.parent_graph;if(e.dt===s)return!1;if(e.dt!==n.core.datatypes.ANY){for(var o=t===E2.slot_type.input?this.inputs:this.outputs,u=[],p=null,d=0,r=o.length;r>d;d++)p=o[d],(p.src_node===this||p.dst_node===this)&&u.push(p);for(var d=0,r=u.length;r>d;d++)n.disconnect(u[d])}return e.dt=s,!0},Node.prototype.addInput=function(t){var i=this.inputs.some(function(i,s){return i.dst_slot.index>t.dst_slot.index?(this.inputs.splice(s,0,t),!0):void 0}.bind(this));i||this.inputs.push(t)},Node.prototype.addOutput=function(t){this.outputs.push(t)},Node.prototype.removeOutput=function(t){t.dst_slot.is_connected=!1,this.outputs.splice(this.outputs.indexOf(t),1)},Node.prototype.removeInput=function(t){t.dst_slot.is_connected=!1,this.inputs.splice(this.inputs.indexOf(t),1)},Node.prototype.update_connections=function(){return this.outputs.forEach(function(t){E2.app.getSlotPosition(t.src_node,t.ui.src_slot_div,E2.slot_type.output,t.ui.src_pos)}),this.inputs.forEach(function(t){E2.app.getSlotPosition(t.dst_node,t.ui.dst_slot_div,E2.slot_type.input,t.ui.dst_pos)}),this.inputs.length+this.outputs.length},Node.prototype.update_recursive=function(t){var i=!1;if(this.update_count<1){for(var s=this.inputs,e=this.plugin,n=this.inputs_changed||e.updated,o=0,u=s.length;u>o;o++){var p=s[o];if(!p.dst_slot.inactive){var d=p.src_node;i=d.update_recursive(t)||i;var r=d.plugin.update_output(p.src_slot);!d.plugin.updated||d.plugin.query_output&&!d.plugin.query_output(p.src_slot)?p.ui&&p.ui.flow&&(p.ui.flow=!1,i=!0):(e.update_input(p.dst_slot,r),e.updated=!0,n=!0,p.ui&&!p.ui.flow&&(i=!0,p.ui.flow=!0))}}e.always_update||e.isGraph&&e.state.always_update?e.update_state():this.queued_update>-1?(e.update_state&&e.update_state(),e.updated=!0,this.queued_update--):n||0===e.output_slots.length&&(!this.outputs||0===this.outputs.length)?(e.update_state&&e.update_state(),this.inputs_changed=!1):0!==e.input_slots.length||this.inputs&&0!==this.inputs.length||e.update_state&&e.update_state()}return this.update_count++,i},Node.prototype.setPluginState=function(t,i){this.plugin.state[t]=i,this.plugin.updated=!0,this.plugin.dirty=!0,this.emit("pluginStateChanged",t,i)},Node.prototype.serialise=function(t){function i(t){for(var i=0,s=t.length;s>i;i++)delete t[i].desc,t[i].dt=t[i].dt.id}var s={};return s.plugin=this.plugin.id,s.x=Math.round(this.x),s.y=Math.round(this.y),s.uid=this.uid,this.open||(s.open=this.open),this.plugin.state&&(s.state=this.plugin.state),this.title&&(s.title=this.title),!t&&this.plugin.isGraph&&(s.graph=this.plugin.graph.serialise()),(this.dyn_inputs.length||this.dyn_outputs.length)&&(this.dyn_inputs.length&&(s.dyn_in=clone(this.dyn_inputs),i(s.dyn_in)),this.dyn_outputs.length&&(s.dyn_out=clone(this.dyn_outputs),i(s.dyn_out))),s},Node.prototype.fixStateSidsIssue135=function(t){function i(t){Object.keys(t).map(function(i){t[""+i]=""+t[i]})}t.input_sids&&i(t.input_sids),t.output_sids&&i(t.output_sids)},Node.prototype.deserialise=function(t,i){function s(t,i){for(var s=E2.core.resolve_dt,e=0;e<t.length;e++){var n=t[e];n.uid=""+n.uid,n.dynamic=!0,n.dt=s[n.dt],n.type=i}}this.parent_graph=t,this.x=i.x,this.y=i.y,this.id=E2.core.pluginManager.keybyid[i.plugin],this.uid=""+i.uid,this.open=void 0!==i.open?i.open:!0,this.title=i.title?i.title:null;var e=E2.core.pluginManager.create(i.plugin,this);if(!e)return msg("ERROR: Failed to instance node of type '"+i.plugin+"' with title '"+this.title+"' and UID = "+this.uid+"."),!1;if(this.set_plugin(e),this.plugin.isGraph&&(this.plugin.setGraph(new Graph(E2.core,null,null)),this.plugin.graph.plugin=this.plugin,this.plugin.graph.deserialise(i.graph),-1===E2.core.graphs.indexOf(this.plugin.graph)&&E2.core.graphs.push(this.plugin.graph)),i.state&&this.plugin.state){this.fixStateSidsIssue135(i.state);for(var n in i.state)i.state.hasOwnProperty(n)&&n in this.plugin.state&&(this.plugin.state[n]=i.state[n])}return(i.dyn_in||i.dyn_out)&&(i.dyn_in&&(this.dyn_inputs=i.dyn_in,s(this.dyn_inputs,E2.slot_type.input)),i.dyn_out&&(this.dyn_outputs=i.dyn_out,s(this.dyn_outputs,E2.slot_type.output))),!0},Node.prototype.patch_up=function(t){function i(t,s){if(s.parent_graph=t,s.plugin.isGraph){void 0===s.plugin.graph.uid&&(s.plugin.graph.uid=E2.core.get_uid()),s.plugin.graph.parent_graph=t;for(var e=s.plugin.graph.nodes,n=0,o=e.length;o>n;n++)i(s.plugin.graph,e[n])}}this.parent_graph instanceof Graph||(this.parent_graph=Graph.resolve_graph(t,this.parent_graph)),i(this.parent_graph,this),this.plugin.isGraph&&this.plugin.graph.patch_up(t)},Node.prototype.initialise=function(){this.plugin.state_changed&&this.plugin.state_changed(null),this.plugin.isGraph&&this.plugin.graph.initialise()},Node.hydrate=function(t,i){var s=new Node;return s.deserialise(t,i),s.patch_up(E2.core.graphs),s},LinkedSlotGroup.prototype.set_dt=function(t){this.dt=t;for(var i=0,s=this.inputs.length;s>i;i++)this.inputs[i].dt=t;for(var i=0,s=this.outputs.length;s>i;i++)this.outputs[i].dt=t},LinkedSlotGroup.prototype.add_dyn_slot=function(t){(t.type===E2.slot_type.input?this.inputs:this.outputs).push(t)},LinkedSlotGroup.prototype.remove_dyn_slot=function(t){(t.type===E2.slot_type.input?this.inputs:this.outputs).remove(t)},LinkedSlotGroup.prototype.connection_changed=function(t,i,s){return-1!==this.inputs.indexOf(s)||-1!==this.outputs.indexOf(s)?(this.n_connected+=t?1:-1,t&&1===this.n_connected?(this.set_dt(s.type===E2.slot_type.input?i.src_slot.dt:i.dst_slot.dt),!0):t||0!==this.n_connected?!1:(this.set_dt(this.core.datatypes.ANY),!0)):void 0},LinkedSlotGroup.prototype.infer_dt=function(){for(var t=this.node,i=null,s=this.core.datatypes.ANY,e=0,n=t.inputs.length;n>e;e++){var o=t.inputs[e];-1!==this.inputs.indexOf(o.dst_slot)&&(i=o.src_slot.dt!==s?o.src_slot.dt:i,this.n_connected++)}for(var e=0,n=t.outputs.length;n>e;e++){var o=t.outputs[e];-1!==this.outputs.indexOf(o.src_slot)&&(i=o.dst_slot.dt!==s?o.dst_slot.dt:i,this.n_connected++)}return null!==i?(this.set_dt(i),this.core.get_default_value(i)):null},"undefined"!=typeof module&&(module.exports.Node=Node,module.exports.LinkedSlotGroup=LinkedSlotGroup);
function Registers(e){this.core=e,this.registers={}}Registers.prototype.lock=function(e,t){t in this.registers?this.registers[t].ref_count++:this.registers[t]={dt:E2.app.player.core.datatypes.ANY,value:null,users:[],ref_count:1,connections:0};var r=this.registers[t].users;e in r||r.push(e)},Registers.prototype.unlock=function(e,t){if(t in this.registers){var r=this.registers[t];r.users.remove(e),0===--r.ref_count&&delete this.registers[t]}},Registers.prototype.connection_changed=function(e,t){var r=this.registers[e];if(t)r.connections++;else if(r.connections--,0===r.connections)for(var s=r.users,i=E2.app.player.core.datatypes.ANY,n=0,o=s.length;o>n;n++)s[n].register_dt_changed(i);return r.connections},Registers.prototype.set_datatype=function(e,t){for(var r=this.registers[e],s=r.users,i=0,n=s.length;n>i;i++)s[i].register_dt_changed(t);r.dt=t,this.write(e,this.core.get_default_value(t))},Registers.prototype.write=function(e,t){var r=this.registers[e],s=r.users;r.value=t;for(var i=0,n=s.length;n>i;i++){var o=s[i];o.register_updated&&o.register_updated(t)}},Registers.prototype.count=function(){var e=0;for(var t in this.registers)this.registers.hasOwnProperty(t)||e++;return e},Registers.prototype.serialise=function(e){var t=this.registers,r=[];for(id in t)t.hasOwnProperty(id)&&r.push({id:id,dt:t[id].dt.id});r.length>0&&(e.registers=r)},Registers.prototype.deserialise=function(e){for(var t=E2.app.player.core.resolve_dt,r=0,s=e.length;s>r;r++){var i=e[r],n=t[i.dt];this.registers[i.id]={dt:n,value:null,users:[],ref_count:1,connections:0},this.write(i.id,this.core.get_default_value(n))}},"undefined"!=typeof module&&(module.exports=Registers);
function Delegate(t,e,i){this.delegate=t,this.dt=e,this.count=i}function AssetTracker(t){this.core=t,this.started=0,this.completed=0,this.failed=0,this.listeners=[]}function Core(t){E2.core=this,E2.dt=this.datatypes={FLOAT:{id:0,name:"Float"},SHADER:{id:1,name:"Shader"},TEXTURE:{id:2,name:"Texture"},COLOR:{id:3,name:"Color"},MATRIX:{id:4,name:"Matrix"},VECTOR:{id:5,name:"Vector"},CAMERA:{id:6,name:"Camera"},BOOL:{id:7,name:"Boolean"},ANY:{id:8,name:"Arbitrary"},MESH:{id:9,name:"Mesh"},AUDIO:{id:10,name:"Audio"},SCENE:{id:11,name:"Scene"},MATERIAL:{id:12,name:"Material"},LIGHT:{id:13,name:"Light"},DELEGATE:{id:14,name:"Delegate"},TEXT:{id:15,name:"Text"},VIDEO:{id:16,name:"Video"},ARRAY:{id:17,name:"Array"},OBJECT:{id:18,name:"Object"}},this._listeners={},this.asset_tracker=new AssetTracker(this),this.renderer=new Renderer(t,"#webgl-canvas",this),this.active_graph_dirty=!0,this.active_graph=this.root_graph=null,this.graphs=[],this.abs_t=0,this.delta_t=0,this.graph_uid=this.get_uid(),this.uidCounter=0,this.pluginManager=new PluginManager(this,"/plugins"),this.pluginManager.on("ready",function(){this.onPluginsLoaded()}.bind(this)),this.aux_scripts={},this.aux_styles={},this.resolve_dt=[],this.audio_ctx=null;for(var e in this.datatypes){var i=this.datatypes[e];this.resolve_dt[i.id]=i}window.AudioContext?this.audio_ctx=new AudioContext:window.webkitAudioContext?this.audio_ctx=new webkitAudioContext:msg("NOTE: This host has no AudioContext support.")}var URL_DATA="/data/",URL_GRAPHS="/graph/",URL_GRAPH_FILES=URL_DATA+"graph/",E2={};window.E2=E2,E2.app=null,E2.dom={},E2.plugins={},E2.slot_type={input:0,output:1},E2.erase_color="#ff3b3b",E2.COLOR_COMPATIBLE_SLOT="#080",function(){E2.uid=function(){for(var t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e="",i=0;12>i;i++)e+=t[Math.floor(Math.random()*t.length)];return e}}(),AssetTracker.prototype.add_listener=function(t){this.listeners.push(t)},AssetTracker.prototype.remove_listener=function(t){this.listeners.remove(t)},AssetTracker.prototype.signal_started=function(){this.started++,this.signal_update()},AssetTracker.prototype.signal_completed=function(){this.completed++,this.signal_update()},AssetTracker.prototype.signal_failed=function(){this.failed++,this.signal_update()},AssetTracker.prototype.signal_update=function(){var t=this.listeners;E2.dom.load_spinner&&E2.dom.load_spinner.css("display",this.started===this.completed+this.failed?"none":"inherit");for(var e=0,i=t.length;i>e;e++)t[e]()},Core.prototype.get_uid=function(){return E2.uid()},Core.prototype.update=function(t,e){this.abs_t=t,this.delta_t=e,this.renderer.begin_frame(),this.root_graph.update(e),this.renderer.end_frame();var i=this.active_graph_dirty;return this.active_graph_dirty=!1,i},Core.prototype.create_dialog=function(t,e,i,r,s,a){function o(){h.unbind(),h.remove()}function n(){s(),h.modal("hide")}var h=bootbox.dialog({title:e,message:t,buttons:{Ok:function(){}}});h.on("show.bs.modal",function(){$(".modal-dialog",h).css("width",i+40)}),h.on("shown.bs.modal",function(){a&&a()}),h.on("hidden.bs.modal",o),h.modal({keyboard:!0}),h.on("keypress",function(t){13===t.keyCode&&"TEXTAREA"!==t.target.nodeName&&n()}),$("button:last",h).click(n)},Core.prototype.get_default_value=function(t){var e=this.datatypes;if(t===e.FLOAT)return 0;if(t===e.COLOR)return vec4.createFrom(1,1,1,1);if(t===e.MATRIX){var i=mat4.create();return mat4.identity(i),i}if(t===e.TEXTURE)return this.renderer.default_tex;if(t===e.VECTOR)return vec3.createFrom(0,0,0);if(t===e.CAMERA)return new Camera(this.renderer.context);if(t===e.BOOL)return!1;if(t===e.MATERIAL)return new Material;if(t===e.TEXT)return"";if(t===e.ARRAY){var r=new ArrayBuffer(0);return r.stride=r.datatype=1,r}return t===e.OBJECT?{}:null},Core.prototype.serialise=function(){var t={};return t.abs_t=Math.round(this.abs_t*Math.pow(10,4))/Math.pow(10,4),t.active_graph=this.active_graph.uid,t.graph_uid=this.graph_uid,t.root=this.root_graph.serialise(),JSON.stringify(t,void 0,4)},Core.prototype.deserialiseObject=function(t){this.abs_t=t.abs_t,this.delta_t=0,this.graph_uid=""+t.graph_uid,this.active_graph.destroy_ui(),this.graphs=[],this.root_graph=new Graph(this,null,null),this.root_graph.deserialise(t.root),this.graphs.push(this.root_graph),this.root_graph.patch_up(this.graphs),this.root_graph.initialise(this.graphs),this.active_graph=resolve_graph(this.graphs,""+t.active_graph),this.active_graph||(msg("ERROR: The active graph (ID: "+t.active_graph+") is invalid. Using the root graph."),this.active_graph=this.root_graph)},Core.prototype.deserialise=function(t){return this.deserialiseObject(JSON.parse(t))},Core.prototype.rebuild_structure_tree=function(){function t(e,i){var r=e.nodes;if(e.parent_graph){var s=e.parent_graph.tree_node,a=new TreeNode(s.tree,s,i,e);s.children.push(a)}for(var o=0,n=r.length;n>o;o++){var h=r[o];h.plugin.isGraph&&t(h.plugin.graph,h.get_disp_name())}}E2.dom.structure&&(E2.dom.structure.tree.reset(),this.root_graph.tree_node=E2.dom.structure.tree.root,E2.dom.structure.tree.root.graph=this.root_graph,t(this.root_graph,"Root"),E2.dom.structure.tree.root.rebuild_dom())},Core.prototype.add_aux_script=function(t,e){return this.aux_scripts.hasOwnProperty(t)?void(e&&e()):void load_script("/plugins/"+t,function(){this.aux_scripts[t]=!0,e&&e()}.bind(this))},Core.prototype.add_aux_style=function(t){this.aux_styles.hasOwnProperty(t)||(load_style("/plugins/"+t),this.aux_styles[t]=!0)},Core.prototype.onPluginsLoaded=function(){this.emit("ready")},Core.prototype.on=function(t,e){e&&(this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e))},Core.prototype.emit=function(t){this._listeners[t]&&this._listeners[t].forEach(function(t){t()})},"undefined"!=typeof module&&(module.exports=Core);
function Plugin(n,e){var t=this;this.core=n,this.node=e,this.node.on("pluginStateChanged",function(){t.state_changed&&t.node.ui&&t.node.ui.plugin_ui&&t.state_changed(t.node.ui.plugin_ui)})}Plugin.prototype.undoableSetState=function(n,e,t){E2.app.undoManager.execute(new E2.commands.graph.ChangePluginState(this.node.parent_graph,this.node,n,t,e))},"undefined"!=typeof module&&(module.exports=Plugin);
function SubGraphPlugin(t,e){this.core=t,this.node=e,this.parent_node=e,this.updated_sids=[],this.input_nodes={},this.output_nodes={},this.gl=t.renderer.context,this.ui=null,this.isGraph=!0}SubGraphPlugin.prototype.reset=function(){this.graph&&this.graph.reset()},SubGraphPlugin.prototype.play=function(){this.graph&&this.graph.pause()},SubGraphPlugin.prototype.pause=function(){this.graph&&this.graph.pause()},SubGraphPlugin.prototype.stop=function(){this.graph&&this.graph.stop()},SubGraphPlugin.prototype.get_dt_name=function(t){return t&&t.name?t.name:"ERROR"},SubGraphPlugin.prototype.dbg=function(t){msg("Graph: "+t)},SubGraphPlugin.prototype.connection_changed=function(t,e,i){if(void 0!==i.uid){var n=null,u=this.core;if(t){var o=null;if(i.type===E2.slot_type.input){if(i.dt===u.datatypes.ANY&&(i.dt=e.src_slot.dt,this.dbg("Setting GDT for slot("+i.uid+") to "+this.get_dt_name(e.src_slot.dt))),o=this.input_nodes[i.uid],!o)return;n=o.dyn_outputs[0]}else{if(i.dt===u.datatypes.ANY&&(i.dt=e.dst_slot.dt,this.dbg("Setting GDT for slot("+i.uid+") to "+this.get_dt_name(e.dst_slot.dt))),o=this.output_nodes[i.uid],!o)return;n=o.dyn_inputs[0]}n.dt===u.datatypes.ANY&&(this.dbg("Setting PDT for slot("+n.uid+") to "+this.get_dt_name(i.dt)),n.dt=i.dt,o.plugin.data=u.get_default_value(i.dt))}else{if(i.type===E2.slot_type.input){var s=this.input_nodes[i.uid];n=s.dyn_outputs[0],s.plugin.data=u.get_default_value(i.dt),s.reset()}else{for(var p=this.parent_node,d=0,r=0,a=p.outputs.length;a>r;r++)p.outputs[r].src_slot===i&&d++;0===d&&(n=this.output_nodes[i.uid].dyn_inputs[0])}n&&!n.connected&&(n.dt=i.dt=u.datatypes.ANY,this.dbg("Resetting PDT/GDT for slot("+i.uid+")"))}}else i.type===E2.slot_type.output&&this.set_render_target_state(t)},SubGraphPlugin.prototype.proxy_connection_changed=function(t,e,i,n,u){function o(t,e){for(var i in t)if(t[i].uid===e)return i;return msg("ERROR: Failed to resolve node("+e+") in graph("+r.graph.plugin.parent_node.title+")."),-1}function s(t){var e,i;if(t.type===E2.slot_type.input){for(e=0,i=_.inputs.length;i>e;e++)if(_.inputs[e].dst_slot===t)return!0}else for(e=0,i=_.outputs.length;i>e;e++)if(_.outputs[e].src_slot===t)return!0;return!1}function p(n,p,d){if(d.connected=!0,t)d.dt===a.datatypes.ANY&&(d.dt=u.dt,r.dbg("    Setting PDT to "+r.get_dt_name(u.dt)+"."),p.dt===a.datatypes.ANY&&(e.plugin.data=a.get_default_value(u.dt))),p.dt===a.datatypes.ANY&&(p.dt=u.dt,r.dbg("    Setting GDT to "+r.get_dt_name(u.dt)+"."));else if(n){var l,h,g,y=_.parent_graph.connections,f=!1;for(l=0,h=y.length;h>l;l++){var c=y[l];if(c.dst_slot===p||c.src_slot===p){f=!0;break}}if(d.connected=!1,f||(d.dt=p.dt=a.datatypes.ANY,r.dbg("    Reverting to PDT/GDT to ANY.")),"input_proxy"===i.plugin.id){for(f=!1,l=0,h=i.outputs.length;h>l;l++)if(i.outputs[l].src_slot===u){f=!0;break}g=_.find_dynamic_slot(E2.slot_type.input,o(r.input_nodes,i.uid)),f||s(g)||(u.dt=g.dt=a.datatypes.ANY,r.dbg("    Reverting remote proxy slot to PDT/GDT to ANY."))}else"output_proxy"===i.plugin.id&&(g=_.find_dynamic_slot(E2.slot_type.output,o(r.output_nodes,i.uid)),s(g)||(u.dt=g.dt=a.datatypes.ANY,r.dbg("    Reverting remote proxy slot to PDT/GDT to ANY.")))}}var d,r=this,a=this.core,_=this.parent_node;"input_proxy"===e.plugin.id?(d=0===e.outputs.length,p(d,_.find_dynamic_slot(E2.slot_type.input,o(this.input_nodes,e.uid)),n),this.dbg("    Output count = "+e.outputs.length)):(d=0===e.inputs.length,p(d,_.find_dynamic_slot(E2.slot_type.output,o(this.output_nodes,e.uid)),n),this.dbg("    Input count = "+e.inputs.length))},SubGraphPlugin.prototype.update_output=function(t){return void 0!==t.uid?this.output_nodes[t.uid].plugin.data:(this.updated=!0,this.texture)},SubGraphPlugin.prototype.query_output=function(t){return void 0===t.uid||this.updated_sids.indexOf(t.uid)>-1},SubGraphPlugin.prototype.destroy_slot=function(t,e){var i=t===E2.slot_type.input?this.state.input_sids:this.state.output_sids,n=i[e];delete i[e],this.parent_node.remove_slot(t,n)},SubGraphPlugin.prototype.setupProxies=function(){function t(t){var i=e.graph.findNodeByUid(t);if(!i)return msg("ERROR: Failed to find registered proxy node("+t+") in graph("+self.graph.plugin.parent_node.title+").");var n=i.plugin;return n.data=E2.core.get_default_value(("input_proxy"===n.id?i.dyn_outputs:i.dyn_inputs)[0].dt),i}var e=this;for(var i in this.state.input_sids)this.input_nodes[this.state.input_sids[i]]=t(i);for(var i in this.state.output_sids)this.output_nodes[this.state.output_sids[i]]=t(i)},SubGraphPlugin.prototype.setGraph=function(t){var e=this,i=this.parent_node;this.graph=t,this.graph.on("nodeAdded",function(t,n){var u,o=t.plugin.id,s={name:t.title,dt:E2.dt.ANY,index:n&&n.proxy?n.proxy.index:null,uid:n&&n.proxy?n.proxy.sid:null};"input_proxy"===o?(u=i.add_slot(E2.slot_type.input,s),e.state.input_sids[t.uid]=u,e.input_nodes[u]=t):"output_proxy"===o&&(u=i.add_slot(E2.slot_type.output,s),e.state.output_sids[t.uid]=u,e.output_nodes[u]=t)}).on("nodeRemoved",function(t){var i=t.plugin.id;"input_proxy"===i?e.destroy_slot(E2.slot_type.input,t.uid):"output_proxy"===i&&e.destroy_slot(E2.slot_type.output,t.uid)}).on("nodeRenamed",function(t){var n=t.plugin.id;"input_proxy"===n?i.rename_slot(E2.slot_type.input,e.state.input_sids[t.uid],t.title):"output_proxy"===n&&i.rename_slot(E2.slot_type.output,e.state.output_sids[t.uid],t.title)})},"undefined"!=typeof module&&(module.exports=SubGraphPlugin);
function PluginManager(){EventEmitter.call(this),this.keybyid=E2.plugins;var e=this;setTimeout(function(){e.emit("ready")},0)}PluginManager.prototype=Object.create(EventEmitter.prototype),PluginManager.prototype.create=function(e,t){if(E2.plugins.hasOwnProperty(e)){var r=new E2.plugins[e](E2.app.player.core,t);return r.id=e,r}throw new Error("Failed to resolve plugin with id "+e)};
function PluginGroup(t){this.id=t,this.children={},this.entries={}}PluginGroup.prototype.get_or_create_group=function(t){var e=this.children[t];return e||(e=new PluginGroup(t),this.children[t]=e),e},PluginGroup.prototype.add_entry=function(t,e){var r=this.entries[t];console.assert(!r,'Plugin keys must be unique, but a duplicate instance of the key "'+e+'" was found in plugins.json.'),this.entries[t]=e},PluginGroup.prototype.insert_relative=function(t,e){var r=t.split("/");console.assert(r.length>0,"Plugin key cannot be empty.");for(var n=this,i=r.length-1,s=0;i>s;s++)n=n.get_or_create_group(r[s]);var t=r[i];return n.add_entry(t,e),t},PluginGroup.prototype.create_items=function(){for(var t=[],e=sort_dict(this.children),r=0,n=e.length;n>r;r++){var i=e[r],s=this.children[i];t.push({name:i,items:s.create_items()})}e=sort_dict(this.entries);for(var r=0,n=e.length;n>r;r++){var i=e[r],o=this.entries[i];t.push({name:i,icon:o})}return t};
E2.p=E2.plugins.absolute_modulator=function(t){this.desc="Emit the absolute value of the input.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Positive or negative input value",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Positive output value",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,u){this.input_val=u},E2.p.prototype.update_state=function(){this.output_val=Math.abs(this.input_val)},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.accumulate_modulator=function(t){this.desc="Every input <b>value</b> is accumulated in an internal buffer (which resets to zero on playback stop).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"A small value to be accumulated in an internal buffer.",def:0},{name:"reset",dt:t.datatypes.FLOAT,desc:"Send a value to this slot to reset the accumulator to that value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The current value of the accumulation buffer.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){0===t.index?this.state.value+=e:this.state.value=e},E2.p.prototype.update_output=function(){return this.state.value};
E2.p=E2.plugins.action_button=function(t,u){this.desc="Push button that emits true when it is clicked.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True once each time the button is clicked.",def:!1}],this.node=u,this.value=!1,this.output_value=!1},E2.p.prototype.reset=function(){this.value=!1,this.output_value=!1},E2.p.prototype.create_ui=function(){var t=makeButton("Click",null,"e_btn");return t.click(function(t){return function(){t.output_value=!1,t.value=!0,t.updated=!0}}(this)),t},E2.p.prototype.update_state=function(){this.updated=this.output_value||this.value,this.output_value=this.value,this.value=!1},E2.p.prototype.update_output=function(){return this.output_value};
E2.p=E2.plugins.add_modulator=function(t){this.desc="Add two floating point values.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The second operand.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The result of <b>first</b> + <b>second</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.add_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.add_val=e},E2.p.prototype.update_state=function(){this.output_val=this.input_val+this.add_val},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.alpha_modulator=function(t){this.desc="Changes the alpha component of the supplied <b>color</b> to the supplied <b>alpha</b>.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Input color with any alpha value",def:t.renderer.color_white},{name:"alpha",dt:t.datatypes.FLOAT,desc:"Replacement alpha value",lo:0,hi:1,def:1}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Emits the input <b>color</b> with the A-channel replaced by <b>alpha</b>."}]},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.update_input=function(t,e){var o=this.color;0===t.index?(o[0]=e[0],o[1]=e[1],o[2]=e[2]):o[3]=e},E2.p.prototype.update_output=function(){return this.color};
E2.p=E2.plugins.and_modulator=function(t){this.desc="Emit true if and only if both inputs are true and false otherwise.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"bool",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> <i>and</i> <b>second</b> are true, and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]&&this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
!function(){var t=E2.plugins.annotation=function(){Plugin.apply(this,arguments),this.desc="Add textual hints to the graph.",this.input_slots=[],this.output_slots=[],this.state={text:"",width:0,height:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=this,i=$('<textarea placeholder="Type text here" />');return i.css({"font-size":"8pt",border:"1px solid #999",margin:"0px","margin-top":"2px",padding:"2px",resize:!0}),i.on("change",function(){t.undoableSetState("text",i.val(),t.state.text)}),i.mouseup(function(){var i=$(this);t.state.width=i.width(),t.state.height=i.height()}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui=i,this.ui},t.prototype.state_changed=function(){this.updateUi()},t.prototype.updateUi=function(){if(this.ui){var t=this.state;t.text&&(this.ui.val(t.text),t.width>0&&this.ui.css("width",t.width),t.height>0&&this.ui.css("height",t.height))}}}();
E2.p=E2.plugins.array_generator=function(t){this.desc="Create a zeroed out array of a given size (in bytes).",this.input_slots=[{name:"size",dt:t.datatypes.FLOAT,desc:"Size if array in number of elements.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The resulting array."}],this.state={datatype:1},this.size=0,this.update_array()},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_array(),e.updated=!0}}(this)),t},E2.p.prototype.update_array=function(){if(0===this.size)return void(this.array=null);var t=[1,1,2,2,4,4,4][this.state.datatype];this.array=new ArrayBuffer(t*this.size),this.array.datatype=this.state.datatype,this.array.stride=t},E2.p.prototype.update_input=function(t,e){this.size=Math.floor(e),this.update_array()},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
E2.p=E2.plugins.array_get_as_modulator=function(t,e){this.desc="Gets an item value from an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain a value from.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to get.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value of the chosen item."}],this.state={datatype:1},this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_view(),e.updated=!0,e.node.queued_update=1}}(this)),t},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.getInt8,t.getUint8,t.getInt16,t.getUint16,t.getInt32,t.getUint32,t.getFloat32][this.state.datatype].bind(t),this.stride=[1,1,2,2,4,4,4][this.state.datatype]},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):this.index=Math.floor(e)},E2.p.prototype.update_state=function(){if(!this.dv)return void(this.value=0);var t=this.index*this.stride;0>t||t>=this.array.byteLength||(this.value=this.state.datatype<2?this.accessor(t):this.accessor(t,!0))},E2.p.prototype.update_output=function(t){return 0===t.index?this.array:this.value},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
E2.p=E2.plugins.array_get_modulator=function(t,e){this.desc="Gets an item value from an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain a value from.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to get.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value of the chosen item.",def:0}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):this.index=Math.floor(e)},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.getInt8,t.getUint8,t.getInt16,t.getUint16,t.getInt32,t.getUint32,t.getFloat32][this.array.datatype].bind(t)},E2.p.prototype.update_state=function(){if(!this.dv)return void(this.value=0);var t=this.index*this.array.stride;0>t||t>=this.array.byteLength||(this.value=this.array.datatype<2?this.accessor(t):this.accessor(t,!0))},E2.p.prototype.update_output=function(t){return 0===t.index?this.array:this.value};
E2.p=E2.plugins.array_item_to_bool_modulator=function(e){this.desc="Emits a boolean representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"The boolean representation of the specified array item.",def:!1}]},E2.p.prototype.reset=function(){this.value=!1,this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot index unknown array "'+this.member+'".');var e=this.object[this.member];return"[object Array]"!==Object.prototype.toString.call(e)?void msg('ERROR: Object member "'+this.member+'" is not an array.'):void(this.value=e.length>0&&e[this.index%e.length]?!0:!1)}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.array_item_to_float_modulator=function(e){this.desc="Emits a float representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"value",dt:e.datatypes.FLOAT,desc:"The float representation of the specified array item.",def:0}]},E2.p.prototype.reset=function(){this.value=0,this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(e))return void msg('ERROR: Object member "'+this.member+'" is not an array.');if(e.length<1)return void(this.value=0);var t=this.index%e.length,i=e[t];return isNaN(i)?void msg("ERROR: The item at index "+t+' of "'+this.member+'" is not a float.'):void(this.value=i)}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.array_item_to_object_modulator=function(e){this.desc="Emits an object representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"The object representation of the specified array item."}]},E2.p.prototype.reset=function(){this.value={},this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index?this.member=t:2===e.index&&(this.index=Math.floor(t),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(e))return void msg('ERROR: Object member "'+this.member+'" is not an array.');var t=e.length>0?e[this.index%e.length]:null;return null===t||"object"!=typeof t?void msg('ERROR: The member "'+this.member+'" is not an object.'):void(this.value=t)}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.array_item_to_string_modulator=function(t){this.desc="Emits an string representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The string representation of the specified array item."}]},E2.p.prototype.reset=function(){this.value="",this.object=null,this.member=null,this.index=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index?this.member=e:2===t.index&&(this.index=Math.floor(e),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];return"[object Array]"!==Object.prototype.toString.call(t)?void msg('ERROR: Object member "'+this.member+'" is not an array.'):void(this.value=t.length>0?t[this.index%t.length].toString():"")}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.array_item_to_typed_array_modulator=function(t){this.desc="Emits an typed array representation of the specified item in the named array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to be accessed.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"Index of the array item to be converted.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The string representation of the specified array item."}],this.state={datatype:6}},E2.p.prototype.reset=function(){this.array=new ArrayBuffer(0),this.object=null,this.member=null,this.index=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.updated=!0}}(this)),t},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index?this.member=e:2===t.index&&(this.index=Math.floor(e),this.index=this.index<0?0:this.index)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];if("[object Array]"!==Object.prototype.toString.call(t))return void msg('ERROR: Object member "'+this.member+'" is not an array.');var e=t.length>0?t[this.index%t.length]:null;if(null===e||"[object array]"!==Object.prototype.toString.call(e).toLowerCase())return void msg('ERROR: The member "'+this.member+'" is not an array.');switch(this.state.datatype){case 0:this.array=new Int8Array(e);break;case 1:this.array=new Uint8Array(e);break;case 2:this.array=new Int16Array(e);break;case 3:this.array=new Uint16Array(e);break;case 4:this.array=new Int32Array(e);break;case 5:this.array=new Uint32Array(e);break;case 6:this.array=new Float32Array(e)}this.array=this.array.buffer,this.array.datatype=this.state.datatype,this.array.stride=[1,1,2,2,4,4,4][this.state.datatype]}},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
E2.p=E2.plugins.array_length_modulator=function(t,e){this.desc="Gets the length of an array (in bytes).",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to obtain the length of.",def:null}],this.output_slots=[{name:"length",dt:t.datatypes.FLOAT,desc:"The length (in bytes) of the supplied array."}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.array=e)},E2.p.prototype.update_output=function(){return this.array?this.array.byteLength/this.array.stride:0},E2.p.prototype.state_changed=function(){};
E2.p=E2.plugins.array_set_as_modulator=function(t,e){this.desc="Sets an item value in an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to set a value in.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set the item to.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."}],this.state={datatype:1},this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0,this.stride=0},E2.p.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.state.datatype=parseInt(t.val()),e.update_view(),e.updated=!0,e.node.queued_update=1}}(this)),t},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):1===t.index?this.index=Math.floor(e):this.value=6===this.state.datatype?e:Math.floor(e)},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.stride=[1,1,2,2,4,4,4][this.state.datatype],this.accessor=[t.setInt8,t.setUint8,t.setInt16,t.setUint16,t.setInt32,t.setUint32,t.setFloat32][this.state.datatype].bind(t)},E2.p.prototype.update_state=function(){if(this.dv){var t=this.index*this.stride;if(!(0>t||t>=this.array.byteLength)){var e=this.state.datatype;2>e?this.accessor(t,Math.floor(this.value)):this.accessor(t,6===e?this.value:Math.floor(this.value),!0)}}},E2.p.prototype.update_output=function(){return this.array},E2.p.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)};
E2.p=E2.plugins.array_set_modulator=function(t,e){this.desc="Sets an item value in an array.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to set a value in.",def:null},{name:"index",dt:t.datatypes.FLOAT,desc:"The index of the item to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set the item to.",def:0}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The modified array."}],this.node=e,this.reset()},E2.p.prototype.reset=function(){this.array=null,this.dv=null,this.accessor=null,this.index=0,this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array!==e&&(this.array=e,this.update_view()):1===t.index?this.index=Math.floor(e):this.value=e},E2.p.prototype.update_view=function(){if(!this.array)return void(this.dv=null);var t=this.dv=new DataView(this.array);this.accessor=[t.setInt8,t.setUint8,t.setInt16,t.setUint16,t.setInt32,t.setUint32,t.setFloat32][this.array.datatype].bind(t)},E2.p.prototype.update_state=function(){if(this.dv){var t=this.index*this.array.stride;if(!(0>t||t>=this.array.byteLength)){var e=this.array.datatype;2>e?this.accessor(t,Math.floor(this.value)):this.accessor(t,6===e?this.value:Math.floor(this.value),!0)}}},E2.p.prototype.update_output=function(){return this.array};
!function(){var t=E2.plugins.array_switch_modulator=function(t,e){var n=this;this.desc="Revolver style array switch. Set up n inputs, then choose which one to output.",this.input_slots=[{name:"number",dt:E2.dt.FLOAT,desc:"Input number to select for output.",def:0}],this.output_slots=[{name:"value",dt:E2.dt.ANY,desc:"Emits the selected input."},{name:"length",dt:E2.dt.FLOAT,desc:"Emits the number of inputs = the length of the array."}],this.core=t,this.node=e,this.lsg=new LinkedSlotGroup(t,e,[],[this.output_slots[0]]),this.number=-1,this.values=[],this.node.on("slotAdded",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0}),this.node.on("slotRemoved",function(){n.dynInputs=e.getDynamicInputSlots(),n.updated=!0})};t.prototype.create_ui=function(){var t=this,e=make("div"),n=makeButton("Remove","Click to remove the last input."),i=makeButton("Add","Click to add another input.");return n.css("width","65px"),i.css({width:"65px","margin-top":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.input,name:t.dynInputs.length+"",dt:t.lsg.dt})}),n.click(function(){var e=t.dynInputs;if(e){var n=e[e.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,n)}}),e.append(n),e.append(make("br")),e.append(i),e},t.prototype.update_input=function(t,e){if(void 0===t.uid){if(0===t.index){var n=Math.floor(e);return void(this.number!==n&&(this.number=n,this.updated=!0))}}else this.values[t.index]=e},t.prototype.update_state=function(){this.value!==this.values[this.number]&&(this.value=this.values[this.number],this.updated=!0)},t.prototype.update_output=function(t){return 1===t.index?this.dynInputs.length:void 0!==this.value?this.value:this.core.get_default_value(this.lsg.dt)},t.prototype.connection_changed=function(t,e,n){this.lsg.connection_changed(t,e,n)&&(this.value=this.lsg.core.get_default_value(this.lsg.dt))},t.prototype.state_changed=function(t){if(!t){for(var e=this.dynInputs=this.node.getDynamicInputSlots(),n=0,i=e.length;i>n;n++)this.lsg.add_dyn_slot(e[n]);this.number=-1,this.value=this.lsg.infer_dt()}}}();
E2.p=E2.plugins.array_to_mesh_modulator=function(e){this.desc="Converts the supplied array to a mesh.",this.input_slots=[{name:"vertices",dt:e.datatypes.ARRAY,desc:"The vertex array (x, y, z).",def:null},{name:"normals",dt:e.datatypes.ARRAY,desc:"The normal array (x, y, z).",def:null},{name:"colors",dt:e.datatypes.ARRAY,desc:"The vertex color array (r, g, b, a).",def:null},{name:"uv0",dt:e.datatypes.ARRAY,desc:"The first UV coord array (x, y).",def:null},{name:"uv1",dt:e.datatypes.ARRAY,desc:"The second UV coord array (x, y).",def:null},{name:"uv2",dt:e.datatypes.ARRAY,desc:"The third UV coord array (x, y).",def:null},{name:"uv3",dt:e.datatypes.ARRAY,desc:"The forth UV coord array (x, y).",def:null},{name:"index",dt:e.datatypes.ARRAY,desc:"The index buffer (depends on primitive type).",def:null}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The resulting mesh."}],this.gl=e.renderer.context,this.mesh=new Mesh(this.gl,this.gl.TRIANGLES),this.vertices=null,this.normals=null,this.colors=null,this.uv0=null,this.uv1=null,this.uv2=null,this.uv3=null},E2.p.prototype.update_vertex_buffer=function(e,t,r){var s=this.mesh.vertex_buffers;r?(s[e]||(s[e]=new VertexBuffer(this.gl,t)),s[e].bind_data(r,this.gl.DRAW_DYNAMIC)):s[e]=null},E2.p.prototype.update_input=function(e,t){if(0===e.index)this.update_vertex_buffer("VERTEX",VertexBuffer.vertex_type.VERTEX,t);else if(1===e.index)this.update_vertex_buffer("NORMAL",VertexBuffer.vertex_type.NORMAL,t);else if(2===e.index)this.update_vertex_buffer("COLOR",VertexBuffer.vertex_type.NORMAL,t);else if(3===e.index)this.update_vertex_buffer("UV0",VertexBuffer.vertex_type.UV0,t);else if(4===e.index)this.update_vertex_buffer("UV1",VertexBuffer.vertex_type.UV1,t);else if(5===e.index)this.update_vertex_buffer("UV2",VertexBuffer.vertex_type.UV2,t);else if(6===e.index)this.update_vertex_buffer("UV3",VertexBuffer.vertex_type.UV3,t);else if(7===e.index){var r=this.mesh.index_buffer;t?(r||(r=new IndexBuffer(this.gl)),r.bind_data(t)):r=null}},E2.p.prototype.update_state=function(){var e=0,t=this.mesh.vertex_buffers;t.VERTEX&&(e=Math.max(e,t.VERTEX.count)),this.mesh.generate_shader(),this.mesh.vertex_count=e},E2.p.prototype.update_output=function(){return this.mesh};
E2.p=E2.plugins.array_to_texture_modulator=function(t){this.desc="Converts the supplied array to a texture.",this.input_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The array to convert.",def:null},{name:"width",dt:t.datatypes.FLOAT,desc:"The desired width of the resulting texture.",def:0}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The resulting texture."}],this.renderer=t.renderer,this.gl=t.renderer.context},E2.p.prototype.reset=function(){this.texture=new Texture(this.renderer),this.array=null,this.width=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.array=new Uint8Array(e):this.width=Math.floor(e)},E2.p.prototype.update_state=function(){if(this.array&&this.width){if(this.array.byteLength/4%this.width)return void msg("ERROR: Cannot create texture. The supplied width does not divide evenly into the array size in pixels.");var t=this.gl,e=this.texture,r=this.width,i=this.array.byteLength/4/this.width;if(!e.isPow2(r))return void msg("WARNING: The width ("+r+") of the texture is not a power of two.");if(!e.isPow2(i))return void msg("WARNING: The height ("+i+") of the texture is not a power of two.");msg("Uploading texture from array with size "+r+"x"+i),e.width=r,e.height=i,t.bindTexture(t.TEXTURE_2D,e.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,this.array),t.bindTexture(t.TEXTURE_2D,null)}},E2.p.prototype.update_output=function(){return this.texture};
E2.p=E2.plugins.aspect_ratio_generator=function(t){this.desc="Emits current renderer aspect ratio (width / height).",this.input_slots=[],this.output_slots=[{name:"aspect",dt:t.datatypes.FLOAT,desc:"The current renderer aspect ratio."}],this.core=t,this.canvas=t.renderer.canvas[0],this.delegate=this._onResize.bind(this),this.core.renderer.on("resize",this.delegate)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.renderer.off("resize",this.delegate)},E2.p.prototype.update_output=function(){return this.canvas.width/this.canvas.height},E2.p.prototype._onResize=function(){this.updated=!0};
E2.p=E2.plugins.assets_completed_generator=function(t,e){this.desc="Emits the current number of assets that have successfully loaded.",this.input_slots=[],this.output_slots=[{name:"count",dt:t.datatypes.FLOAT,desc:"Number of assets that have successfully loaded."}],this.core=t,this.node=e,this.asset_listener=function(t){return function(){t.node.queued_update=1}}(this),t.asset_tracker.add_listener(this.asset_listener)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.asset_tracker.remove_listener(this.asset_listener)},E2.p.prototype.update_output=function(){return this.core.asset_tracker.completed};
E2.p=E2.plugins.assets_failed_generator=function(t,e){this.desc="Emits the current number of assets that have failed to load.",this.input_slots=[],this.output_slots=[{name:"count",dt:t.datatypes.FLOAT,desc:"Number of assets that have failed to load."}],this.core=t,this.node=e,this.asset_listener=function(t){return function(){t.node.queued_update=1}}(this),t.asset_tracker.add_listener(this.asset_listener)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.asset_tracker.remove_listener(this.asset_listener)},E2.p.prototype.update_output=function(){return this.core.asset_tracker.failed};
E2.p=E2.plugins.assets_signal_completed_generator=function(t){this.desc="Signals that load of an asset has been successfully completed.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Increases the number of successfully loaded assets.",def:!1}],this.output_slots=[],this.core=t,this.value=!1},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=this.value===!1&&e},E2.p.prototype.update=function(){this.value&&(this.core.asset_tracker.signal_completed(),this.value=!1)};
E2.p=E2.plugins.assets_signal_failed_generator=function(t){this.desc="Signals that load of an asset has failed.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Increases the number of assets that have failed to load.",def:!1}],this.output_slots=[],this.core=t,this.value=!1},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=this.value===!1&&e},E2.p.prototype.update=function(){this.value&&(this.core.asset_tracker.signal_failed(),this.value=!1)};
E2.p=E2.plugins.assets_signal_started_generator=function(t){this.desc="Signals that load of an asset has been started.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Increases the number of assets being loaded.",def:!1}],this.output_slots=[],this.core=t,this.value=!1},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,s){this.value=this.value===!1&&s},E2.p.prototype.update=function(){this.value&&(this.core.asset_tracker.signal_started(),this.value=!1)};
E2.p=E2.plugins.assets_started_generator=function(t,e){this.desc="Emits the current number of assets that have begun loading.",this.input_slots=[],this.output_slots=[{name:"count",dt:t.datatypes.FLOAT,desc:"Number of assets that have begun loading."}],this.core=t,this.node=e,this.asset_listener=function(t){return function(){t.node.queued_update=1}}(this),t.asset_tracker.add_listener(this.asset_listener)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.asset_tracker.remove_listener(this.asset_listener)},E2.p.prototype.update_output=function(){return this.core.asset_tracker.started};
E2.p=E2.plugins.atan2_modulator=function(t){this.desc="Atan2(x, y).",this.input_slots=[{name:"x value",dt:t.datatypes.FLOAT,desc:"X value.",def:0},{name:"y value",dt:t.datatypes.FLOAT,desc:"Y value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"atan(<b>x</b>,<b>y</b>).",def:0}]},E2.p.prototype.reset=function(){this.x_value=0,this.y_value=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.x_value=e:this.y_value=e},E2.p.prototype.update_output=function(){return this.value=Math.atan2(this.x_value,this.y_value),this.value};
E2.p=E2.plugins.atan_modulator=function(t){this.desc="Atan(x).",this.input_slots=[{name:"x value",dt:t.datatypes.FLOAT,desc:"X value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"atan(<b>x</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.atan(e)},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.audio_analyse_modulator=function(t){this.desc="Frequency and time domain audio analysis.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"An audio source to analyse.",def:null},{name:"bin-count",dt:t.datatypes.FLOAT,desc:"Number of FFT bins. Will be made power-of-two and clamped to 8-2048.",def:32}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"The unmodified supplied source.",def:null},{name:"fft-bins",dt:t.datatypes.ARRAY,desc:"The FFT bins.",def:null}],this.analyser_node=t.audio_ctx?t.audio_ctx.createAnalyser():null,this.src=null,this.fft_bins=null,this.array=new ArrayBuffer(128),this.array.datatype=6,this.array.stride=4,this.first=!0},E2.p.prototype.reset=function(){this.first=!0},E2.p.prototype.update_input=function(t,s){0===t.index?(this.src&&this.src.disconnect(0),this.src=s,s&&(s.connect(this.analyser_node),this.analyser_node.player=s.player)):(this.fft_bins=Math.ceil(Math.log(s)/Math.log(2)),this.fft_bins=this.fft_bins<3?3:this.fft_bins>11?11:this.fft_bins,this.fft_bins=Math.pow(2,this.fft_bins),this.array=new ArrayBuffer(4*this.fft_bins),this.array.datatype=6,this.array.stride=4,msg("FFT bins = "+this.fft_bins))},E2.p.prototype.update_state=function(){(this.analyser_node.frequencyBinCount!==this.fft_bins||this.first)&&(this.analyser_node.fftSize=null!==this.fft_bins?2*this.fft_bins:64,this.first=!1)},E2.p.prototype.update_output=function(t){return 0===t.index?this.analyser_node:(this.analyser_node&&this.analyser_node.getFloatFrequencyData(new Float32Array(this.array)),this.updated=!0,this.array)};
E2.p=E2.plugins.audio_buffer_source_modulator=function(t,s){this.desc="Create a playable audio source from a buffer of audio data.",this.input_slots=[{name:"buffer",dt:t.datatypes.OBJECT,desc:"An audio buffer to create a playable source from.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Start or stop playback.",def:!1},{name:"loop",dt:t.datatypes.BOOL,desc:"Looping playback.",def:!1},{name:"loop-start",dt:t.datatypes.FLOAT,desc:"Start of loop (in seconds).",def:0},{name:"loop-end",dt:t.datatypes.FLOAT,desc:"End of loop (in seconds).",def:0}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A playable audio source",def:null}],this.core=t,this.node=s,this.audio_src=null,this.playing=!1,this.should_play=!1,this.loop=!1,this.loop_start=0,this.loop_end=0,this.time=null,this.state=0,this.update_source()},E2.p.prototype.reset=function(){this.changed=!0},E2.p.prototype.play=function(){this.audio_src&&!this.playing&&(this.should_play=!0,this.updated=!0)},E2.p.prototype.pause=function(){this.audio_src&&this.playing&&(this.playing=!1,this.should_play=!0,this.stop_playback(),this.audio_src=null,this.time=this.audio.currentTime)},E2.p.prototype.stop=function(){this.audio_src&&(this.playing&&(this.playing=this.should_play=!1,this.stop_playback(),this.audio_src=null),this.time=0)},E2.p.prototype.connection_changed=function(t,s,i){0===i.index&&!t&&this.playing&&this.node.outputs.length<1&&(this.stop_playback(),this.audio_src=null,this.playing=!1)},E2.p.prototype.update_input=function(t,s){if(0===t.index){if(s&&"[object AudioBuffer]"!==s.toString())return void msg("ERROR: Can't create audio source from buffer: The supplied object isn't a valid AudioBuffer object.");this.playing&&(this.audio_src&&this.stop_playback(),this.playing=!1),this.buffer=s,this.changed=!0}else 1===t.index?(this.should_play=s,this.changed=!0):2===t.index?this.loop=s:3===t.index?this.loop_start=s:4===t.index&&(this.loop_end=s)},E2.p.prototype.start_playback=function(){this.audio_src&&null!==this.audio_src.buffer&&0===this.state&&(this.audio_src.start(0),this.state++)},E2.p.prototype.stop_playback=function(){this.audio_src&&1===this.state&&(this.audio_src.stop(0),this.state++)},E2.p.prototype.update_source=function(){return this.core.audio_ctx?(this.audio_src=this.core.audio_ctx.createBufferSource(),this.audio_src.player=this,this.state=0,void(this.buffer&&this.playing&&(this.audio_src.buffer=this.buffer))):void(this.audio_src=null)},E2.p.prototype.update_state=function(){this.changed&&(this.playing!==this.should_play&&(this.audio_src&&this.playing&&!this.should_play&&this.stop_playback(),this.playing=this.should_play,this.update_source()),this.changed=!1),this.audio_src&&(this.audio_src.loop!==this.loop&&(this.audio_src.loop=this.loop),this.audio_src.loopStart!==this.loop_start&&(this.audio_src.loopStart=this.loop_start),this.audio_src.loopEnd!==this.loop_end&&(this.audio_src.loopEnd=this.loop_end),null!==this.time&&(this.audio_src.currentTime=this.time,this.time=null))},E2.p.prototype.update_output=function(){return this.audio_src};
E2.p=E2.plugins.audio_delay_modulator=function(t){this.desc="Delay audio data.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"An audio source to delay.",def:null},{name:"delay",dt:t.datatypes.FLOAT,desc:"Delay time (in seconds).",def:0}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A delayed audio source",def:null}],this.delay_node=t.audio_ctx?t.audio_ctx.createDelay(20):null,this.src=null,this.delay=null,this.first=!0},E2.p.prototype.reset=function(){this.first=!0},E2.p.prototype.update_input=function(t,e){0===t.index?(this.src&&this.src.disconnect(0),this.src=e,e&&(e.connect(this.delay_node),this.delay_node.player=e.player)):this.delay=e>20?20:e},E2.p.prototype.update_state=function(){(this.delay_node.delayTime.value!==this.delay||this.first)&&(this.delay_node.delayTime.value=null!==this.delay?this.delay:0,this.first=!1)},E2.p.prototype.update_output=function(){return this.delay_node};
!function(){var t=E2.plugins.audio_gain_modulator=function(t,n){var i=this;this.desc="(De)amplify or mix audio data.",this.input_slots=[{name:"gain",dt:t.datatypes.FLOAT,desc:"Amplification scalar.",def:null}],this.output_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"A (de)amplified audio source",def:null}],this.state={},this.core=t,this.node=n,this.gain_node=t.audio_ctx?t.audio_ctx.createGain():null,this.lsg=new LinkedSlotGroup(t,n,[],[]),this.srcs=[],this.gain=null,this.first=!0,this.node.on("slotAdded",function(){i.dynInputs=n.getDynamicInputSlots(),i.updated=!0}),this.node.on("slotRemoved",function(){i.dynInputs=n.getDynamicInputSlots(),i.updated=!0})};t.prototype.reset=function(){this.first=!0},t.prototype.create_ui=function(){var t=this,n=make("div"),i=makeButton("+","Click to add another input."),e=makeButton("-","Click to remove the last input.");return i.css({width:"20px","float":"left"}),e.css({width:"20px","float":"right","margin-left":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.input,name:t.dynInputs.length+"",dt:t.core.datatypes.OBJECT})}),e.click(function(){var n=t.dynInputs;if(n){var i=n[n.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,i)}}),n.append(i),n.append(e),n},t.prototype.update_input=function(t,n){if(void 0!==t.uid){if(this.srcs[t.index]===n)return;this.srcs[t.index]&&this.srcs[t.index].disconnect(0),n&&n.connect&&(this.srcs[t.index]=n,n.connect(this.gain_node),this.gain_node.player=n.player)}else 0===t.index&&(this.gain=n)},t.prototype.update_state=function(){(this.gain_node.gain.value!==this.gain||this.first)&&(this.gain_node.gain.value=null!==this.gain?this.gain:1,this.first=!1)},t.prototype.update_output=function(){return this.gain_node},t.prototype.state_changed=function(t){if(!t){this.dynInputs=this.node.getDynamicInputSlots();for(var n=0,i=this.dynInputs.length;i>n;n++)this.lsg.add_dyn_slot(this.dynInputs[n])}}}();
E2.p=E2.plugins.audio_get_current_time_modulator=function(t){this.desc="Get the current playback time of the supplied audio sample in seconds.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"Input audio sample.",def:null}],this.output_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Current playback time.",def:0}],this.always_update=!0},E2.p.prototype.reset=function(){this.time=0,this.audio=null},E2.p.prototype.update_state=function(){this.time=this.audio?this.audio.currentTime:0,this.updated=!0},E2.p.prototype.update_input=function(t,e){this.audio=e},E2.p.prototype.update_output=function(){return this.time};
E2.p=E2.plugins.audio_get_duration_modulator=function(t){this.desc="Get the duration of the supplied audio sample in seconds.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"Input audio sample.",def:null}],this.output_slots=[{name:"duration",dt:t.datatypes.FLOAT,desc:"Duration in seconds.",def:0}]},E2.p.prototype.reset=function(){this.duration=0},E2.p.prototype.update_input=function(t,o){this.duration=o?o.duration:0},E2.p.prototype.update_output=function(){return this.duration};
E2.p=E2.plugins.audio_player=function(t){this.desc="Play an audio stream. Playback loops.",this.input_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"The audio stream to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!1},{name:"mute",dt:t.datatypes.BOOL,desc:"Send true to mute playback and false to reenable audio.",def:!1},{name:"volume",dt:t.datatypes.FLOAT,desc:"Set playback volume.",lo:0,hi:0,def:.5},{name:"time",dt:t.datatypes.FLOAT,desc:"Set playback time.",def:null}],this.output_slots=[],this.audio=null,this.playing=!1,this.should_play=!1,this.muted=!1,this.volume=.5,this.time=null},E2.p.prototype.play=function(){this.audio&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.audio.play())},E2.p.prototype.pause=function(){this.audio&&this.playing&&(this.playing=!1,this.should_play=!0,this.audio.pause())},E2.p.prototype.stop=function(){this.audio&&(this.playing&&(this.playing=this.should_play=!1,this.audio.pause()),this.audio.readyState>2&&(this.audio.currentTime=0))},E2.p.prototype.update_input=function(t,i){0===t.index?(i||this.audio&&(this.audio.pause(),delete this.audio),this.audio=i,this.playing=!1):1===t.index?this.should_play=i:2===t.index?this.muted=i:3===t.index?this.volume=0>i?0:i>1?1:i:4===t.index&&(this.time=i)},E2.p.prototype.update_state=function(){var t=this.audio;this.playing!==this.should_play&&t&&(this.should_play?t.play():t.pause(),this.playing=this.should_play),this.playing&&(t&&(t.muted=this.muted,t.volume=this.volume,null!==this.time&&this.audio.readyState>2&&(t.currentTime=this.time?this.time:0,this.time=null)),this.updated=!0)};
E2.p=E2.plugins.audio_source_player=function(t,i){this.desc="Plays a supplied audio source.",this.input_slots=[{name:"source",dt:t.datatypes.OBJECT,desc:"The audio source to play.",def:null}],this.output_slots=[],this.core=t,this.node=i,this.audio_src=null},E2.p.prototype.connection_changed=function(t){!t&&this.audio_src&&(this.audio_src.player.stop_playback(),this.audio_src=null)},E2.p.prototype.update_input=function(t,i){if(0===t.index){if(i&&(!i.context||"[object AudioContext]"!==i.context.toString()))return void msg("ERROR: Can't play audio source: The supplied object isn't a valid AudioSource object.");if(!i&&this.audio_src&&this.audio_src.buffer)return void this.audio_src.player.stop_playback();this.audio_src&&this.audio_src!==i&&this.audio_src.player.stop_playback(),this.core.audio_ctx&&i&&(i.connect(this.core.audio_ctx.destination),i.player&&i.player.start_playback()),this.audio_src=i}},E2.p.prototype.update_state=function(){this.updated=!0};
!function(){var e=E2.plugins.blend_mode_generator=function(e){Plugin.apply(this,arguments),this.desc="Select blend mode.",this.input_slots=[],this.output_slots=[{name:"blend mode",dt:e.datatypes.FLOAT,desc:"Emits the selected blend mode when requested or the selection state changes.",def:"Normal"}],this.state={mode:Renderer.blend_mode.NORMAL}};e.prototype=Object.create(Plugin.prototype),e.prototype.reset=function(){},e.prototype.create_ui=function(){var e=this,t=Renderer.blend_mode,o=$("<select />",{selectedIndex:4});return $("<option />",{value:t.NONE,text:"None"}).appendTo(o),$("<option />",{value:t.ADDITIVE,text:"Add"}).appendTo(o),$("<option />",{value:t.SUBTRACTIVE,text:"Sub"}).appendTo(o),$("<option />",{value:t.MULTIPLY,text:"Mul"}).appendTo(o),$("<option />",{value:t.NORMAL,text:"Normal"}).appendTo(o),o.change(function(){e.undoableSetState("mode",parseInt(o.val()),e.state.mode)}),o},e.prototype.update_output=function(){return this.state.mode},e.prototype.state_changed=function(e){e&&e.val(""+this.state.mode)}}();
E2.p=E2.plugins.bool_display=function(t){this.desc="Displays the text 'True' or 'False' depending on the state of the supplied bool or '-', if no data is being received.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The input boolean to display.",def:null}],this.output_slots=[],this.label=null},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label.css("text-align","right"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label&&this.label.text(null===t?"-":t?"True":"False")};
E2.p=E2.plugins.ceiling_modulator=function(t){this.desc="Round <b>value</b> to the closest higher interger.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded result.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.ceil(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.clamp_modulator=function(t){this.desc="Emit a float <b>value</b> no less than <b>min</b> and no greater than <b>max</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be clipped.",def:0},{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum output value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum output value.",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits <b>min</b> <= <b>value</b> >= <b>max</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.min_value=0,this.max_value=1,this.output_val=0},E2.p.prototype.update_input=function(t,a){0===t.index?this.input_val=a:1===t.index?this.min_value=a:this.max_value=a},E2.p.prototype.update_state=function(){var t=this.min_value,a=this.max_value,e=this.input_val;if(t>a){var u=t;t=a,a=u}this.output_val=t>e?t:e>a?a:e},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.clamped_accumulate_modulator=function(t){this.desc="Every input <b>value</b> is accumulated in an internal buffer. The buffer value is not permitted to be smaller then <b>min</b> or larger than <b>max</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"A small value to be accumulated in an internal buffer.",def:0},{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum internal buffer value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum internal buffer value.",def:1},{name:"reset",dt:t.datatypes.FLOAT,desc:"Send a value to this slot to reset the accumulator to that value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The current value of the accumulation buffer.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=e,this.state.value+=this.value,this.state.value=this.state.value<this.lo?this.lo:this.state.value>this.hi?this.hi:this.state.value),1===t.index&&(this.lo=e),2===t.index&&(this.hi=e),3===t.index&&(this.state.value=e<this.lo?this.lo:e>this.hi?this.hi:e)},E2.p.prototype.update_output=function(){return this.state.value},E2.p.prototype.state_changed=function(t){t||(this.value=0,this.lo=0,this.hi=1)};
E2.p=E2.plugins.clock_generator=function(t){this.desc="Emits current absolute time in seconds.",this.input_slots=[],this.output_slots=[{name:"seconds",dt:t.datatypes.FLOAT,desc:"Current absolute time."}],this.core=t},E2.p.prototype.update_state=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.core.abs_t};
E2.p=E2.plugins.color_add_modulator=function(t){this.desc="Adds a constant value to all components of a color. Each channel is clipped to the range 0;1.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Input color.",def:t.renderer.color_white},{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be added to the R, G and B channels.",def:0}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Output color: R+V, G+V, B+V, A"}]},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1),this.output_color=vec4.createFrom(1,1,1,1),this.value=0},E2.p.prototype.update_input=function(t,o){0===t.index?this.color=o:this.value=o},E2.p.prototype.update_state=function(){for(var t=this.color,o=this.output_color,e=this.value,a=0;3>a;a++){var c=t[a]+e;o[a]=0>c?0:c>1?1:c}o[3]=t[4]},E2.p.prototype.update_output=function(){return this.output_color};
E2.p=E2.plugins.color_blend_modulator=function(o){this.desc="Color x-fader. Perform linear blend between two colors.",this.input_slots=[{name:"color A",dt:o.datatypes.COLOR,desc:"First color operand.",def:o.renderer.color_black},{name:"color B",dt:o.datatypes.COLOR,desc:"Second color operand.",def:o.renderer.color_black},{name:"mix",dt:o.datatypes.FLOAT,desc:"0: Emit pure color A\n1: Emit pure color B",lo:0,hi:1,def:.5}],this.output_slots=[{name:"color",dt:o.datatypes.COLOR,desc:"Linear mix of color A and B:\n\nA * (1 - mix) + B * mix"}]},E2.p.prototype.reset=function(){this.output_color=vec4.createFrom(0,0,0,1)},E2.p.prototype.update_input=function(o,t){0===o.index?this.color_a=t:1===o.index?this.color_b=t:this.mix=t},E2.p.prototype.update_state=function(){for(var o=this.mix,t=1-o,e=this.color_a,r=this.color_b,c=this.output_color,i=0;4>i;i++)c[i]=e[i]*o+r[i]*t},E2.p.prototype.update_output=function(){return this.output_color},E2.p.prototype.state_changed=function(o){o||(this.color_a=vec4.createFrom(0,0,0,1),this.color_b=vec4.createFrom(0,0,0,1),this.output_color=vec4.createFrom(0,0,0,1),this.mix=.5)};
E2.p=E2.plugins.color_display=function(t){this.desc="Displays the supplied color in a rectangle on the plugin.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Input color to be displayed.",def:t.renderer.color_white}],this.output_slots=[],this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.css=function(){var t={},s=this.color;return t["background-color"]="rgb("+Math.round(255*s[0])+", "+Math.round(255*s[1])+", "+Math.round(255*s[2])+")",t.opacity=""+s[3],t},E2.p.prototype.create_ui=function(){var t=make("span");return this.label=make("span"),t.css({background:"url('images/checkerboard.png')",border:"1px #aaa solid"}),this.label.html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.label.css(this.css()),t.append(this.label),t},E2.p.prototype.update_input=function(t,s){var o=this.color;o[0]=s[0],o[1]=s[1],o[2]=s[2],o[3]=s[3],this.label&&this.label.css(this.css())};
E2.p=E2.plugins.color_multiply_modulator=function(t){this.desc="Scale the RGB components of a color by a supplied factor.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Color to be modulated.",def:t.renderer.color_white},{name:"factor",dt:t.datatypes.FLOAT,desc:"Factor to scale the RGB components of the supplied color with.",def:1}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"Output color: R * V, G * V, B * V, A"}]},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1),this.output_color=vec4.createFrom(1,1,1,1),this.factor=1},E2.p.prototype.update_input=function(t,o){0===t.index?this.color=o:this.factor=o},E2.p.prototype.update_state=function(){for(var t=this.color,o=this.output_color,e=this.factor,r=0;3>r;r++){var c=t[r]*e;o[r]=0>c?0:c>1?1:c}o[3]=t[4]},E2.p.prototype.update_output=function(){return this.output_color};
!function(){var t=E2.plugins.color_picker=function(t){Plugin.apply(this,arguments),this.desc="Provides an intuitive way of picking arbitary colors via a hue slider and saturation / luminosity selection area.",this.input_slots=[],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The selected color.",def:t.renderer.color_white}],this.state={hue:0,sat:0,lum:1}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){E2.app.undoManager.begin("Pick color"),r._mouseDownValue={hue:r.state.hue,sat:r.state.sat,lum:r.state.lum}}function e(){console.log("up",r.state),r._mouseDownValue.hue!==r.state.hue&&r.undoableSetState("hue",r.state.hue,r._mouseDownValue.hue),r._mouseDownValue.sat!==r.state.sat&&r.undoableSetState("sat",r.state.sat,r._mouseDownValue.sat),r._mouseDownValue.lum!==r.state.lum&&r.undoableSetState("lum",r.state.lum,r._mouseDownValue.lum),E2.app.undoManager.end()}var o=this.c=make("div"),s=this.i=make("img"),u=this.s=make("img"),i=this.h=make("img"),a=this.hs=make("img"),r=this;o.css({width:"130px",height:"102px","margin-right":"10px",position:"relative"}),i.attr("src","/images/color_picker/hue.png"),i.attr("id","hue"),u.attr("src","/images/color_picker/select.gif"),u.attr("id","sel"),a.attr("src","/images/color_picker/hue-select.png"),a.attr("id","hue-sel"),s.attr("src","/images/color_picker/picker.png"),s.attr("id","img"),i.css({width:"14px",height:"100px",border:"1px solid #888",cursor:"crosshair","z-index":"100"}),a.css({position:"absolute",top:"0px",left:"114px",width:"20px",height:"5px",cursor:"crosshair","z-index":"101"}),u.css({width:"11px",height:"11px",cursor:"crosshair","z-index":"101",position:"absolute"}),s.css({width:"100px",height:"100px",border:"1px solid #888",cursor:"crosshair","z-index":"100","background-color":"#f00"}),o.append(s),o.append(u),o.append(i),o.append(a);var n=function(e,o,s,u){return function(i){t(),e.color_drag=!0,e.update_picker_ev(i,o,u,s)}}(this,o,s,u),p=function(t){return function(o){o.preventDefault(),t.color_drag=!1,e()}}(this),h=function(t,e,o,s){return function(u){t.update_picker_ev(u,e,s,o),t.color_clipped=t.clip(u,o)}}(this,o,s,u);u.mousedown(n),u.mouseup(p),u.mousemove(h),s.mousedown(n),s.mouseup(p),s.mousemove(h);var c=function(e,o,s,u,i){return function(a){t(),a.preventDefault(),e.hue_drag=!0,e.update_hue_ev(o,a,s,u,i)}}(this,o,s,i,a),l=function(t){return function(o){o.preventDefault(),t.hue_drag=!1,e()}}(this),d=function(t,e,o,s,u){return function(i){t.update_hue_ev(e,i,o,s,u),t.hue_clipped=t.clip(i,s)}}(this,o,s,i,a);return a.mousedown(c),a.mouseup(l),a.mousemove(d),i.mousedown(c),i.mouseup(l),i.mousemove(d),o},t.prototype.update_state=function(){this.update_value(this.c)},t.prototype.update_output=function(){return this.color},t.prototype.update_value=function(t){var e=this.state.sat,o=this.state.lum,s=[this.hue_rgb[0]/255,this.hue_rgb[1]/255,this.hue_rgb[2]/255],u=o*(1-e),i=function(t){return u+s[t]*o*e},a=function(t){return Math.floor(255*s[t])};s=[i(0),i(1),i(2)];var r=this.color?this.color:null;r&&r[0]===s[0]&&r[1]===s[1]&&r[2]===s[2]||(r[0]=s[0],r[1]=s[1],r[2]=s[2],this.updated=!0),t&&t.css("background-color","rgb("+a(0)+", "+a(1)+", "+a(2)+")")},t.prototype.update_picker_ev=function(t,e,o,s){if(t.preventDefault(),this.color_drag&&!this.color_clipped){var u=s.offset(),i=this.state;i.sat=(t.pageX-u.left)/100,i.lum=1-(t.pageY-u.top)/100,i.sat=i.sat<0?0:i.sat>1?1:i.sat,i.lum=i.lum<0?0:i.lum>1?1:i.lum,this.update_picker(e,o)}},t.prototype.update_picker=function(t,e){e.css("left",Math.floor(100*this.state.sat)-5),e.css("top",Math.floor(100*(1-this.state.lum))-5)},t.prototype.update_hue_ev=function(t,e,o,s,u){e.preventDefault(),this.hue_drag&&!this.hue_clipped&&(this.state.hue=(e.pageY-s.offset().top)/100,this.update_hue(t,o,s,u))},t.prototype.update_hue=function(t,e,o,s){for(var u=1-this.state.hue,i=0,a=[u+1/3,u,u-1/3],r=[0,0,0],n=0;3>n;n++){a[n]<0?a[n]+=1:a[n]>1&&(a[n]-=1);var p=a[n];r[n]=1>6*p?6*p:1>2*p?1:2>3*p?6*(2/3-p):i,r[n]=Math.floor(255*r[n])}if(this.hue_rgb=r,e&&e.css("background-color","rgb("+r[0]+", "+r[1]+", "+r[2]+")"),o&&s){var h=o.offset();s.css("left",h.left-e.offset().left),s.css("top",Math.floor(100*this.state.hue-2))}this.update_value(t)},t.prototype.clip=function(t,e){var o=e.offset();return t.pageX<o.left||t.pageX>o.left+e.width()||t.pageY<o.top||t.pageY>o.top+e.height()},t.prototype.state_changed=function(t){t?(this.update_hue(t,t.find("#img"),t.find("#hue"),t.find("#hue-sel")),this.update_picker(t,t.find("#sel"))):(this.hue_rgb=[255,0,0],this.hue_drag=!1,this.color_drag=!1,this.hue_clipped=!1,this.color_clipped=!1,this.color=vec4.createFrom(1,1,1,1),this.update_hue(null,null,null,null))}}();
E2.p=E2.plugins.concatenate_matrix_modulator=function(t){this.desc="Combine two matrices. Order is significant.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The first matrix operand.",def:t.renderer.matrix_identity},{name:"matrix",dt:t.datatypes.MATRIX,desc:"The second matrix operand.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Emits <b>first</b> * <b>second</b>."}]},E2.p.prototype.update_input=function(t,i){this.matrices[t.index]=i},E2.p.prototype.update_state=function(){var t=this.matrices;null!==t[0]&&null!==t[1]&&mat4.multiply(t[0],t[1],this.matrix)},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrices=[mat4.create(),mat4.create()],this.matrix=mat4.create(),mat4.identity(this.matrices[0]),mat4.identity(this.matrices[1]),mat4.identity(this.matrix))};
!function(){var t=E2.plugins.const_float_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a float constant specified in an input field. If an invalid string in entered, the field is reset to the previous value.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The currently entered value.",def:1}],this.state={val:1}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,e=this.$input=$('<input type="number" step="0.1" value="1.0" style="width: 50px;" />');return e.css("border","1px solid #999"),e.on("change",function(){var i=t.state.val,n=t.state.val;try{var a=parseFloat(e.val());isNaN(a)||(n=a)}catch(s){return}t.undoableSetState("val",n,i)}),this.etf=new ExpandableTextfield(this.node,e,7),this.ui=e,this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui},t.prototype.update_output=function(){return this.state.val},t.prototype.state_changed=function(t){t&&this.updateUi()},t.prototype.updateUi=function(){this.ui&&this.ui.val(""+this.state.val)}}();
!function(){var t=E2.plugins.const_text_generator=function(t){Plugin.apply(this,arguments),this.desc="Enter a constant text string.",this.input_slots=[],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The currently entered text.",def:"Empty string"}],this.state={text:"",width:0,height:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.updated=!0},t.prototype.create_ui=function(){var t=this,e=$('<textarea placeholder="Type text here" />');return e.css({"font-size":"8pt",border:"1px solid #999",margin:"0px","margin-top":"2px",padding:"2px"}),e.on("change",function(){t.undoableSetState("text",e.val(),t.state.text)}),e.mouseup(function(){var e=$(this);t.state.width=e.width(),t.state.height=e.height()}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui=e,this.ui},t.prototype.update_output=function(){return this.state.text},t.prototype.state_changed=function(){this.updateUi()},t.prototype.updateUi=function(){if(this.ui){var t=this.state;t.text&&(this.ui.val(t.text),t.width>0&&this.ui.css("width",t.width),t.height>0&&this.ui.css("height",t.height))}}}();
E2.p=E2.plugins.convert_bool_float_modulator=function(t){this.desc="Convert a bool to a float. True emits 1 and false 0.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Input boolean to be converted.",def:!1}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits 0 when the input is false and 1 otherwise.",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=e?1:0},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.convert_camera_matrices=function(e){this.desc="Extract the projection and view matrices from a camera.",this.input_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"The input camera to be split into constituent matrices.",def:e.renderer.camera_screenspace}],this.output_slots=[{name:"projection",dt:e.datatypes.MATRIX,desc:"The camera projection matrix.",def:e.renderer.matrix_identity},{name:"view",dt:e.datatypes.MATRIX,desc:"The camera view matrix.",def:e.renderer.matrix_identity}],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.camera=new Camera(this.gl)},E2.p.prototype.update_input=function(e,t){this.camera=t},E2.p.prototype.update_output=function(e){return 0===e.index?this.camera.projection:this.camera.view};
E2.p=E2.plugins.convert_color_hsla_modulator=function(t){this.desc="Create an RGBA color from hue, saturation and luminosity and alpha.",this.input_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The corresponding RGBA color.",def:t.renderer.color_black}],this.output_slots=[{name:"hue",dt:t.datatypes.FLOAT,desc:"The hue of the input <b>color</b>.",lo:0,hi:1,def:0},{name:"saturation",dt:t.datatypes.FLOAT,desc:"The saturation (color intensity) of the input <b>color</b>.",lo:0,hi:1,def:0},{name:"luminosity",dt:t.datatypes.FLOAT,desc:"The luminosity (brightness) of the input <b>color</b>.",lo:0,hi:1,def:0},{name:"alpha",dt:t.datatypes.FLOAT,desc:"The alpha of the input <b>color</b>.",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.hsla=vec4.createFrom(0,0,0,1),this.color=vec4.createFrom(0,0,0,1)},E2.p.prototype.update_input=function(t,o){this.color=o},E2.p.prototype.update_state=function(){var t=this.color;this.hsla[0]=this.hsla[1]=this.hsla[2]=0,this.hsla[3]=t[3];var o=Math.max(Math.max(t[0],t[1]),t[2]),e=Math.min(Math.min(t[0],t[1]),t[2]),a=.5*(e+o);if(!(0>=a)){var s=o-e,h=s;if(this.hsla[2]=a,h>0){h/=.5>=a?e+o:2-o-e;var i=(o-t[0])/s,n=(o-t[1])/s,r=(o-t[2])/s,l=0;l=t[0]==o?t[1]==e?5+r:1-n:t[1]==o?t[2]==e?1+i:3-r:t[0]==e?3+n:5-i,this.hsla[0]=l/6,this.hsla[1]=h}}},E2.p.prototype.update_output=function(t){return this.hsla[t.index]};
E2.p=E2.plugins.convert_color_rgba_modulator=function(e){this.desc="Convert a color to its individual RGBA components so they can be individually manipulated.",this.input_slots=[{name:"color",dt:e.datatypes.COLOR,desc:"Input color to be split.",def:e.renderer.color_white}],this.output_slots=[{name:"red",dt:e.datatypes.FLOAT,desc:"Red channel value.",def:1},{name:"green",dt:e.datatypes.FLOAT,desc:"Green channel value.",def:1},{name:"blue",dt:e.datatypes.FLOAT,desc:"Blue channel value.",def:1},{name:"alpha",dt:e.datatypes.FLOAT,desc:"Alpha channel value.",def:1}]},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.update_input=function(e,t){this.color=t},E2.p.prototype.update_output=function(e){return this.color[e.index]};
E2.p=E2.plugins.convert_float_bool_modulator=function(t){this.desc="Convert a float to a boolean. 0 is false, everything else is true.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input float to be converted.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits false when the input value is zero and true otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=0===e?!1:!0},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.convert_hsla_color_modulator=function(t){this.desc="Create an RGBA color from hue, saturation and luminosity and alpha.",this.input_slots=[{name:"hue",dt:t.datatypes.FLOAT,desc:"The hue of the output color.",lo:0,hi:1,def:1},{name:"saturation",dt:t.datatypes.FLOAT,desc:"The saturation (color intensity) of the output color.",lo:0,hi:1,def:1},{name:"luminosity",dt:t.datatypes.FLOAT,desc:"The luminosity (brightness) of the output color.",lo:0,hi:1,def:1},{name:"alpha",dt:t.datatypes.FLOAT,desc:"The alpha of the output color.",lo:0,hi:1,def:1}],this.output_slots=[{name:"color",dt:t.datatypes.COLOR,desc:"The corresponding RGBA color.",def:t.renderer.color_white}]},E2.p.prototype.reset=function(){this.hsla=vec4.createFrom(1,1,1,1),this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.update_input=function(t,o){this.hsla[t.index]=0>o?0:o>1?1:o},E2.p.prototype.update_state=function(){var t=this.hsla[1],o=this.hsla[2],e=this.color;if(e[3]=this.hsla[3],0===t)return void(e[0]=e[1]=e[2]=o);for(var a=this.hsla[0],s=.5>=o?o*(1+t):o+t-o*t,r=2*o-s,i=[a+1/3,a,a-1/3],h=0;3>h;h++){i[h]<0&&(i[h]+=1),i[h]>1&&(i[h]-=1);var n=i[h];e[h]=1>6*n?r+(s-r)*n*6:1>2*n?s:2>3*n?r+(s-r)*(2/3-n)*6:r}},E2.p.prototype.update_output=function(){return this.color};
E2.p=E2.plugins.convert_matrices_camera=function(e){this.desc="Create a new camera from a projection and view matrix.",this.input_slots=[{name:"projection",dt:e.datatypes.MATRIX,desc:"The projection matrix.",def:e.renderer.matrix_identity},{name:"view",dt:e.datatypes.MATRIX,desc:"The view matrix.",def:e.renderer.matrix_identity}],this.output_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"The resulting camera.",def:e.renderer.camera_screenspace}],this.gl=e.renderer.context},E2.p.prototype.update_input=function(e,t){0===e.index?this.camera.projection=t:this.camera.view=t},E2.p.prototype.update_output=function(){return this.camera},E2.p.prototype.state_changed=function(e){e||(this.camera=new Camera(this.gl))};
E2.p=E2.plugins.convert_oscilator_unit_modulator=function(t){this.desc="Rescales and offsets a number in the range -1;1 to the range 0;1.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The input value.",lo:-1,hi:1,def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The output value: (I + 1) / 2",lo:0,hi:1,def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){var u=.5*(e+1);this.value=0>u?0:u>1?1:u},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.convert_rgba_color_modulator=function(e){this.desc="Creates a new color from individual RGBA components.",this.input_slots=[{name:"red",dt:e.datatypes.FLOAT,desc:"Red channel value.",lo:0,hi:1,def:1},{name:"green",dt:e.datatypes.FLOAT,desc:"Green channel value.",lo:0,hi:1,def:1},{name:"blue",dt:e.datatypes.FLOAT,desc:"Blue channel value.",lo:0,hi:1,def:1},{name:"alpha",dt:e.datatypes.FLOAT,desc:"Alpha channel value.",lo:0,hi:1,def:1}],this.output_slots=[{name:"color",dt:e.datatypes.COLOR,desc:"The output color",def:e.renderer.color_white}]},E2.p.prototype.reset=function(){this.color=vec4.createFrom(1,1,1,1)},E2.p.prototype.update_input=function(e,t){this.color[e.index]=0>t?0:t>1?1:t},E2.p.prototype.update_output=function(){return this.color};
E2.p=E2.plugins.convert_string_float_modulator=function(t){this.desc="Convert a string to a float.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input string to be converted.",def:"0.0"}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The parsed float value of the input string or 0",def:0}],this.value=0},E2.p.prototype.reset=function(){this.value=!1},E2.p.prototype.update_input=function(t,e){this.value=0;try{this.value=parseFloat(e)}catch(o){}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.convert_vector_xyz_modulator=function(t){this.desc="Decompose a vector to its individual XYZ components so they can be manipulated individually.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector.",def:[0,0,0]}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The x-component.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The y-component.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"The z-component.",def:0}]},E2.p.prototype.reset=function(){this.value=[0,0,0]},E2.p.prototype.update_input=function(t,e){this.value=e},E2.p.prototype.update_output=function(t){return this.value[t.index]};
E2.p=E2.plugins.cos_modulator=function(t){this.desc="Cos(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"cos(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.cos(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.cosine_modulator=function(t){this.desc="Cosine oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits cos(<b>time</b> * 2pi)",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=Math.cos(2*this.time*Math.PI)},E2.p.prototype.update_output=function(){return this.result};
E2.p=E2.plugins.crypto_cw_get_balances=function(t){this.desc="Obtain information about the current balances of a CounterWallet address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:"Address of the wallet to query.",def:""}],this.output_slots=[{name:"balances",dt:t.datatypes.OBJECT,desc:"The CounterWallet response."}]},E2.p.prototype.update_input=function(t,e){if(0===t.index){if(this.address=e,""===this.address)return;var s='{"jsonrpc":"2.0","id":0,"method":"proxy_to_counterpartyd","params":{"method":"get_balances", "params":{"filters":{"field":"address","op":"==","value":"'+this.address+'"}}}}';$.ajax({url:"https://counterwallet.io/_api",type:"POST",data:s,cache:!1,success:function(t){return function(e){t.balances=e,t.updated=!0}}(this)})}},E2.p.prototype.update_state=function(){""===this.address&&(this.balances={})},E2.p.prototype.update_output=function(){return this.balances},E2.p.prototype.state_changed=function(t){t||(this.balances={},this.address="")};
E2.p=E2.plugins.crypto_dw_get_balances=function(t){this.desc="Obtain information about the current balances of a DogeWallet address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:"Address of the wallet to query.",def:""}],this.output_slots=[{name:"balances",dt:t.datatypes.OBJECT,desc:"The DogeWallet response."}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.address=e)},E2.p.prototype.update_state=function(){if(""===this.address)return void(this.balances={});var t='{"jsonrpc":"2.0","id":0,"method":"get_normalized_balances","params":{"addresses":["'+this.address+'"]}}';$.ajax({url:"https://wallet.dogeparty.io/_api",type:"POST",data:t,cache:!1,success:function(t){return function(e){t.balances=e,t.updated=!0}}(this)})},E2.p.prototype.update_output=function(){return this.balances},E2.p.prototype.state_changed=function(t){t||(this.balances={},this.address="")};
E2.p=E2.plugins.csg_cube_generator=function(t){this.desc="Create a CSG cube object.",this.input_slots=[{name:"center",dt:t.datatypes.VECTOR,desc:"The position of the cube.",def:[0,0,0]},{name:"radius",dt:t.datatypes.FLOAT,desc:"The size of the cube.",def:1}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.center=[0,0,0],this.radius=1,this.csg=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.center=e:this.radius=0>=e?1:e},E2.p.prototype.update_state=function(){this.csg=CSG.cube({center:this.center,radius:this.radius})},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_cylinder_generator=function(t){this.desc="Create a CSG cylinder object.",this.input_slots=[{name:"start",dt:t.datatypes.VECTOR,desc:"The start position of the cylinder.",def:[0,-1,0]},{name:"end",dt:t.datatypes.VECTOR,desc:"The end position of the cylinder.",def:[0,1,0]},{name:"radius",dt:t.datatypes.FLOAT,desc:"The size of the cylinder.",def:1},{name:"slices",dt:t.datatypes.FLOAT,desc:"The number of slices in the cylinder.",def:16}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.start=[0,-1,0],this.end=[0,1,0],this.radius=1,this.slices=16,this.csg=null},E2.p.prototype.update_input=function(t,s){0===t.index?this.start=s:1===t.index?this.end=s:2===t.index?this.radius=0>=s?1:s:this.slices=2>s?2:Math.floor(s)},E2.p.prototype.update_state=function(){this.csg=CSG.cylinder({start:this.start,end:this.end,radius:this.radius,slices:this.slices})},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_difference_modulator=function(t){this.desc="Calculate the difference of two CSG objects.",this.input_slots=[{name:"A",dt:t.datatypes.OBJECT,desc:"The first operand object.",def:null},{name:"B",dt:t.datatypes.OBJECT,desc:"The second operand object.",def:null}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.a=null,this.b=null,this.csg=null},E2.p.prototype.is_csg=function(t){return t instanceof CSG},E2.p.prototype.update_input=function(t,s){0===t.index?this.a=this.is_csg(s)?s:null:this.b=this.is_csg(s)?s:null},E2.p.prototype.update_state=function(){this.csg=this.a&&this.b?this.a.subtract(this.b):null},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_intersection_modulator=function(t){this.desc="Calculate the intersection of two CSG objects.",this.input_slots=[{name:"A",dt:t.datatypes.OBJECT,desc:"The first operand object.",def:null},{name:"B",dt:t.datatypes.OBJECT,desc:"The second operand object.",def:null}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.a=null,this.b=null,this.csg=null},E2.p.prototype.is_csg=function(t){return t instanceof CSG},E2.p.prototype.update_input=function(t,s){0===t.index?this.a=this.is_csg(s)?s:null:this.b=this.is_csg(s)?s:null},E2.p.prototype.update_state=function(){this.csg=this.a&&this.b?this.a.intersect(this.b):null},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_inverse_modulator=function(t){this.desc="Calculate the inverse of a CSG object.",this.input_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The object to calculate the inverse of.",def:null}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.object=null,this.csg=null},E2.p.prototype.update_input=function(t,e){this.object=e instanceof CSG?e:null},E2.p.prototype.update_state=function(){this.csg=this.object?this.object.inverse():null},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_sphere_generator=function(s){this.desc="Create a CSG sphere object.",this.input_slots=[{name:"center",dt:s.datatypes.VECTOR,desc:"The position of the sphere.",def:[0,0,0]},{name:"radius",dt:s.datatypes.FLOAT,desc:"The size of the sphere.",def:1},{name:"slices",dt:s.datatypes.FLOAT,desc:"The number of slices in the sphere.",def:16},{name:"stacks",dt:s.datatypes.FLOAT,desc:"The number of stacks in the sphere.",def:8}],this.output_slots=[{name:"csg",dt:s.datatypes.OBJECT,desc:"The resulting object."}],s.add_aux_script("csg/csg.js"),this.center=[0,0,0],this.radius=1,this.slices=16,this.stacks=8,this.csg=null},E2.p.prototype.update_input=function(s,t){0===s.index?this.center=t:1===s.index?this.radius=0>=t?1:t:2===s.index?this.slices=2>t?2:Math.floor(t):this.stacks=2>t?2:Math.floor(t)},E2.p.prototype.update_state=function(){this.csg=CSG.sphere({center:this.center,radius:this.radius,slices:this.slices,stacks:this.stacks})},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.csg_to_mesh_modulator=function(e){this.desc="Converts the supplied CSG object to a mesh.",this.input_slots=[{name:"csg",dt:e.datatypes.OBJECT,desc:"The CSG object to convert.",def:null}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The resulting mesh."}],e.add_aux_script("csg/csg.js"),this.gl=e.renderer.context,this.mesh=null,this.csg=null},E2.p.prototype.update_vertex_buffer=function(e,t,s){var o=this.mesh.vertex_buffers;s?(o.VERTEX||(o.VERTEX=new VertexBuffer(this.gl,VertexBuffer.vertex_type.VERTEX)),o.VERTEX.bind_data(s,this.gl.DRAW_DYNAMIC)):o.VERTEX=null},E2.p.prototype.update_input=function(e,t){0===e.index&&(this.csg=t instanceof CSG?t:null)},E2.p.prototype.update_state=function(){if(!this.csg)return void(this.mesh=null);for(var e=new Mesh(this.gl,this.gl.TRIANGLES),t=e.vertex_buffers,s=[],o=[],r=this.csg.polygons,n=0;n<r.length;n++){var p=r[n],h=p.vertices;s.push(h[0].pos.x,h[0].pos.y,h[0].pos.z),o.push(h[0].normal.x,h[0].normal.y,h[0].normal.z),s.push(h[1].pos.x,h[1].pos.y,h[1].pos.z),o.push(h[1].normal.x,h[1].normal.y,h[1].normal.z),s.push(h[2].pos.x,h[2].pos.y,h[2].pos.z),o.push(h[2].normal.x,h[2].normal.y,h[2].normal.z);for(var u=3;u<p.vertices.length;u++)s.push(h[0].pos.x,h[0].pos.y,h[0].pos.z),o.push(h[0].normal.x,h[0].normal.y,h[0].normal.z),s.push(h[u-1].pos.x,h[u-1].pos.y,h[u-1].pos.z),o.push(h[u-1].normal.x,h[u-1].normal.y,h[u-1].normal.z),s.push(h[u].pos.x,h[u].pos.y,h[u].pos.z),o.push(h[u].normal.x,h[u].normal.y,h[u].normal.z)}t.VERTEX=new VertexBuffer(this.gl,VertexBuffer.vertex_type.VERTEX),t.VERTEX.bind_data(s,this.gl.DRAW_DYNAMIC),t.NORMAL=new VertexBuffer(this.gl,VertexBuffer.vertex_type.NORMAL),t.NORMAL.bind_data(o,this.gl.DRAW_DYNAMIC),this.mesh=e,this.mesh.generate_shader(),this.vertex_count=s.length},E2.p.prototype.update_output=function(){return this.mesh};
E2.p=E2.plugins.csg_union_modulator=function(t){this.desc="Calculate the union of two CSG objects.",this.input_slots=[{name:"A",dt:t.datatypes.OBJECT,desc:"The first operand object.",def:null},{name:"B",dt:t.datatypes.OBJECT,desc:"The second operand object.",def:null}],this.output_slots=[{name:"csg",dt:t.datatypes.OBJECT,desc:"The resulting object."}],t.add_aux_script("csg/csg.js"),this.a=null,this.b=null,this.csg=null},E2.p.prototype.is_csg=function(t){return t instanceof CSG},E2.p.prototype.update_input=function(t,s){0===t.index?this.a=this.is_csg(s)?s:null:this.b=this.is_csg(s)?s:null},E2.p.prototype.update_state=function(){this.csg=this.a&&this.b?this.a.union(this.b):null},E2.p.prototype.update_output=function(){return this.csg};
E2.p=E2.plugins.cube_mesh_generator=function(e){this.desc="Create a cube mesh of unit size with normals and one set of UV-cordinates.",this.input_slots=[],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Cube mesh."}],this.gl=e.renderer.context,this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(e){if(!e){var t=this.gl;msg("Cube: Generating mesh."),this.mesh=new Mesh(t,t.TRIANGLES,null);var s=this.mesh.vertex_buffers.VERTEX=new VertexBuffer(t,VertexBuffer.vertex_type.VERTEX);s.bind_data([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]);var r=this.mesh.vertex_buffers.NORMAL=new VertexBuffer(t,VertexBuffer.vertex_type.NORMAL);r.bind_data([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]);var n=this.mesh.vertex_buffers.UV0=new VertexBuffer(t,VertexBuffer.vertex_type.UV0);n.bind_data([0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]);var h=this.mesh.index_buffer=new IndexBuffer(t);h.bind_data([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),this.mesh.generate_shader()}};
E2.p=E2.plugins.curve_interpolate_modulator=function(t){this.desc="Interpolates the keypoints of a curve JSON object over time and loops if the bounds of the keypoints are exceeded.",this.input_slots=[{name:"curve",dt:t.datatypes.OBJECT,desc:"The curve object to interpolate.",def:null},{name:"time",dt:t.datatypes.FLOAT,desc:"The time to use for interpolation.",def:0}],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR,desc:"The interpolated position.",def:[0,0,0]}]},E2.p.prototype.reset=function(){this.curve=null,this.time=0,this.vector=[0,0,0]},E2.p.prototype.update_input=function(t,e){if(0===t.index){var o="The supplied curve object is invalid: ";this.curve=null;for(var i=["count","x","y","z"],r=0;r<i.length;r++)if(!e.hasOwnProperty(i[r]))return void msg(o+'No "'+i[r]+'" property');i=["x","y","z"];for(var r=0;r<i.length;r++)if("[object Array]"!==Object.prototype.toString.call(e[i[r]]))return void msg(o+'The "'+i[r]+'" property is not an array');this.curve=e}else this.time=e},E2.p.prototype.update_state=function(){if(!this.curve)return void(this.x=this.y=this.z=0);var t=this.curve.count-1,e=Math.floor(this.time)%t,o=(e+1)%t,i=(e+2)%t,r=(e+3)%t,s=this.time%t-e,n=this.curve.x,p=this.curve.y,u=this.curve.z,c=.5*(n[i]-n[e]),h=.5*(n[r]-n[o]);this.vector[0]=n[o]+c*s+(3*(n[i]-n[o])-2*c-h)*s*s+(c+h+2*(-n[i]+n[o]))*s*s*s,c=.5*(p[i]-p[e]),h=.5*(p[r]-p[o]),this.vector[1]=p[o]+c*s+(3*(p[i]-p[o])-2*c-h)*s*s+(c+h+2*(-p[i]+p[o]))*s*s*s,c=.5*(u[i]-u[e]),h=.5*(u[r]-u[o]),this.vector[2]=u[o]+c*s+(3*(u[i]-u[o])-2*c-h)*s*s+(c+h+2*(-u[i]+u[o]))*s*s*s},E2.p.prototype.update_output=function(){return this.vector};
E2.p=E2.plugins.data_info_display=function(t){this.desc="Displays metrics about the input value and its type.",this.input_slots=[{name:"any",dt:t.datatypes.ANY,desc:"Input value to be analyzed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("pre"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){if(this.label){var e=function(t){return type=typeof t,"object"!==type||t?type:"null"},n=function(t,u,i,a){i=i||"  ","number"!==e(a)&&(a=1);var p=e(u);if("function"===p)return"";var l=i+t+"("+p+") :";if("object"===p){if(a>0){i+="  ";for(r in u){var r=n(r,u[r],i,a-1);l+="\n"+r}return l}return l+" ..."}return"null"===p?l+" null":l+" "+u};this.label[0].innerHTML=n("",t)}};
E2.p=E2.plugins.delta_modulator=function(t){this.desc="Emits the derivative of the incoming <b>value</b>.",this.input_slots=[{name:"reset",dt:t.datatypes.BOOL,desc:"Send true to this slot to clear the internal state.",def:!1},{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"delta",dt:t.datatypes.FLOAT,desc:"The delta value from the last frame update.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.last_val=0,this.output_val=0,this.clear=!1},E2.p.prototype.update_input=function(t,e){0===t.index?this.clear=e:1===t.index&&(this.input_val=e)},E2.p.prototype.update_state=function(){this.clear?(this.output_val=0,this.clear=!1):this.output_val=this.input_val-this.last_val,this.last_val=this.input_val},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.delta_t_generator=function(t){this.desc="Emits the current frame delta time in seconds.",this.input_slots=[],this.output_slots=[{name:"seconds",dt:t.datatypes.FLOAT,desc:"Last frame delta time in seconds."}],this.core=t},E2.p.prototype.update_state=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.core.delta_t};
!function(){var t=E2.plugins.depth_func_generator=function(t){Plugin.apply(this,arguments),this.desc="Select z-buffer depth compare function.",this.input_slots=[],this.output_slots=[{name:"func",dt:t.datatypes.FLOAT,desc:"Emits the selected depth function when requested or the selection state changes.",def:"Diffuse color"}],this.state={depth_func:Material.depth_func.LEQUAL}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=Material.depth_func,e=$("<select />",{selectedIndex:4});return $("<option />",{value:t.NEVER,text:"Never"}).appendTo(e),$("<option />",{value:t.LESS,text:"Less"}).appendTo(e),$("<option />",{value:t.EQUAL,text:"Equal"}).appendTo(e),$("<option />",{value:t.LEQUAL,text:"Less / equal"}).appendTo(e),$("<option />",{value:t.GREATER,text:"Greater"}).appendTo(e),$("<option />",{value:t.NOTEQUAL,text:"Not equal"}).appendTo(e),$("<option />",{value:t.GEQUAL,text:"Greater / equal"}).appendTo(e),$("<option />",{value:t.ALWAYS,text:"Always"}).appendTo(e),e.change(function(t){return function(){t.undoableSetState("depth_func",parseInt(e.val()),t.state.depth_func)}}(this)),e},t.prototype.update_output=function(){return this.state.depth_func},t.prototype.state_changed=function(t){t&&t.val(""+this.state.depth_func)}}();
E2.p=E2.plugins.divide_modulator=function(t){this.desc="Divides <b>value</b> by <b>scalar</b> and emits the result.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be divided.",def:0},{name:"scalar",dt:t.datatypes.FLOAT,desc:"Factor to divide <b>value</b> by.",lo:">0",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits <b>value</b> / <b>scalar</b>.",def:0}]},E2.p.prototype.reset=function(){this.value=0,this.scalar=1,this.result=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.scalar=1e-7>e?1:e},E2.p.prototype.update_state=function(){this.result=this.value/this.scalar},E2.p.prototype.update_output=function(){return this.result};
!function(){var t=E2.plugins.envelope_modulator=function(t){this.desc="Envelope modulator",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"X value to pick Y with",def:0}],this.output_slots=[{name:"y",dt:t.datatypes.FLOAT,desc:"The value at x",def:0}],this.x=this.value=0,this.state={points:[[0,0],[1,1]]},this._core=t,this.loaded=!1};t.prototype.create_ui=function(){var t=this;if(this._$ui)return this._$ui;var e=this._$ui=$('<div class="envelope-editor">');return this._loadScripts(function(){t._loaded=!0,t._redrawEditor()}),e},t.prototype.update_input=function(t,e){this.x=e%1},t.prototype.update_state=function(){for(var t,e,i=0,o=1,s=this.x,r=0;r<this.state.points.length;r++){var n=this.state.points[r];if(n[0]===s){t=e=n[1];break}if(n[0]<s)i=n[0],t=n[1];else if(n[0]>s){o=n[0],e=n[1];break}}this.value=(s-i)*(e-t)/(o-i)+t},t.prototype.update_output=function(){return this.value},t.prototype.state_changed=function(t){if(t){if(!this._loaded)return;console.log("EnvelopePlugin.state_changed, redrawing editor"),this._redrawEditor()}},t.prototype._redrawEditor=function(){var t=this;this._editor&&this._editor.destroy(),this._editor=new E2.EnvelopeEditor,this.editor.data(t.state.points).render($ui).on("changed",function(e){t.state.points=e,t.dirty=t.updated=!0})},t.prototype._loadScripts=function(t){var e=this;this._core.add_aux_script("d3/d3.v3.min.js",function(){e._core.add_aux_script("envelope/envelopeEditor.js",t)})}}();
E2.p=E2.plugins.equals_modulator=function(t,e){this.desc="Emits true if <b>value</b> equals <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Input value.",def:null},{name:"reference",dt:t.datatypes.ANY,desc:"Reference value to comprate <b>value</b> to.",def:null}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True if <b>value</b> equals <b>reference</b> and false otherwise.",def:!1}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[0],this.input_slots[1]],[]),this.value=null},E2.p.prototype.reset=function(){this.ref=null,this.state=!1},E2.p.prototype.connection_changed=function(t,e,s){this.lsg.connection_changed(t,e,s)&&(this.value=this.ref=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){this.state=null===this.value||null===this.ref?!1:this.value===this.ref},E2.p.prototype.update_output=function(){return this.state},E2.p.prototype.state_changed=function(t){t||(this.value=this.lsg.infer_dt())};
E2.p=E2.plugins.exp_modulator=function(t){this.desc="Exp(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"exp(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.exp(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.flat_shader=function(t){this.desc="Simple shader for rendering meshes with diffuse color only.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}];var i=t.renderer.context,e="attribute vec3 v_pos;uniform mat4 m_mat;uniform mat4 v_mat;uniform mat4 p_mat;void main(void) { gl_Position = p_mat * v_mat * m_mat * vec4(v_pos, 1.0); }",s="precision mediump float;uniform vec4 d_col;void main(void) { gl_FragColor = d_col; }";this.s=new ShaderProgram(i),this.vs=new Shader(i,i.VERTEX_SHADER,e),this.ps=new Shader(i,i.FRAGMENT_SHADER,s);var a=this.s.program;this.s.attach(this.vs),this.s.attach(this.ps),this.s.link(),this.s.v_pos=i.getAttribLocation(a,"v_pos"),this.s.m_mat=i.getUniformLocation(a,"m_mat"),this.s.v_mat=i.getUniformLocation(a,"v_mat"),this.s.p_mat=i.getUniformLocation(a,"p_mat"),this.s.d_col=i.getUniformLocation(a,"d_col"),this.s.bind_array=function(t,i){return function(e,s,a){e===VertexBuffer.vertex_type.VERTEX&&(i.bindBuffer(i.ARRAY_BUFFER,s),i.vertexAttribPointer(t.s.v_pos,a,i.FLOAT,!1,0,0))}}(this,i),this.s.apply_uniforms=this.apply_uniforms=function(t,i){return function(e){var s=t.material?t.material:e.material;i.uniform4fv(t.s.d_col,s.diffuse_color?s.diffuse_color:this.s),i.enableVertexAttribArray(t.s.v_pos),s.enable()}}(this,i),this.state_changed(null)},E2.p.prototype.update_input=function(t,i){0===t.index&&(this.material=i)},E2.p.prototype.update_output=function(){return this.s},E2.p.prototype.state_changed=function(t){t||(this.material=null)};
E2.p=E2.plugins.float_display=function(t){this.desc="Display the supplied float value on the plugin surface.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Input value to be displayed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label.css("text-align","right"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label&&(this.label[0].innerHTML=null===t?"-":t.toFixed(2))};
E2.p=E2.plugins.floor_modulator=function(t){this.desc="Round <b>value</b> to the closest lower interger.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded result.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.floor(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.format_string_float=function(t){this.desc="Formats a float as a string.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Input float to be formatted.",def:0},{name:"decimals",dt:t.datatypes.FLOAT,desc:"Number of decimals to output.",def:4}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The input float as a string.",def:"0.0"}]},E2.p.prototype.reset=function(){this.value=0,this.d_count=4,this.result="0.0"},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.d_count=Math.round(e)},E2.p.prototype.update_state=function(){this.result=this.value.toFixed(this.d_count)},E2.p.prototype.update_output=function(){return this.result};
!function(){var t=E2.plugins.from_mesh_custom_shader=function(t,e){Plugin.apply(this,arguments);var i=this;this.desc="Auto-generate a shader embedding user-defined main bodies tailored to correctly and optimally render the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Mesh to adapt the shader to.",def:null},{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}],this.state={vs_src:"",ps_src:""},this.core=t,this.node=e,this.gl=t.renderer.context,this.shader=null,this.slot_data={},this.node.on("slotAdded",function(t){i.slot_data[t.uid]=i.core.get_default_value(E2.slot_type.input,t.dt),i.updated=i.dirty=!0,i._refreshEditor()}),this.node.on("slotRemoved",function(){i.updated=i.dirty=!0,i._refreshEditor()})};t.prototype=Object.create(Plugin.prototype),t.prototype._refreshEditor=function(){var t=this;this._editors&&_.each(this._editors,function(e){e.setInputs(t.node.getDynamicInputSlots())})},t.prototype.destroy_ui=function(){var t=this;_.each(this._editors,function(e,i){e.close&&(e.close(),delete t._editors[i])})},t.prototype.create_ui=function(){function t(t){E2.app.graphApi.removeSlot(s.node.parent_graph,s.node,t)}function e(t,e){E2.app.graphApi.addSlot(s.node.parent_graph,s.node,{type:E2.slot_type.input,name:t,dt:e})}function i(i,o){if(s._editors[i])return void s._editors[i].show();var r=[i,"shader"].join(" ");s._editors[i]=E2.ShaderEditor.open(r,s.state[o],s.node.getDynamicInputSlots()).on("closed",function(){delete s._editors[i]}).on("inputRemoved",function(e,i){t(e,i)}).on("inputAdded",function(t,i){e(t,i)}).on("build",function(){s.updated=s.dirty=!0}).on("changed",function(t){t!==s.state[o]&&s.undoableSetState(o,t,s.state[o])}),s._editors[i].stateKey=o,s._editors[i]._ace}var s=this,o=make("div"),r=makeButton("Vertex","Click to edit the vertex shader source."),n=makeButton("Pixel","Click to edit the pixel shader source.");return this._editors={},r.css("width","55px"),n.css({width:"55px","margin-top":"5px"}),r.click(function(){i("vertex","vs_src")}),n.click(function(){i("pixel","ps_src")}),o.append(r),o.append(make("br")),o.append(n),o},t.prototype.connection_changed=function(t,e,i){t||i.type!==E2.slot_type.input||0===i.index&&(this.shader=null)},t.prototype.rebuild_shader=function(){function t(t){return function(e){if(a.updated=a.dirty=!1,a._editors&&a._editors[t]){var i=a._editors[t].getAce();i.getSession().clearAnnotations(),e&&i.getSession().setAnnotations(e)}}}var e,i,s=[],o=[],r=this.state,n=this.gl,d=this.core.datatypes,a=this;e=this.node.getDynamicInputSlots();for(var h=0;h<e.length;h++){var u="";i=e[h];var p=i.dt.id;p===d.FLOAT.id?u="float":p===d.TEXTURE.id?u="sampler2D":p===d.COLOR.id?u="vec4":p===d.MATRIX.id?u="mat4":p===d.VECTOR.id&&(u="vec3");var c="uniform "+u+" "+i.name+";";s.push(c),o.push(c)}if(this.shader=ComposeShader(null,this.mesh,this.material,s,o,r.vs_src,r.ps_src,t("vertex"),t("pixel")),this.shader.linked){for(e=this.node.getDynamicInputSlots(),h=0;h<e.length;h++)i=e[h],i.uniform=n.getUniformLocation(this.shader.program,i.name);this.shader.apply_uniforms_custom=function(){var t=1,i=a.slot_data,s=a.core.datatypes;e=a.node.getDynamicInputSlots();for(var o=0;o<e.length;o++){var r=e[o];if(r.uniform&&void 0!==i[r.uid]&&null!==i[r.uid]){var d=r.dt.id;d===s.FLOAT.id?n.uniform1f(r.uniform,i[r.uid]):d===s.TEXTURE.id?(n.uniform1i(r.uniform,t),i[r.uid].enable(n.TEXTURE0+t),t++):d===s.COLOR.id?n.uniform4fv(r.uniform,i[r.uid]):d===s.MATRIX.id?n.uniformMatrix4fv(r.uniform,!1,i[r.uid]):d===s.VECTOR.id&&n.uniform3fv(r.uniform,i[r.uid])}}}}""===r.vs_src&&(r.vs_src=this.shader.vs_c_src),""===r.ps_src&&(r.ps_src=this.shader.ps_c_src)},t.prototype.update_input=function(t,e){void 0===t.uid?0===t.index?this.mesh!==e&&(this.mesh=e,this.dirty=!0):1===t.index&&(this.material=e):this.slot_data[t.uid]=e},t.prototype.update_state=function(){if(this.mesh){var t=Material.get_caps_hash(this.mesh,this.material);if(!this.dirty&&this.caps_hash===t)return void(this.shader&&(this.shader.material=this.material));(this.dirty||this.caps_hash!==t)&&this.rebuild_shader(),this.caps_hash=t,this.updated=!0,this.dirty=!1}},t.prototype.update_output=function(){return this.shader},t.prototype.state_changed=function(t){t?this.core.add_aux_script("ace/src-noconflict/ace.js"):(this.mesh=null,this.material=null,this.caps_mask="",this.dirty=!1)}}();
E2.p=E2.plugins.from_mesh_shader=function(t){this.desc="Auto-generate a shader tailored to correctly and optimally render the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Mesh to adapt the shader to.",def:null},{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}],this.shader=null},E2.p.prototype.connection_changed=function(t,s,e){t||e.type!==E2.slot_type.input||0===e.index&&(this.shader=null)},E2.p.prototype.update_input=function(t,s){0===t.index?this.mesh!==s&&(this.mesh=s,this.dirty=!0):1===t.index&&(this.material=s)},E2.p.prototype.update_state=function(){if(this.mesh){var t=Material.get_caps_hash(this.mesh,this.material);if(!this.dirty&&this.caps_hash===t)return void(this.shader.material=this.material);(this.dirty||this.caps_hash!==t)&&(msg("Recomposing shader with caps: "+t),this.shader=ComposeShader(null,this.mesh,this.material,null,null,null,null)),this.caps_hash=t,this.updated=!0,this.dirty=!1}},E2.p.prototype.update_output=function(){return this.shader},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.material=null,this.caps_hash="",this.dirty=!0)};
E2.p=E2.plugins.gamepad_generator=function(t){function e(e,a){return{name:e,dt:a?t.datatypes.FLOAT:t.datatypes.BOOL,desc:e,def:a?0:!1}}this._core=t,this.desc="Buttons and axes from HTML5 standard gamepad (supports only Chrome and XBOX 360 controller atm).",this.input_slots=[{name:"pad number",dt:t.datatypes.FLOAT,desc:"Gamepad number",def:0}],this.output_slots=[e("button 0"),e("button 1"),e("button 2"),e("button 3"),e("left bumper"),e("right bumper"),e("left trigger",!0),e("right trigger",!0),e("select"),e("start"),e("left stick button"),e("right stick button"),e("D-pad top"),e("D-pad bottom"),e("D-pad left"),e("D-pad right"),e("extra"),e("left stick X",!0),e("left stick Y",!0),e("right stick X",!0),e("right stick Y",!0)],this._gamepadIndex=0},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){this._gamepadIndex=e},E2.p.prototype.update_output=function(t){function e(t){return"object"==typeof t?t.pressed:1===t}var a=navigator.getGamepads();if(!a)return 0;var n=a[this._gamepadIndex];return n?(this.updated=!0,t.index<17?this.output_slots[t.index].dt.id===this._core.datatypes.FLOAT.id?n.buttons[t.index].value:e(n.buttons[t.index]):n.axes[t.index-17]):0};
E2.p=E2.plugins.get_matrix_modulator=function(t){this.desc="Get matrix component.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Matrix to get component of.",def:t.renderer.matrix_identity},{name:"row",dt:t.datatypes.FLOAT,desc:"Row to get.",def:0},{name:"column",dt:t.datatypes.FLOAT,desc:"Column to get.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix."},{name:"value",dt:t.datatypes.FLOAT,desc:"The value.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.matrix=e:1===t.index?this.row=0>e?0:e>3?3:e:2===t.index&&(this.column=0>e?0:e>3?3:e)},E2.p.prototype.update_state=function(){this.value=this.matrix[4*this.row+this.column]},E2.p.prototype.update_output=function(t){return 0===t.index?this.matrix:this.value},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),mat4.identity(this.matrix),this.row=0,this.column=0,this.value=0)};
!function(){var e=E2.plugins.graph=function(e){SubGraphPlugin.apply(this,arguments),this.desc="Encapsulate a nested graph into- and out of which arbitrary data can be routed and the encapsulated logic of which can be optinally rendered to a <b>texture</b> instead of the framebuffer.",this.input_slots=[{name:"enabled",dt:e.datatypes.BOOL,desc:"En- or disable the processing of the nested graph logic.",def:!0}],this.output_slots=[{name:"texture",dt:e.datatypes.TEXTURE,desc:"When connected, all enclosed plugins will render to this texture instead of the framebuffer. Also, when connected two dynamic input slots will appear that allows control of the texture resolution.",def:"Render to framebuffer"}],this.state={enabled:!0,always_update:!0,rt_width:512,rt_height:512,rt_filter:e.renderer.context.LINEAR,input_sids:{},output_sids:{}},this.is_reset=!0,this.framebuffer=null,this.texture=null,this.renderbuffer=null};e.prototype=Object.create(SubGraphPlugin.prototype),e.prototype.getWidth=function(){return parseFloat(this.framebuffer.width)},e.prototype.getHeight=function(){return parseFloat(this.framebuffer.height)},e.prototype.open_editor=function(e){var t=make("div"),r=$('<input id="always_upd" type="checkbox" title="If false, this graph is updated only when one of its inputs updates." />'),a=$("<select />"),i=$("<select />"),s=$("<select />"),n=$("<div>Always update:</div>"),f=$("<div>Texture width:</div>"),h=$("<div>Texture height:</div>"),d=$("<div>Texture filtering:</div>"),p=make("div"),u=make("div"),o=make("div"),l=make("div"),c=this.gl,_={"font-size":"14px","float":"left",padding:"8px 0px 2px 2px"},b={"float":"right",margin:"2px",padding:"2px",width:"70px"};t.css({margin:"0px",padding:"2px"});for(var E=1;13>E;E++){var g=Math.pow(2,E);$("<option />",{value:g,text:""+g}).appendTo(a),$("<option />",{value:g,text:""+g}).appendTo(i)}$("<option />",{value:c.NEAREST,text:"Nearest"}).appendTo(s),$("<option />",{value:c.LINEAR,text:"Linear"}).appendTo(s),s.val(e.state.rt_filter),p.css("clear","both"),u.css("clear","both"),o.css("clear","both"),l.css("clear","both"),l.addClass("clearfix"),r.css(b),a.css(b),i.css(b),s.css(b),n.css(_),f.css(_),h.css(_),d.css(_),r.css({width:"13px","margin-top":"8px"}),r.attr("checked",e.state.always_update),a.val(e.state.rt_width),i.val(e.state.rt_height),p.append(n),p.append(r),t.append(p),t.append(make("br")),u.append(f),u.append(a),t.append(u),t.append(make("br")),o.append(h),o.append(i),t.append(o),t.append(make("br")),l.append(d),l.append(s),t.append(l);var m=function(e,t,r,a,i){return function(){e.state.always_update=t.is(":checked");var s=r.val(),n=a.val(),f=i.val(),h=e.state.rt_width!==s||e.state.rt_height!==n||e.state.rt_filter!==f;e.state.rt_width=s,e.state.rt_height=n,e.state.rt_filter=f,e.framebuffer&&h&&(e.delete_framebuffer(),e.set_render_target_state(!0))}};e.core.create_dialog(t,"Edit Preferences.",460,250,m(e,r,a,i,s))},e.prototype.create_ui=function(){var e=make("div"),t=makeButton("Edit","Open this graph for editing.");return t.click(function(e){return function(){if(e.graph){var t=e.graph.parent_graph.tree_node;t.open||(t.graph.open=!0,t.rebuild_dom()),e.graph.tree_node.activate()}}}(this)),e.css("text-align","center"),e.append(t),this.ui=e,e},e.prototype.delete_framebuffer=function(){var e=this.gl;this.framebuffer&&e.deleteFramebuffer(this.framebuffer),this.renderbuffer&&e.deleteRenderbuffer(this.renderbuffer),this.texture&&this.texture.drop(),this.framebuffer=null,this.renderbuffer=null,this.texture=null},e.prototype.set_render_target_state=function(e){var t=this.gl;if(e){this.framebuffer=t.createFramebuffer(),this.framebuffer.width=this.state.rt_width,this.framebuffer.height=this.state.rt_height,t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer);var r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.state.rt_filter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.state.rt_filter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.framebuffer.width,this.framebuffer.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.framebuffer.width,this.framebuffer.height),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.renderbuffer),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),this.texture=new Texture(this.core.renderer,r,this.state.rt_filter),this.texture.width=this.framebuffer.width,this.texture.height=this.framebuffer.height,this.texture.framebuffer=this.framebuffer}else{for(var a=!1,i=this.parent_node.outputs,s=0,n=i.length;n>s;s++){var f=i[s].src_slot;if(void 0===f.uid&&f.type===E2.slot_type.output){a=!0;break}}a||this.delete_framebuffer()}},e.prototype.update_input=function(e,t){if(void 0===e.uid){if(0===e.index)if(this.state.enabled=t,t)this.is_reset=!1;else if(this.graph&&!this.is_reset&&(this.is_reset=!0,this.graph===E2.app.player.core.active_graph&&this.ui)){for(var r=this.core,a=this.graph.connections,i=0,s=a.length;s>i;i++)a[i].ui.flow=!1;this.graph===r.active_graph&&r.app&&r.app.updateCanvas(!1)}}else this.input_nodes[e.uid].plugin.input_updated(t)},e.prototype.update_state=function(){if(this.updated=!1,this.updated_sids.length=0,this.graph&&this.state.enabled){if(this.framebuffer){var e=this.gl;this.core.renderer.push_framebuffer(this.framebuffer,this.framebuffer.width,this.framebuffer.height),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}this.graph.update()&&this.graph===E2.app.player.core.active_graph&&E2.app.updateCanvas(!1),this.framebuffer&&this.core.renderer.pop_framebuffer()}},e.prototype.state_changed=function(e){var t=(this.core,this.parent_node),r=this;if(e){t.ui.dom.addClass("graph");var a=makeButton(null,"Edit preferences.","config_btn");return a.click(function(){r.open_editor(r)}),void $(t.ui.dom[0].children[0].children[0].children[0]).append(a)}this.setupProxies();for(var i=t.outputs,s=0,n=i.length;n>s;s++){var f=i[s];if(f.src_node===t&&void 0===f.src_slot.uid&&0===f.src_slot.index){this.set_render_target_state(!0);break}}}}();
E2.p=E2.plugins.grid_mesh_generator=function(t){this.desc="Create a planar grid mesh in the XY-plane of unit size.",this.input_slots=[{name:"x res",dt:t.datatypes.FLOAT,desc:"X resolution.",lo:2,hi:250,def:10},{name:"y res",dt:t.datatypes.FLOAT,desc:"Y resolution.",lo:2,hi:250,def:10}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Grid mesh."}],this.gl=t.renderer.context,this.state={x_res:10,y_res:10},this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(t,e){var s=Math.floor(e);2>s||(s=s>250?250:s,0===t.index&&this.state.x_res!==s?(this.state.x_res=s,this.dirty=!0):1===t.index&&this.state.y_res!==s&&(this.state.y_res=s,this.dirty=!0))},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var t=this.gl;this.mesh=new Mesh(t,t.LINES,null);for(var e=[],s=0;s<this.state.y_res+1;s++){var r=s/(this.state.y_res/2)-1;e.push(-1),e.push(r),e.push(0),e.push(1),e.push(r),e.push(0)}for(var h=0;h<this.state.x_res+1;h++){var r=h/(this.state.x_res/2)-1;e.push(r),e.push(-1),e.push(0),e.push(r),e.push(1),e.push(0)}(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(t,VertexBuffer.vertex_type.VERTEX)).bind_data(e),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(t){t||this.generate_mesh()};
E2.p=E2.plugins.gte_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is larger than or equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is larger than or equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value>=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.if_else_modulator=function(t,e){this.desc="Emits <b>true value</b> if <b>condition</b> is true and <b>false value</b> otherwise. The output only updates when the <b>condition</b> or relavant input value does. Any incoming data-flow to the value slot excluded by <b>condition</b> does not result in data emission.",this.input_slots=[{name:"condition",dt:t.datatypes.BOOL,desc:"Send true to route <b>true value</b> to the output and false to route <b>false value</b>.",def:!1},{name:"true value",dt:t.datatypes.ANY,desc:"Value to be send to output if <b>condition</b> is true",def:null},{name:"false value",dt:t.datatypes.ANY,desc:"Value to be send to output if <b>condition</b> is false",def:null}],this.output_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Emits <b>true value</b> if <b>condition</b> is true and <b>false value</b> otherwise.",def:"False value"}],this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[1],this.input_slots[2]],[this.output_slots[0]]),this.yes=this.no=null,this.initial_run=!0},E2.p.prototype.reset=function(){this.initial_run=!0,delete this.input_slots[1].inactive,delete this.input_slots[2].inactive},E2.p.prototype.connection_changed=function(t,e,i){this.lsg.connection_changed(t,e,i)&&(this.yes=this.no=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,e){0===t.index?(this.condition=e,this.initial_run?this.initial_run=!1:(delete this.input_slots[this.condition?1:2].inactive,this.input_slots[this.condition?2:1].inactive=!0)):1===t.index?this.yes=e:this.no=e},E2.p.prototype.update_output=function(){return this.condition?this.yes:this.no},E2.p.prototype.state_changed=function(t){t||(this.yes=this.no=this.lsg.infer_dt())};
E2.p=E2.plugins.if_modulator=function(t,i){this.desc="Allows <b>value</b> though if <b>condition</b> is true and inhibits futher data-flow otherwise.",this.input_slots=[{name:"condition",dt:t.datatypes.BOOL,desc:"Condition that, if true, allows <b>value</b> to be emitted.",def:!1},{name:"value",dt:t.datatypes.ANY,desc:"Value to be emitted if <b>condition</b> is true.",def:null}],this.output_slots=[{name:"value",dt:t.datatypes.ANY,desc:"Emits <b>value</b> if <b>condition</b> is true and nothing otherwise."}],this.lsg=new LinkedSlotGroup(t,i,[this.input_slots[1]],[this.output_slots[0]]),this.value=null},E2.p.prototype.connection_changed=function(t,i,e){this.lsg.connection_changed(t,i,e)&&(this.value=this.lsg.core.get_default_value(this.lsg.dt))},E2.p.prototype.update_input=function(t,i){0===t.index?(this.condition=i,this.condition?delete this.input_slots[1].inactive:this.input_slots[1].inactive=!0):this.value=i},E2.p.prototype.update_output=function(){return this.value},E2.p.prototype.state_changed=function(t){t||(this.value=this.lsg.infer_dt())};
E2.p=E2.plugins.initialise_generator=function(t){this.desc="Emits true the first frame after playback is started, then false for one frame and stop emitting. Can be used to run initialisation logic on the first frame of playback only.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true on first frame of playback, then false for one frame, then stops emitting."}],this.core=t,this.st=[!1,!1],this.val=!1},E2.p.prototype.stop=function(){this.st[0]=this.st[1]=!0},E2.p.prototype.update_state=function(){this.val=this.st[0]&&this.st[1],this.updated=this.st[0],this.st[0]=this.st[1],this.st[1]=!1},E2.p.prototype.update_output=function(){return this.val};
!function(){var t=E2.plugins.input_proxy=function(t,e){this.desc="Create a new type-less slot to route data into the current graph from its parent. When connected to a slot, it will assume its type until disconnected. Renaming this plugin will rename the corresponding parent slot.",this.input_slots=[],this.output_slots=[],e.add_slot(E2.slot_type.output,{name:"input",dt:t.datatypes.ANY,desc:"Connect this to a slot of any type, to have the parent slot assume its datatype and forward data from the parent graph."}),this.core=t,this.node=e,this.data=null,e.title||(e.title="input")};t.prototype.reset=function(){this.updated=!0},t.prototype.input_updated=function(t){this.data=t,this.updated=!0},t.prototype.connection_changed=function(t,e,n){var o=this.node.parent_graph.plugin;o&&o.proxy_connection_changed(t,this.node,e.dst_node,n,e.dst_slot)},t.prototype.update_output=function(){return this.data},t.prototype.state_changed=function(t){t&&this.node.ui.dom.addClass("proxy")}}();
E2.p=E2.plugins.instance_array_modulator=function(t){this.desc="Create a scene that represents <b>count</b> instances of the supplied <b>mesh</b>, starting at position <b>start</b>, offset by <b>delta</b> each instance.",this.input_slots=[{name:"count",dt:t.datatypes.FLOAT,desc:"The number of instances to create.",lo:0,def:1},{name:"mesh",dt:t.datatypes.MESH,desc:"The mesh to instantiate.",def:null},{name:"start",dt:t.datatypes.VECTOR,desc:"The starting position.",def:t.renderer.vector_origin},{name:"offset",dt:t.datatypes.VECTOR,desc:"The offset vector.",def:t.renderer.vector_origin}],this.output_slots=[{name:"scene",dt:t.datatypes.SCENE,desc:"Scene representing <b>count</b> instances."}],this.gl=t.renderer.context},E2.p.prototype.update_input=function(t,e){if(0===t.index)this.count=e;else if(1===t.index){var s=this.scene=new Scene(this.gl,null,null);e&&(s.meshes=[e],s.vertex_count=e.vertex_count)}else 2===t.index?this.start=e:this.offset=e},E2.p.prototype.update_state=function(){var t=this.scene;if(!(t.meshes.length<1)){for(var e=t.meshes[0],s=this.start,n=this.offset,a=[],i=s.slice(0),o=0;o<this.count;o++){var r=mat4.create();mat4.identity(r),mat4.translate(r,i),a.push(r),i[0]+=n[0],i[1]+=n[1],i[2]+=n[2]}e.instances=a}},E2.p.prototype.update_output=function(){return this.scene},E2.p.prototype.state_changed=function(t){t||(this.scene=new Scene(this.gl,null,null),this.count=1,this.start=[0,0,0],this.offset=[0,0,0])};
E2.p=E2.plugins.instance_cube_modulator=function(t){this.desc="Create a scene that represents <b>count</b>^3 instances of the supplied <b>mesh</b>, starting at position <b>start</b> and forming an axis-aligned cube of instances, with each offset according to <b>offset</b> on each axis separately.",this.input_slots=[{name:"count",dt:t.datatypes.VECTOR,desc:"The cube root of the number of instances to create.",lo:0,def:1},{name:"mesh",dt:t.datatypes.MESH,desc:"The mesh to instantiate.",def:null},{name:"start",dt:t.datatypes.VECTOR,desc:"The starting position for one cube corner.",def:t.renderer.vector_origin},{name:"offset",dt:t.datatypes.VECTOR,desc:"The axis-offset for each instance.",def:t.renderer.vector_origin}],this.output_slots=[{name:"scene",dt:t.datatypes.SCENE,desc:"Scene representing <b>count</b>^3 instances."}],this.gl=t.renderer.context},E2.p.prototype.update_input=function(t,e){if(0===t.index)this.count=e;else if(1===t.index){var s=this.scene=new Scene(this.gl,null,null);e&&(s.meshes=[e],s.vertex_count=e.vertex_count)}else 2===t.index?this.start=e:this.offset=e},E2.p.prototype.update_state=function(){var t=this.scene;if(!(t.meshes.length<1)){for(var e=t.meshes[0],s=this.start,n=this.offset,a=[],o=s.slice(0),i=Math.round(this.count[0]),r=Math.round(this.count[1]),c=Math.round(this.count[2]),h=0;i>h;h++){o[1]=s[1];for(var u=0;r>u;u++){o[2]=s[2];for(var d=0;c>d;d++){var f=mat4.create();mat4.identity(f),mat4.translate(f,o),a.push(f),o[2]+=n[2]}o[1]+=n[1]}o[0]+=n[0]}e.instances=a}},E2.p.prototype.update_output=function(){return this.scene},E2.p.prototype.state_changed=function(t){t||(this.scene=new Scene(this.gl,null,null),this.count=[1,0,1],this.start=[0,0,0],this.offset=[0,0,0])};
E2.p=E2.plugins.instance_ifs_modulator=function(e){this.desc="Create a scene that represents <b>count</b> instances of the supplied <b>mesh</b>, starting at position <b>start</b>, offset by <b>delta</b> each instance.",this.input_slots=[{name:"recursion depth",dt:e.datatypes.FLOAT,desc:"Level to resurse to.",lo:1,hi:6,def:1},{name:"level resolution",dt:e.datatypes.FLOAT,desc:"Number of instances per recursion level.",lo:1,hi:4,def:1},{name:"mesh",dt:e.datatypes.MESH,desc:"The mesh to instantiate.",def:null},{name:"level transform",dt:e.datatypes.MATRIX,desc:"Transform applied between branches.",def:e.renderer.matrix_identity},{name:"branch transform",dt:e.datatypes.MATRIX,desc:"Transform applied between instances on the same level.",def:e.renderer.matrix_identity}],this.output_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"Scene representing the resulting IFS."}],this.gl=e.renderer.context},E2.p.prototype.update_input=function(e,t){if(0===e.index&&(this.r_depth=t),1===e.index)this.l_res=t;else if(2===e.index){var s=this.scene=new Scene(this.gl,null,null);t&&(s.meshes=[t],s.vertex_count=t.vertex_count)}else 3===e.index?this.l_transform=t:4===e.index&&(this.b_transform=t)},E2.p.prototype.update_state=function(){var e=this.scene;if(!(e.meshes.length<1)){var t=e.meshes[0],s=function(e,t,n,r){if(r!==e.r_depth){for(var a=0;a<e.l_res;a++)t.push(mat4.create(n)),mat4.multiply(n,e.b_transform);mat4.multiply(n,e.l_transform),s(e,t,n,r+1)}},n=[],r=mat4.create();mat4.identity(r),s(this,n,r,0),t.instances=n}},E2.p.prototype.update_output=function(){return this.scene},E2.p.prototype.state_changed=function(e){e||(this.scene=new Scene(this.gl,null,null),this.r_depth=1,this.l_res=1,this.l_transform=mat4.create(),this.b_transform=mat4.create(),mat4.identity(this.l_transform),mat4.identity(this.b_transform))};
E2.p=E2.plugins.invert_matrix_modulator=function(t){this.desc="Emits the inverse of the supplied <b>matrix</b>.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be inverted.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"inverse",dt:t.datatypes.MATRIX,desc:"Emits the inverse of the input <b>matrix</b>.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),this.inverse=mat4.create(),mat4.identity(this.matrix),mat4.identity(this.inverse)},E2.p.prototype.update_input=function(t,e){this.matrix=e},E2.p.prototype.update_state=function(){mat4.inverse(this.matrix,this.inverse)},E2.p.prototype.update_output=function(){return this.inverse};
!function(){var t=E2.plugins.key_press_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits true on the next update after the key matching the set filter has been pressed and false once after it has been released.",this.input_slots=[],this.output_slots=[{name:"signal",dt:t.datatypes.BOOL,desc:"Emits true once when the set key is pressed."}],this.state={key:0,type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.update_output=function(){return this.key_state},t.prototype.create_ui=function(){for(var t=this,e=[[-1,"[Pick a key]"],[8,"Backspace"],[9,"Tab"],[13,"Enter"],[32,"Space"],[33,"Page up"],[34,"Page down"],[35,"End"],[36,"Home"],[37,"Left arrow"],[38,"Up arrow"],[39,"Right arrow"],[40,"Down arrow"],[45,"Insert"],[46,"Delete"],[48,"0"],[49,"1"],[50,"2"],[51,"3"],[52,"4"],[53,"5"],[54,"6"],[55,"7"],[56,"8"],[57,"9"],[65,"a"],[66,"b"],[67,"c"],[68,"d"],[69,"e"],[70,"f"],[71,"g"],[72,"h"],[73,"i"],[74,"j"],[75,"k"],[76,"l"],[77,"m"],[78,"n"],[79,"o"],[80,"p"],[81,"q"],[82,"r"],[83,"s"],[84,"t"],[85,"u"],[86,"v"],[87,"w"],[88,"x"],[89,"y"],[90,"z"]],a=make("div"),s=$('<select id="key" title="Select key" />',{selectedIndex:0}),n=$('<select id="o_type" title="Select output signal type" />',{selectedIndex:0}),o=0,p=e.length;p>o;o++){var i=e[o];$("<option />",{value:i[0],text:i[1]}).appendTo(s)}return $("<option />",{value:0,text:"Impulse"}).appendTo(n),$("<option />",{value:1,text:"Continuous"}).appendTo(n),s.change(function(){t.undoableSetState("key",parseInt(s.val()),t.state.key)}),n.change(function(){t.undoableSetState("type",parseInt(n.val()),t.state.type)}),s.css("width","100px"),n.css("width","100px"),a.append(s),a.append(make("br")),a.append(n),a},t.prototype.key_down=function(t){return function(e){e.originalEvent.keyCode===t.state.key&&(t.key_state=!0,t.updated=!0)}},t.prototype.key_up=function(t){return function(e){e.originalEvent.keyCode===t.state.key&&(t.key_state=!1,t.updated=!0)}},t.prototype.reset_keystate=function(){this.last_state=this.key_state=!1},t.prototype.update_state=function(){0===this.state.type&&this.key_state===this.last_state&&(this.updated=!1),this.last_state=this.key_state},t.prototype.state_changed=function(t){t?(t.find("#key").val(this.state.key),t.find("#o_type").val(this.state.type)):(this.reset_keystate(),$(document).keydown(this.key_down(this)),$(document).keyup(this.key_up(this)))}}();
!function(){var t=E2.plugins.knob_float_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a user controllable float value between 0 and 1.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits the current value when the knob is adjusted.",lo:0,hi:1,def:0}],this.state={val:0},this.knob=null};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.set_rotation=function(){var t="rotate("+Math.floor(270*this.state.val)+"deg)";this.knob.css({transform:t,"-moz-transform":t,"-webkit-transform":t})},t.prototype.create_ui=function(){var t=this,e=make("div");this.knob=make("div");var o=function(e){return function(o){return document.removeEventListener("mouseup",e.mouseup),document.removeEventListener("mousemove",e.mousemove),t.undoableSetState("val",t.state.val,t._mouseDownValue),o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),!1}},n=function(t,e){return function(o){var n=o.pageY-e.last_y,a=t.state.val;return e.last_y=o.pageY,t.state.val-=.01*n,t.state.val=t.state.val<0?0:t.state.val>1?1:t.state.val,t.state.val!==a&&(t.set_rotation(),t.updated=!0),o.stopPropagation&&o.stopPropagation(),o.preventDefault&&o.preventDefault(),!1}},a=function(t){return function(e){t._mouseDownValue=t.state.val;var a={last_y:e.pageY};return a.mouseup=o(a),a.mousemove=n(t,a),document.addEventListener("mouseup",a.mouseup),document.addEventListener("mousemove",a.mousemove),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1}};return e.css({width:"32px",height:"32px","z-index":"3000",background:"url('/images/knob/shadow.png')"}),this.knob.css({width:"32px",height:"32px","z-index":"3001",background:"url('/images/knob/knob.png')"}),e.append(this.knob),this.knob[0].addEventListener("mousedown",a(this)),this.ui=this.knob,this.node.on("pluginStateChanged",this.updateUi.bind(this)),e},t.prototype.update_output=function(){return this.state.val},t.prototype.updateUi=function(){this.ui&&this.set_rotation()}}();
!function(){var t=E2.plugins.label_generator=function(t,e){Plugin.apply(this,arguments),this.desc="Emits a string specified in an input field.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.TEXT,desc:"The currently entered text."}],this.state={text:""},this.core=t,this.node=e};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=$('<input type="text" value="1.0" style="width: 50px;" />');return t.css("border","1px solid #999"),t.change(function(e){return function(){e.undoableSetState("text",t.val(),e.state.text)}}(this)),this.etf=new ExpandableTextfield(this.node,t,7),t},t.prototype.update_output=function(){return this.state.text},t.prototype.state_changed=function(t){t&&t.val(""+this.state.text)}}();
E2.p=E2.plugins.led_display=function(t){this.desc="Displays the supplied normalised float value as a red LED, with a 8 bit color granularity.",this.input_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Normalised input value.",lo:0,hi:1,def:0}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(0)},E2.p.prototype.create_ui=function(){return this.label=make("span"),this.label.html("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"),this.update_value(0),this.label},E2.p.prototype.update_input=function(t,s){this.update_value(0>s?0:s>1?1:s)},E2.p.prototype.update_value=function(t){this.label&&this.label.css("background-color","rgb("+Math.round(255*t)+", 40, 40)")};
E2.p=E2.plugins.less_than_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is less than <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to compare.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is less than <b>reference</b> and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value<this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.light_clone_modulator=function(t){this.desc="Makes a physical copy of the input light reference, to allow side-effect free light chain branching.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light reference.",def:t.renderer.light_default}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The cloned light."}]},E2.p.prototype.update_input=function(t,i){var e=this.light;e.type=i.type,e.diffuse_color=vec4.create(i.diffuse_color),e.specular_color=vec4.create(i.specular_color),e.position[0]=i.position[0],e.position[1]=i.position[1],e.position[2]=i.position[2],e.direction[0]=i.direction[0],e.direction[1]=i.direction[1],e.direction[2]=i.direction[2],e.intensity=i.intensity},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light)};
E2.p=E2.plugins.light_diffuse_color_modulator=function(t){this.desc="Sets the diffuse color of the light source.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"color",dt:t.datatypes.COLOR,desc:"The light diffuse color.",def:t.renderer.color_white}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.light=e:this.color=e},E2.p.prototype.update_state=function(){this.light.diffuse_color=this.color},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.color=vec4.createFrom(1,1,1,1))};
E2.p=E2.plugins.light_direction_modulator=function(t){this.desc="Sets the direction normal of the light source to a given vector. The user is responsible for ensuring the normalization of the input vector.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"direction",dt:t.datatypes.VECTOR,desc:"The light direction. Should be normalized.",def:[0,-1,0]}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,i){0===t.index?this.light=i:this.direction=i},E2.p.prototype.update_state=function(){this.light.direction=this.direction},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.direction=[0,-1,0])};
E2.p=E2.plugins.light_intensity_modulator=function(t){this.desc="Sets the intensity of the light source to a given factor.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"intensity",dt:t.datatypes.FLOAT,desc:"The light intensity.",def:1,lo:0}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,i){0===t.index?this.light=i:this.intensity=0>i?0:i},E2.p.prototype.update_state=function(){this.light.intensity=this.intensity},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.intensity=1)};
E2.p=E2.plugins.light_position_modulator=function(t){this.desc="Sets the position of the light source to a given vector.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"position",dt:t.datatypes.VECTOR,desc:"The light position.",def:[0,1,0]}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,i){0===t.index?this.light=i:this.position=i},E2.p.prototype.update_state=function(){this.light.position=this.position},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.position=[0,1,0])};
E2.p=E2.plugins.light_specular_color_modulator=function(t){this.desc="Sets the specular color of the light source.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"color",dt:t.datatypes.COLOR,desc:"The light specular color.",def:t.renderer.color_white}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.light=e:this.color=e},E2.p.prototype.update_state=function(){this.light.specular_color=this.color},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.color=vec4.createFrom(1,1,1,1))};
!function(){var t=E2.plugins.light_type_generator=function(t){Plugin.apply(this,arguments),this.desc="Select light type.",this.input_slots=[],this.output_slots=[{name:"type",dt:t.datatypes.FLOAT,desc:"Emits the selected light type when requested or the selection state changes.",def:"Point"}],this.state={type:Light.type.POINT}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=Light.type,e=$("<select />",{selectedIndex:1});return $("<option />",{value:t.POINT,text:"Point"}).appendTo(e),$("<option />",{value:t.DIRECTIONAL,text:"Directional"}).appendTo(e),e.change(function(t){return function(){t.undoableSetState("type",parseInt(e.val()),t.state.type)}}(this)),e},t.prototype.update_output=function(){return this.state.type},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
E2.p=E2.plugins.light_type_modulator=function(t){this.desc="Sets the type of the light source to either point or directional.",this.input_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"Input light.",def:t.renderer.light_default},{name:"type",dt:t.datatypes.FLOAT,desc:"Set the light type. See also Generators/Values/Light type.",def:Light.type.POINT}],this.output_slots=[{name:"light",dt:t.datatypes.LIGHT,desc:"The modified light."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.light=e:this.type=0>e?0:e%Light.type.COUNT},E2.p.prototype.update_state=function(){this.light.type=this.type},E2.p.prototype.update_output=function(){return this.light},E2.p.prototype.state_changed=function(t){t||(this.light=new Light,this.type=Light.type.POINT)};
!function(){var e,p=E2.plugins.load_graph=function(e){this.desc="Instructs the player to play the graph (replacing the current graph) when enabled",this.input_slots=[{name:"back key",dt:e.datatypes.FLOAT,desc:"If set, pressing this key will load the previous graph (space=32)",def:null},{name:"graph",dt:e.datatypes.OBJECT,desc:"Graph to play",def:null}],this._keyCode=this._graph=null,this.output_slots=[]};p.prototype.update_input=function(p,a){function t(){function p(a){a.keyCode===s._keyCode&&($(window).off("keypress",p),E2.app.player.stop(),E2.app.player.load_from_json(e),E2.app.player.play())}e||(e=E2.app.player.core.serialise()),s._keyCode&&$(window).on("keypress",p),E2.app.player.stop(),E2.app.player.load_from_object(s._graph),E2.app.player.play()}var s=this;switch(p.index){case 0:this._keyCode=Math.floor(a);break;case 1:if(!a||!Object.keys(a).length)return;this._graph=a,t()}}}();
E2.p=E2.plugins.log_display=function(t){this.desc="Pipes the supplied text to the browser console log.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input text to be logged in the browsers console.",def:null}],this.output_slots=[]},E2.p.prototype.update_input=function(t,e){e&&console.log(e)};
E2.p=E2.plugins.log_modulator=function(t){this.desc="Log(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"log(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.log(e))},E2.p.prototype.update_output=function(){return this.value};
!function(){var t=E2.plugins.loop=function(t){SubGraphPlugin.apply(this,arguments),this.desc="Encapsulate a nested graph into- and out of which arbitrary data can be routed and run the enclosed logic once per loop iteration. The loop counter is made available to enclosing logic as a local register with the name <b>index</b>.",this.input_slots=[{name:"first",dt:t.datatypes.FLOAT,desc:"The start index.",def:0},{name:"last",dt:t.datatypes.FLOAT,desc:"The end index.",def:0},{name:"step",dt:t.datatypes.FLOAT,desc:"Loop index increment.",def:1}],this.output_slots=[],this.state={input_sids:{},output_sids:{},always_update:!0}};t.prototype=Object.create(SubGraphPlugin.prototype),t.prototype.open_editor=function(t){var e=make("div"),i=$('<input id="always_upd" type="checkbox" title="If false, this graph is updated only when one of its inputs updates." />'),s=$("<div>Always update:</div>"),a=make("div"),p={"font-size":"14px","float":"left",padding:"8px 0px 2px 2px"},n={"float":"right",margin:"2px",padding:"2px",width:"13px","margin-top":"8px"};e.css({margin:"0px",padding:"2px"}),a.css("clear","both"),i.css(n),s.css(p),i.attr("checked",t.state.always_update),a.append(s),a.append(i),e.append(a);var r=function(t,e){return function(){t.state.always_update=e.is(":checked")}};t.core.create_dialog(e,"Edit Preferences.",460,250,r(t,i))},t.prototype.create_ui=function(){var t=make("div"),e=makeButton("Edit","Open this loop for editing.");return e.click(function(t){return function(){t.graph&&t.graph.tree_node.activate()}}(this)),t.css("text-align","center"),t.append(e),t},t.prototype.register_dt_changed=function(){},t.prototype.update_input=function(t,e){void 0===t.uid?0===t.index?this.first=Math.floor(e):1===t.index?this.last=Math.floor(e):(this.step=Math.abs(e),this.step=this.step<1?1:Math.floor(this.step)):this.input_nodes[t.uid].plugin.input_updated(e)},t.prototype.update_state=function(){if(this.updated=!1,this.updated_sids.length=0,this.first>this.last){var t=this.first;this.first=this.last,this.last=t}if(this.graph&&this.step>0){for(var e=!1,i=this.first;i<this.last;i+=this.step)this.graph.registers.write("index",i),this.graph.reset(),this.graph.update()&&(e=!0);e&&this===E2.app.player.core.active_graph&&E2.app.updateCanvas(!1)}},t.prototype.state_changed=function(t){var e=this.core,i=this.parent_node;if(t){i.ui.dom.addClass("graph loop");var s=makeButton(null,"Edit preferences.","config_btn");return s.click(function(t){return function(){t.open_editor(t)}}(this)),void $(i.ui.dom[0].children[0].children[0].children[0]).append(s)}this.setupProxies(),this.first=0,this.last=0,this.step=1,this.graph.registers.lock(this,"index");var a=this.graph.registers.registers.index.dt;a===this.core.datatypes.ANY&&this.graph.registers.set_datatype("index",e.datatypes.FLOAT)}}();
E2.p=E2.plugins.lowpass_filter_modulator=function(t){this.desc="Perform simple 1st-order lowpass filtering of the supplied value.\n\n<b>Caution:</b> Do not use this plugin to filter infrequently updated values. This plugin expects continuous input every frame; if necessary, a clock or another cheap continuous float provider can be multiplied by zero and added to the lowpass input to drive updates.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value. Must be updated every frame for correct operation of the filter.",def:0},{name:"amount",dt:t.datatypes.FLOAT,desc:"Filter amount. Zero is pure passthrough, 0.999 maximum filtering.",lo:0,hi:.999,def:.9}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The smoothed output value",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.amount=0>e?0:e>.999?.999:e},E2.p.prototype.update_state=function(){this.output_val=this.input_val*(1-this.amount)+this.last_val*this.amount,this.last_val=this.output_val},E2.p.prototype.update_output=function(){return this.output_val},E2.p.prototype.state_changed=function(t){t||(this.input_val=0,this.amount=.9,this.output_val=0,this.last_val=0)};
E2.p=E2.plugins.lte_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is less than or equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is less than or equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value<=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.material_alpha_clip_modulator=function(t){this.desc="If set to true, fragments with alpha < 0.5 will be discarded.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"alpha clip",dt:t.datatypes.BOOL,desc:"Set to true to discard fragments with alpha < 0.5.",def:!1}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,a){0===t.index?this.material=a:this.alpha_clip=a},E2.p.prototype.update_state=function(){this.material.alpha_clip=this.alpha_clip},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.alpha_clip=!1)};
E2.p=E2.plugins.material_ambient_color_modulator=function(t){this.desc="Set the ambient color.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"color",dt:t.datatypes.COLOR,desc:"The material ambient color.",def:t.renderer.color_black}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:this.color=e},E2.p.prototype.update_state=function(){this.material.ambient_color=this.color},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.color=vec4.createFrom(0,0,0,1))};
E2.p=E2.plugins.material_blend_mode_modulator=function(e){this.desc="Set the blend mode.",this.input_slots=[{name:"material",dt:e.datatypes.MATERIAL,desc:"Input material.",def:e.renderer.material_default},{name:"blend mode",dt:e.datatypes.FLOAT,desc:"Set the material blend mode.",def:Renderer.blend_mode.NORMAL}],this.output_slots=[{name:"material",dt:e.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(e,t){0===e.index?this.material=t:this.blend_mode=t},E2.p.prototype.update_state=function(){this.material.blend_mode=this.blend_mode},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(e){e||(this.material=new Material,this.blend_mode=Renderer.blend_mode.NORMAL)};
E2.p=E2.plugins.material_clone_modulator=function(e){this.desc="Makes a physical copy of the input material reference, to allow side-effect free material chain branching.",this.input_slots=[{name:"material",dt:e.datatypes.MATERIAL,desc:"Input material reference.",def:e.renderer.material_default}],this.output_slots=[{name:"material",dt:e.datatypes.MATERIAL,desc:"The cloned material."}]},E2.p.prototype.update_input=function(e,t){var a=this.material;a.t_cache=t.t_cache,a.depth_test=t.depth_test,a.depth_write=t.depth_write,a.depth_func=t.depth_func,a.alpha_clip=t.alpha_clip,a.shinyness=t.shinyness,a.double_sided=t.double_sided,a.blend_mode=t.blend_mode,a.ambient_color=vec4.create(t.ambient_color),a.diffuse_color=vec4.create(t.diffuse_color),a.textures=t.textures.slice(0),a.lights=t.lights.slice(0)},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(e){e||(this.material=new Material)};
E2.p=E2.plugins.material_diffuse_color_modulator=function(t){this.desc="Set the diffuse color.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"color",dt:t.datatypes.COLOR,desc:"The material diffuse color.",def:t.renderer.color_white}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:this.color=e},E2.p.prototype.update_state=function(){this.material.diffuse_color=this.color},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.color=vec4.createFrom(1,1,1,1))};
E2.p=E2.plugins.material_double_sided_modulator=function(t){this.desc="If set to true, backface culling is disabled.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"double sided",dt:t.datatypes.BOOL,desc:"Set to true to disable backface-culling.",def:!1}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:this.double_sided=e},E2.p.prototype.update_state=function(){this.material.double_sided=this.double_sided},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.double_sided=!1)};
E2.p=E2.plugins.material_light_modulator=function(t){this.desc="Sets the light parameters for a lightsource speficied by index.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"light index",dt:t.datatypes.FLOAT,desc:"The index of the light in the supplied <b>material</b>.",def:0,lo:0,hi:9},{name:"light",dt:t.datatypes.LIGHT,desc:"The light to use in the specified <b>index</b> of the supplied <b>material</b>.",def:null}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:1===t.index?this.next_index=0>e?0:e>7?7:e:2===t.index&&(this.light=e)},E2.p.prototype.update_state=function(){this.material.lights[this.index]=null,this.material.lights[this.next_index]=this.light,this.index=this.next_index},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.next_index=this.index=0,this.light=null)};
E2.p=E2.plugins.material_shinyness_modulator=function(t){this.desc="Set the specularity coefficient.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"shinyness",dt:t.datatypes.FLOAT,desc:"Higher values indicates higher specularity.",def:0,lo:0,hi:10}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:this.shinyness=0>e?0:e>10?10:e},E2.p.prototype.update_state=function(){this.material.shinyness=this.shinyness},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.shinyness=1)};
E2.p=E2.plugins.material_texture_modulator=function(t){this.desc="Sets a material texture.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"type",dt:t.datatypes.FLOAT,desc:"The type of texture to use the supplied <b>texture</b> as. See also Generators/Values/Texture type.",def:Material.texture_type.DIFFUSE_COLOR},{name:"texture",dt:t.datatypes.TEXTURE,desc:"A texture.",def:t.renderer.default_tex}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:1===t.index?this.next_type=0>e?0:e%Material.texture_type.COUNT:2===t.index&&(this.texture=e)},E2.p.prototype.update_state=function(){-1!==this.type&&(this.material.textures[this.type]=null),this.material.textures[this.next_type]=this.texture,this.type=this.next_type},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.type=-1,this.next_type=Material.texture_type.DIFFUSE_COLOR,this.texture=null)};
E2.p=E2.plugins.material_z_buffer_modulator=function(t){this.desc="En- or disables depth buffer test, and write.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"Input material.",def:t.renderer.material_default},{name:"depth test",dt:t.datatypes.BOOL,desc:"Set to true to discard behind the one already in the buffer.",def:!0},{name:"depth write",dt:t.datatypes.BOOL,desc:"Set to false to stop writing fragment depth to the z-buffer.",def:!0},{name:"depth func",dt:t.datatypes.FLOAT,desc:"Set z-buffer test function. See Generators/Values/Depth function",def:Material.depth_func.LEQUAL}],this.output_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The modified material."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:1===t.index?this.depth_test=e:2===t.index?this.depth_write=e:3===t.index&&(this.depth_func=0>e?0:e%Material.depth_func.COUNT)},E2.p.prototype.update_state=function(){this.material.depth_test=this.depth_test,this.material.depth_write=this.depth_write,this.material.depth_func=this.depth_func},E2.p.prototype.update_output=function(){return this.material},E2.p.prototype.state_changed=function(t){t||(this.material=new Material,this.depth_test=!0,this.depth_write=!0,this.depth_func=Material.depth_func.LEQUAL)};
E2.p=E2.plugins.matrix_clone_modulator=function(t){this.desc="Makes a physical copy of the input matrix reference, to allow side-effect free transform chain branching.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Input matrix reference.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The cloned matrix."}]},E2.p.prototype.update_input=function(t,e){this.matrix=mat4.create(e)},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),mat4.identity(this.matrix))};
E2.p=E2.plugins.matrix_display=function(t){this.desc="Displays the supplied matrix as a 4x4 grid of values.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be displayed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.cell_vals=["-","-","-","-","-","-","-","-","-","-","-","-","-","-","-","-"],this.update_values()},E2.p.prototype.create_ui=function(){var t=make("table"),e={"text-align":"right","padding-left":"10px"};this.columns=[];for(var s=0;4>s;s++){for(var i=make("tr"),a=0;4>a;a++){var p=make("td");p.text("-"),p.css(e),this.columns.push(p[0]),i.append(p)}t.append(i)}return t},E2.p.prototype.update_input=function(t,e){if(!e)return void this.reset();for(var s=0;16>s;s++)this.cell_vals[s]=e[s].toFixed(2);this.update_values()},E2.p.prototype.update_values=function(){if(this.columns)for(var t=0;16>t;t++)this.columns[t].innerHTML=this.cell_vals[t]};
E2.p=E2.plugins.max_modulator=function(t){this.desc="Emit the greater of the two input values.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The first input value",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The second input value",def:0}],this.output_slots=[{name:"max",dt:t.datatypes.FLOAT,desc:"The larger of the two supplied values.",def:0}]},E2.p.prototype.reset=function(){this.val_a=0,this.val_b=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.val_a=e:this.val_b=e},E2.p.prototype.update_state=function(){this.output_val=Math.max(this.val_a,this.val_b)},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.member_array_length_modulator=function(t){this.desc="Emits the length of an array member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object containing an array.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the array to emit the length of.",def:null}],this.output_slots=[{name:"length",dt:t.datatypes.FLOAT,desc:"The length of the specified array or 0.",def:0}]},E2.p.prototype.reset=function(){this.len=0,this.object=null,this.array_name=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.array_name=e)},E2.p.prototype.update_state=function(){if(this.len=0,null!==this.object&&null!==this.array_name){if(!this.object.hasOwnProperty(this.array_name))return void msg('ERROR: Cannot index unknown array "'+this.array_name+'".');var t=this.object[this.array_name];return"[object Array]"!==Object.prototype.toString.call(t)?void msg('ERROR: Object member "'+this.array_name+'" is not an array.'):void(this.len=t.length)}},E2.p.prototype.update_output=function(){return this.len};
E2.p=E2.plugins.member_to_bool_modulator=function(e){this.desc="Emits a boolean representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"The boolean representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value=!1,this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){return null!==this.object&&null!==this.member?this.object.hasOwnProperty(this.member)?void(this.value=this.object[this.member]?!0:!1):void msg('ERROR: Cannot convert unknown member "'+this.member+'".'):void 0},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.member_to_float_modulator=function(e){this.desc="Emits a float representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"value",dt:e.datatypes.FLOAT,desc:"The float representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value=0,this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];return isNaN(e)?void msg('ERROR: The member "'+this.member+'" is not a float.'):void(this.value=e)}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.member_to_object_modulator=function(e){this.desc="Emits an object representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:e.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"object",dt:e.datatypes.OBJECT,desc:"The object representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value={},this.object=null,this.member=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.object=t:1===e.index&&(this.member=t)},E2.p.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var e=this.object[this.member];return null===e||"object"!=typeof e?void msg('ERROR: The member "'+this.member+'" is not an object.'):void(this.value=e)}},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.member_to_string_modulator=function(t){this.desc="Emits a string representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The string representation of the specified member.",def:"Empty array"}]},E2.p.prototype.reset=function(){this.value="",this.object=null,this.member=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.member=e)},E2.p.prototype.update_state=function(){return null!==this.object&&null!==this.member?this.object.hasOwnProperty(this.member)?void(this.value=this.object[this.member].toString()):void msg('ERROR: Cannot convert unknown member "'+this.member+'".'):void 0},E2.p.prototype.update_output=function(){return this.value};
!function(){var t=E2.plugins.member_to_typed_array_modulator=function(t){Plugin.apply(this,arguments),this.desc="Emits an typed array representation of specified member of the supplied object.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object.",def:null},{name:"member",dt:t.datatypes.TEXT,desc:"Name of the member to be converted.",def:null}],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The typed array representation of the specified member.",def:"Empty array"}],this.state={datatype:6}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.array=new ArrayBuffer(0),this.object=null,this.member=null},t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:0,text:"Int8"}).appendTo(t),$("<option />",{value:1,text:"Uint8"}).appendTo(t),$("<option />",{value:2,text:"Int16"}).appendTo(t),$("<option />",{value:3,text:"Uint16"}).appendTo(t),$("<option />",{value:4,text:"Int32"}).appendTo(t),$("<option />",{value:5,text:"Uint32"}).appendTo(t),$("<option />",{value:6,text:"Float32"}).appendTo(t),t.change(function(e){return function(){e.undoableSetState("datatype",parseInt(t.val()),e.state.datatype)}}(this)),t},t.prototype.update_input=function(t,e){0===t.index?this.object=e:1===t.index&&(this.member=e)},t.prototype.update_state=function(){if(null!==this.object&&null!==this.member){if(!this.object.hasOwnProperty(this.member))return void msg('ERROR: Cannot convert unknown member "'+this.member+'".');var t=this.object[this.member];if("[object array]"!==Object.prototype.toString.call(t).toLowerCase())return void msg('ERROR: The member "'+this.member+'" is not an array.');switch(this.state.datatype){case 0:this.array=new Int8Array(t);break;case 1:this.array=new Uint8Array(t);break;case 2:this.array=new Int16Array(t);break;case 3:this.array=new Uint16Array(t);break;case 4:this.array=new Int32Array(t);break;case 5:this.array=new Uint32Array(t);break;case 6:this.array=new Float32Array(t)}this.array=this.array.buffer,this.array.datatype=this.state.datatype,this.array.stride=[1,1,2,2,4,4,4][this.state.datatype]}},t.prototype.update_output=function(){return this.array},t.prototype.state_changed=function(t){t&&t.val(""+this.state.datatype)}}();
E2.p=E2.plugins.mesh_get_primitive_count=function(t){this.desc="Gets the number of primitives in the supplied mesh.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Input mesh.",def:null}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"The input mesh."},{name:"prim count",dt:t.datatypes.FLOAT,desc:"The number of primitives in the specified mesh."}]},E2.p.prototype.update_input=function(t,e){this.mesh=e},E2.p.prototype.update_state=function(){return this.mesh?(this.count=this.mesh.index_buffer?this.mesh.index_buffer.count:this.mesh.vertex_buffers.VERTEX.count,void(this.count/=this.mesh.get_stride())):void(this.count=0)},E2.p.prototype.update_output=function(t){return 0===t.index?this.mesh:this.count},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.count=0)};
!function(){var t=E2.plugins.mesh_primtype_generator=function(t){Plugin.apply(this,arguments),this.desc="Select mesh primitive type.",this.input_slots=[],this.output_slots=[{name:"type",dt:t.datatypes.FLOAT,desc:"Emits the selected mesh primitive type when requested or the selection state changes.",def:"Triangles"}],this.gl=t.renderer.context,this.state={type:this.gl.TRIANGLES}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:4});return $("<option />",{value:this.gl.POINTS,text:"Points"}).appendTo(t),$("<option />",{value:this.gl.LINES,text:"Lines"}).appendTo(t),$("<option />",{value:this.gl.LINE_STRIP,text:"Line strip"}).appendTo(t),$("<option />",{value:this.gl.LINE_LOOP,text:"Line loop"}).appendTo(t),$("<option />",{value:this.gl.TRIANGLES,text:"Triangles"}).appendTo(t),$("<option />",{value:this.gl.TRIANGLE_STRIP,text:"Triangle strip"}).appendTo(t),$("<option />",{value:this.gl.TRIANGLE_FAN,text:"Triangle fan"}).appendTo(t),t.change(function(e){return function(){e.undoableSetState("type",parseInt(t.val()),e.state.type)}}(this)),t},t.prototype.update_output=function(){return this.state.type},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
E2.p=E2.plugins.mesh_primtype_modulator=function(e){this.desc="Sets the rendering primitive type of the supplied mesh.",this.input_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Input mesh.",def:null},{name:"type",dt:e.datatypes.FLOAT,desc:"The primitive type to use for the rendering of <b>mesh</b>. See also Generators/Values/Mesh primitive type.",def:e.renderer.context.TRIANGLES}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The modified mesh."}],this.gl=e.renderer.context},E2.p.prototype.update_input=function(e,t){0===e.index?this.mesh=t:1===e.index&&(this.prim_type=Math.round(t))},E2.p.prototype.update_state=function(){this.mesh&&(this.mesh.prim_type=this.prim_type)},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(e){e||(this.mesh=null,this.prim_type=this.gl.TRIANGLES)};
E2.p=E2.plugins.mesh_renderer_emitter=function(e){this.desc="Render the supplied <b>mesh</b>. If no <b>shader</b> is specified, the internal shader (if any) of the <b>mesh</b> is used.",this.input_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The input mesh to be rendered.",def:null},{name:"shader",dt:e.datatypes.SHADER,desc:"Connect to this slot to use the supplied shader in favor of the one specified by the mesh (if any).",def:null},{name:"camera",dt:e.datatypes.CAMERA,desc:"Camera to use for rendering.",def:e.renderer.camera_screenspace},{name:"transform",dt:e.datatypes.MATRIX,desc:"Mesh transform.",def:e.renderer.matrix_identity}],this.output_slots=[],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.mesh=null,this.shader=null},E2.p.prototype.update_input=function(e,t){0===e.index?this.mesh=t:1===e.index?this.shader=t:2===e.index?this.camera=t:3===e.index&&(this.transform=t)},E2.p.prototype.update_state=function(){var e=this.mesh;e&&(this.shader?e.render(this.camera,this.transform,this.shader,this.shader.material):e.render(this.camera,this.transform,e.shader,e.material))},E2.p.prototype.state_changed=function(e){e||(this.camera=new Camera,this.transform=mat4.create(),mat4.identity(this.transform))};
E2.p=E2.plugins.mesh_set_max_primitive_count=function(t){this.desc="Sets the maximumber number of primitives in the supplied mesh to render.",this.input_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"Input mesh.",def:null},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum number of primitives to draw (-1 = all).",def:-1}],this.output_slots=[{name:"mesh",dt:t.datatypes.MESH,desc:"The input mesh."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.mesh=e:this.max_count=-1===e?null:e},E2.p.prototype.update_state=function(){this.mesh&&(this.mesh.max_prims=this.max_count)},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(t){t||(this.mesh=null,this.max_count=null)};
E2.p=E2.plugins.min_modulator=function(t){this.desc="Emit the lesser of the two input values.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The first input value",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The second input value",def:0}],this.output_slots=[{name:"min",dt:t.datatypes.FLOAT,desc:"The smaller of the two supplied values.",def:0}]},E2.p.prototype.reset=function(){this.val_a=0,this.val_b=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.val_a=e:this.val_b=e},E2.p.prototype.update_state=function(){this.output_val=Math.min(this.val_a,this.val_b)},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.modulate_modulator=function(t){this.desc="Modulate <b>value</b> such that the result will always be never be negative and less than or equal to <b>limit</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be modulated.",def:0},{name:"limit",dt:t.datatypes.FLOAT,desc:"Divisor.",lo:">0",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits the remainder of <b>value</b> divided by <b>limit</b>",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.limit_val=1,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.limit_val=0==e?1:e},E2.p.prototype.update_state=function(){this.output_val=this.input_val%this.limit_val},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.module_player=function(t){this.desc="Play a protracker-compatible .mod file using library by firehawk/tda (firehawk@haxor.fi).",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"The url of the module to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!1}],this.output_slots=[],t.add_aux_script("module_player/pt.js",function(t){return function(){t.player=new Protracker}}(this)),this.audio=null,this.playing=!1,this.should_play=!1},E2.p.prototype.play=function(){this.audio&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.player.play())},E2.p.prototype.pause=function(){this.player&&this.playing&&(this.playing=!1,this.should_play=!0,this.player.pause())},E2.p.prototype.stop=function(){this.player&&this.playing&&(this.playing=this.should_play=!1,this.player.stop())},E2.p.prototype.update_input=function(t,p){0===t.index?(this.player.load(p),this.playing=!1):1===t.index&&(this.should_play=p)},E2.p.prototype.update_state=function(){var t=this.player;this.player&&this.player.ready&&(this.playing!==this.should_play&&(this.should_play?t.play():t.pause(),this.playing=this.should_play),this.playing&&(this.updated=!0))};
E2.p=E2.plugins.more_than_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is larger than <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is larger than <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value>this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
!function(){var t=E2.plugins.mouse_button_generator=function(t){this.desc="Emits the current mouse button state.",this.input_slots=[],this.output_slots=[{name:"Left",dt:t.datatypes.BOOL,desc:"True if the left mouse button is pressed and false otherwise.",def:!1},{name:"Middle",dt:t.datatypes.BOOL,desc:"True if the middle mouse button is pressed and false otherwise.",def:!1},{name:"Right",dt:t.datatypes.BOOL,desc:"True if the right mouse button is pressed and false otherwise.",def:!1}]};t.prototype.update_output=function(t){return this.buttons[t.index]},t.prototype.mouse_down=function(t){t.preventDefault(),this.buttons[t.which-1]=!0,this.updated=!0},t.prototype.mouse_up=function(t){this.buttons[t.which-1]=!1,this.updated=!0},t.prototype.state_changed=function(t){t||(this.buttons=[],this.buttons[0]=this.buttons[1]=this.buttons[2]=!1,E2.dom.webgl_canvas.on("mousedown",this.mouse_down.bind(this)),E2.dom.webgl_canvas.on("mouseup",this.mouse_up.bind(this)))}}();
E2.p=E2.plugins.mouse_position_generator=function(e){this.desc="Emits the current mouse position in clip space mapped to the canvas.",this.input_slots=[],this.output_slots=[{name:"x",dt:e.datatypes.FLOAT,desc:"-1 at left edge of canvas and 1 at the right edge. Can be both smaller than -1 and larger than 1 if the mouse is outside the canvas bounds.",def:0},{name:"y",dt:e.datatypes.FLOAT,desc:"-1 at top edge of canvas and 1 at the bottom edge. Can be both smaller than -1 and larger than 1 if the mouse is outside the canvas bounds.",def:0}],this.renderer=e.renderer},E2.p.prototype.update_output=function(e){return 0===e.index?this.x:this.y},E2.p.prototype.mouse_moved=function(e){return function(t){var s=E2.dom.webgl_canvas[0],n=e.renderer.fullscreen,o=n?s.clientWidth:s.width,a=n?s.clientHeight:s.height;e.x=(t.pageX-s.offsetLeft)/o*2-1,e.y=2*(1-(t.pageY-s.offsetTop)/a)-1,e.updated=!0}},E2.p.prototype.state_changed=function(e){e||(this.x=this.y=0,$(document).mousemove(this.mouse_moved(this)))};
E2.p=E2.plugins.mouse_wheel_generator=function(e){this.desc="Emits the current mouse wheel state.",this.input_slots=[],this.output_slots=[{name:"delta",dt:e.datatypes.FLOAT,desc:"The delta mouse wheel movement.",def:0}]},E2.p.prototype.update_output=function(){return this.delta},E2.p.prototype.mouse_wheel=function(e){return function(t,s){e.delta=-s,e.updated=!0}},E2.p.prototype.state_changed=function(e){e||(this.delta=0,E2.dom.webgl_canvas.bind("mousewheel",this.mouse_wheel(this)))};
!function(){var t=E2.plugins.multiply_modulator=function(t){this.desc="Multiplies the two supplied values and emits the result.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The second operand.",def:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The product of the two supplied values.",def:0}]};t.prototype.reset=function(){this.vals=[0,1],this.outputVal=0},t.prototype.update_input=function(t,e){this.vals[t.index]=e},t.prototype.update_state=function(){this.outputVal=this.vals[0]*this.vals[1]},t.prototype.update_output=function(){return this.outputVal}}();
E2.p=E2.plugins.nand_modulator=function(t){this.desc="Emits false when both inputs are true and false otherwise.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"bool",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits false if <b>first</b> and <b>second</b> are true and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=!(this.conds[0]&&this.conds[1])},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.ne_modulator=function(t){this.desc="Emits true if the supplied <b>value</b> is not equal to <b>reference</b> and false otherwise.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>value</b> is not equal to <b>reference</b>.",def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:this.ref=e},E2.p.prototype.update_state=function(){var t=this.value!=this.ref;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.near_eq_modulator=function(t){this.desc="Emits true if the difference between <b>value</b> and <b>reference</b> is less than or equal to <b>proximity</b>.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be compared.",def:0},{name:"proximity",dt:t.datatypes.FLOAT,desc:"Proximity value for comparison.",def:0},{name:"reference",dt:t.datatypes.FLOAT,desc:"Reference to compare <b>value</b> to.",def:0}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:this.desc,def:!1}]},E2.p.prototype.reset=function(){this.value=0,this.proximity=0,this.ref=0,this.state=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.value=e:1===t.index?this.proximity=e:this.ref=e},E2.p.prototype.update_state=function(){var t=Math.abs(this.value-this.ref)<=this.proximity;t!==this.state?this.state=t:this.updated=!1},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.negate_modulator=function(t){this.desc="Emits the sign inverted input value.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value to be negated.",def:0}],this.output_slots=[{name:"-value",dt:t.datatypes.FLOAT,desc:"The sign-inverted input value.",def:-0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=-e},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.normal_as_color_shader=function(t){var e=t.renderer,r=e.context;this.desc="Render vertex normals as interpolated RGB colors.",this.input_slots=[],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}];var o="attribute vec3 v_pos;attribute vec3 v_norm;uniform mat4 m_mat;uniform mat4 v_mat;uniform mat4 p_mat;varying lowp vec3 f_col;void main(void) { gl_Position = p_mat * v_mat * m_mat * vec4(v_pos, 1.0); f_col = (v_norm * 0.5) + vec3(0.5, 0.5, 0.5); }",n="precision mediump float;varying lowp vec3 f_col;void main(void) { gl_FragColor = vec4(f_col, 1.0); }",a=this.s=new ShaderProgram(r);this.vs=new Shader(r,r.VERTEX_SHADER,o),this.ps=new Shader(r,r.FRAGMENT_SHADER,n);var i=a.program;a.attach(this.vs),a.attach(this.ps),a.link(),a.v_pos=r.getAttribLocation(i,"v_pos"),a.v_norm=r.getAttribLocation(i,"v_norm"),a.m_mat=r.getUniformLocation(i,"m_mat"),a.v_mat=r.getUniformLocation(i,"v_mat"),a.p_mat=r.getUniformLocation(i,"p_mat"),a.bind_array=function(t,e){return function(r,o,n){var a=VertexBuffer.vertex_type;e.bindBuffer(e.ARRAY_BUFFER,o),r===a.VERTEX?e.vertexAttribPointer(t.v_pos,n,e.FLOAT,!1,0,0):r===a.NORMAL&&e.vertexAttribPointer(t.v_norm,n,e.FLOAT,!1,0,0)}}(a,r),a.apply_uniforms=function(t,e,r){return function(){e.enableVertexAttribArray(t.v_pos),e.enableVertexAttribArray(t.v_norm),r.set_depth_enable(!0),r.set_blend_mode(Renderer.blend_mode.NORMAL)}}(a,r,t.renderer)},E2.p.prototype.reset=function(){},E2.p.prototype.update_output=function(){return this.s};
E2.p=E2.plugins.not_modulator=function(t){this.desc="Emits true if the input is false and vice versa.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Input boolean to be inverted.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Truth-inverted input value.",def:!0}]},E2.p.prototype.update_input=function(t,e){this.input=e},E2.p.prototype.update_state=function(){this.output=!this.input},E2.p.prototype.update_output=function(){return this.output},E2.p.prototype.state_changed=function(t){t&&(this.input=!1,this.output=!0)};
E2.p=E2.plugins.null_mesh_generator=function(e){this.desc="Create an orientation indication mesh.",this.input_slots=[],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Null mesh."}],this.gl=e.renderer.context,this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var e=this.gl;this.mesh=new Mesh(e,e.LINES,null),(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(e,VertexBuffer.vertex_type.VERTEX)).bind_data([0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,0,1]),(this.mesh.vertex_buffers.COLOR=new VertexBuffer(e,VertexBuffer.vertex_type.COLOR)).bind_data([1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,1,1,0,0,1,1]),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(e){e||this.generate_mesh()};
E2.p=E2.plugins.object_add=function(t){this.desc="Object composition",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Optional existing object"},{name:"key",dt:t.datatypes.TEXT,desc:"The key"},{name:"value",dt:t.datatypes.ANY,desc:"The value: A float, text or object."}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The created object"}],this._object={}},E2.p.prototype.reset=function(){this._key=null,this._object={}},E2.p.prototype.update_input=function(t,e){switch(t.index){case 0:var s=this._object[this._key];this._object=e||{},s&&this._key&&(this._object[this._key]=s);break;case 1:this._key=e;break;case 2:this._object[this._key]=e}},E2.p.prototype.update_output=function(){return this._object};
E2.p=E2.plugins.object_display=function(t){this.desc="Displays Objects and Arrays.",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Input object to be analyzed.",def:null}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("pre"),this.update_value(null),this.label},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){if(this.label)try{this.label.html(JSON.stringify(t,null,"  "))}catch(e){this.label.html(e)}};
E2.p=E2.plugins.object_stringify=function(t){this.desc="Serialize object to JSON (stringify)",this.input_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"Object to serialize"}],this.output_slots=[{name:"json",dt:t.datatypes.TEXT,desc:"The serialized object"}]},E2.p.prototype.reset=function(){this._json=""},E2.p.prototype.update_input=function(t,e){switch(t.index){case 0:this._json=JSON.stringify(e)}},E2.p.prototype.update_output=function(){return this._json};
E2.p=E2.plugins.or_modulator=function(t){this.desc="Emits true if either input value is true and false otherwise.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"bool",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> <i>or</i> <b>second</b> are true and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]||this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
E2.p=E2.plugins.orthographic_camera=function(t){this.desc="Create a orthographic camera, i.e a 3d-camera with no perspectivation (isometric).",this.input_slots=[{name:"left",dt:t.datatypes.FLOAT,desc:"Left plane x-coordinate.",def:-1},{name:"right",dt:t.datatypes.FLOAT,desc:"Right plane x-coordinate.",def:1},{name:"top",dt:t.datatypes.FLOAT,desc:"Top plane y-coordinate.",def:-1},{name:"bottom",dt:t.datatypes.FLOAT,desc:"Bottom plane y-coordinate.",def:1},{name:"near",dt:t.datatypes.FLOAT,desc:"Near plane z-coordinate.",def:1},{name:"far",dt:t.datatypes.FLOAT,desc:"Far plane x-coordinate.",def:1e3},{name:"transform",dt:t.datatypes.MATRIX,desc:"Camera transform.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"camera",dt:t.datatypes.CAMERA,desc:"The resulting camera."}],this.gl=t.renderer.context},E2.p.prototype.update_input=function(t,e){t.index<6?this.params[t.index]=e:this.view=e},E2.p.prototype.update_state=function(){this.update_camera()},E2.p.prototype.update_camera=function(){var t=this.params;this.camera=new Camera,mat4.ortho(t[0],t[1],t[2],t[3],t[4],t[5],this.camera.projection),this.camera.view=this.view},E2.p.prototype.update_output=function(){return this.camera},E2.p.prototype.state_changed=function(t){t||(this.camera=new Camera,this.params=[-1,1,-1,1,1,1e3],this.view=mat4.create(),mat4.identity(this.view),this.update_camera())};
E2.p=E2.plugins.osc_float=function(t){this.desc="Emits float value sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/1/rotary23"',def:null}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Float value from OSC message",def:0}],t.add_aux_script("osc/osc-proxy.js")},E2.p.prototype.update_input=function(t,s){if(s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.value=t[0].value})}},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.osc_receiver=function(s){this.desc="Emits all messages received via OSC.",this.input_slots=[],this.output_slots=[{name:"address",dt:s.datatypes.TEXT,desc:"Recipient address"},{name:"message",dt:s.datatypes.OBJECT,desc:"Actual OSC message"}],s.add_aux_script("osc/osc-proxy.js")},E2.p.prototype.play=function(){var s=this;OscProxy.listen("*",function(e,t){s.updated=!0,s._address=e,s._message=t})},E2.p.prototype.reset=function(){this._address=this._message=null},E2.p.prototype.update_output=function(s){return 0===s.index?this._address:this._message};
E2.p=E2.plugins.osc_xy_float=function(t,s){this.desc="Emits two float values sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/1/xy1"',def:null}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"First float value from OSC message"},{name:"y",dt:t.datatypes.FLOAT,desc:"Second float value from OSC message"}],t.add_aux_script("osc/osc-proxy.js"),this.node=s},E2.p.prototype.update_input=function(t,s){if(null!==s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.x=t[0].value,e.y=t[1].value})}},E2.p.prototype.reset=function(){this.x=this.y=0},E2.p.prototype.update_output=function(t){return 0===t.index?this.x:this.y};
E2.p=E2.plugins.osc_xyz_float=function(t,s){this.desc="Emits three float values sent via OSC to address.",this.input_slots=[{name:"address",dt:t.datatypes.TEXT,desc:'OSC address to listen to, eg. "/accxyz"',def:"/accxyz"}],this.output_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"First float value from OSC message"},{name:"y",dt:t.datatypes.FLOAT,desc:"Second float value from OSC message"},{name:"z",dt:t.datatypes.FLOAT,desc:"Third float value from OSC message"}],t.add_aux_script("osc/osc-proxy.js"),this.node=s},E2.p.prototype.update_input=function(t,s){if(null!==s){var e=this;OscProxy.listen(s,function(t){e.updated=!0,e.x=t[0].value,e.y=t[1].value,e.z=t[2].value})}},E2.p.prototype.reset=function(){this.x=this.y=this.z=0},E2.p.prototype.update_output=function(t){return 0===t.index?this.x:1===t.index?this.y:this.z};
E2.p=E2.plugins.output_proxy=function(t,e){this.desc="Create a new type-less slot to route data out of the current graph to its parent. When connected to a slot, it will assume its type until disconnected. Renaming this plugin will rename the corresponding parent slot.",this.input_slots=[],this.output_slots=[],e.add_slot(E2.slot_type.input,{name:"output",dt:t.datatypes.ANY,desc:"Connect a slot of any type to this plugin, to have the parent slot assume its datatype and forward data from this plugin.",def:null}),this.core=t,this.node=e,this.data=null,this.changed=!1,e.title||(e.title="output")},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.connection_changed=function(t,e,n){var o=this.node.parent_graph.plugin;o&&o.proxy_connection_changed(t,this.node,e.src_node,n,e.src_slot)},E2.p.prototype.update_input=function(t,e){var n=this.node;if(this.data=e,this.changed=!0,n.parent_graph.plugin){var o=n.parent_graph.plugin;o.updated_sids.push(o.state.output_sids[n.uid]),o.updated=!0}},E2.p.prototype.state_changed=function(t){t&&this.node.ui.dom.addClass("proxy")};
E2.p=E2.plugins.parse_json_modulator=function(t){this.desc="Emits an object representation of the supplied JSON string.",this.input_slots=[{name:"json",dt:t.datatypes.TEXT,desc:"Input string to be parsed.",def:null}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The object representation of the supplied json.",def:"Empty object"}]},E2.p.prototype.reset=function(){this.obj={}},E2.p.prototype.update_input=function(t,e){if(!e)return void(this.obj={});try{this.obj=JSON.parse(e)}catch(s){msg("ERROR: Failed to parse JSON: "+s.message),this.obj={}}},E2.p.prototype.update_output=function(){return this.obj};
E2.p=E2.plugins.perspective_camera=function(e){this.desc="Create a new perspective (3D) camera.",this.input_slots=[{name:"FOV",dt:e.datatypes.FLOAT,desc:"Field of view in degrees.",def:45},{name:"near",dt:e.datatypes.FLOAT,desc:"Depth of the near clipping plane.",def:.01},{name:"far",dt:e.datatypes.FLOAT,desc:"Depth of the far clipping plane.",def:1e3},{name:"position",dt:e.datatypes.VECTOR,desc:"Camera position.",def:[0,0,-2]},{name:"target",dt:e.datatypes.VECTOR,desc:"Camera target.",def:e.renderer.vector_origin}],this.output_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"The resulting camera."}],this.gl=e.renderer.context,this.canvas=e.renderer.canvas[0],this.up=[0,0,1],this.delegate=this._onResize.bind(this),e.renderer.on("resize",this.delegate)},E2.p.prototype.update_input=function(e,t){0===e.index?this.fov=t:1===e.index?this.near=t:2===e.index?this.far=t:3===e.index?this.position=t:this.target=t},E2.p.prototype.update_state=function(){var e=this.canvas;mat4.perspective(this.fov,e.width/e.height,this.near,this.far,this.camera.projection),mat4.lookAt(this.position,this.target,this.up,this.camera.view)},E2.p.prototype.update_output=function(){return this.camera},E2.p.prototype.state_changed=function(e){e||(this.camera=new Camera(this.gl),this.fov=45,this.near=.01,this.far=1e3,this.position=[0,0,-2],this.target=[0,0,0])},E2.p.prototype._onResize=function(){this.updated=!0};
E2.p=E2.plugins.pi_generator=function(t){this.desc="Emits the constant  (pi).",this.input_slots=[],this.output_slots=[{name:"pi",dt:t.datatypes.FLOAT,desc:"The constant  (pi)."}]},E2.p.prototype.reset=function(){},E2.p.prototype.update_output=function(){return Math.PI};
E2.p=E2.plugins.planar_projection_matrix=function(t){this.desc="Create a matrix that represent a planar projection.",this.input_slots=[{name:"plane offset",dt:t.datatypes.FLOAT,desc:"Plane offset from the origin.",def:[0,0,0]},{name:"plane normal",dt:t.datatypes.VECTOR,desc:"Plane orientation.",def:[0,0,-1]},{name:"light pos",dt:t.datatypes.VECTOR,desc:"Light position in world space.",def:[0,0,-2]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting projection matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.plane_offset=0,this.plane_normal=[0,0,-1],this.light_pos=[0,0,-2],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){0===t.index?this.plane_offset=e:1===t.index?this.plane_normal=e:1===t.index&&(this.light_pos=e)},E2.p.prototype.update_state=function(){var t=this.plane_normal,e=this.light_pos,i=this.matrix,a=this.plane_offset,n=t[0]*e[0]+t[1]*e[1]+t[2]*e[2];n=n>0?1/n:1,i[0]=1-t[0]*e[0]*n,i[4]=-t[0]*e[1]*n,i[8]=-t[0]*e[2]*n,i[1]=-t[1]*e[0]*n,i[5]=-1-t[1]*e[1]*n,i[9]=-t[1]*e[2]*n,i[2]=-t[2]*e[0]*n,i[6]=-t[2]*e[2]*n,i[10]=1-t[2]*e[2]*n,i[2]=a*e[0]*n,i[6]=a*e[1]*n,i[10]=1-e[2]*n},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.plane_mesh_generator=function(e){this.desc="Create a planar texture mapped triangle mesh in the XY-plane of unit size. The total number of faces cannot exceed 16384.",this.input_slots=[{name:"x res",dt:e.datatypes.FLOAT,desc:"X resolution.",lo:1,hi:16384,def:10},{name:"y res",dt:e.datatypes.FLOAT,desc:"Y resolution.",lo:1,hi:16384,def:10}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Plane mesh."}],this.gl=e.renderer.context,this.state={x_res:10,y_res:10},this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(e,t){var s=Math.max(1,Math.min(Math.floor(t),16384));0===e.index&&this.state.x_res!==s?(this.state.x_res=s,this.dirty=!0):1===e.index&&this.state.y_res!==s&&(this.state.y_res=s,this.dirty=!0)},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var e=this.gl;this.mesh=new Mesh(e,e.TRIANGLES,null);var t=this.state.x_res,s=this.state.y_res,h=t*s,r=h-16384;r>0&&(t>s?(s=Math.floor(s-r/t),1>s&&(t=16384,s=1)):(t=Math.floor(t-r/s),1>t&&(t=1,s=16384)));for(var p=[],u=[],a=[],i=[],n=1/t,o=1/s,f=0,d=0,_=0;s>d;d++,_+=o)for(var m=0,x=0;t>m;m++,x+=n,f+=4){p.push(x+n),p.push(_+o),p.push(0),a.push(x+n),a.push(_+o),p.push(x),p.push(_+o),p.push(0),a.push(x),a.push(_+o),p.push(x+n),p.push(_),p.push(0),a.push(x+n),a.push(_),p.push(x),p.push(_),p.push(0),a.push(x),a.push(_);for(var l=0;4>l;l++)u.push(0),u.push(0),u.push(1);i.push(f+0),i.push(f+1),i.push(f+3),i.push(f+3),i.push(f+2),i.push(f+0)}for(var l=0;s*t*4*3>l;l+=3)p[l]=2*p[l]-1,p[l+1]=2*p[l+1]-1;this.mesh.vertex_count=s*t*4,this.mesh.stream_count=3,this.mesh.streams_loaded=3,(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(e,VertexBuffer.vertex_type.VERTEX)).bind_data(p),(this.mesh.vertex_buffers.NORMAL=new VertexBuffer(e,VertexBuffer.vertex_type.NORMAL)).bind_data(u),(this.mesh.vertex_buffers.UV0=new VertexBuffer(e,VertexBuffer.vertex_type.UV0)).bind_data(a),(this.mesh.index_buffer=new IndexBuffer(e)).bind_data(i),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(e){e||this.generate_mesh()};
E2.p=E2.plugins.plane_mesh_unindexed_generator=function(e){this.desc="Create a planar texture mapped triangle mesh in the XY-plane of unit size.",this.input_slots=[{name:"x res",dt:e.datatypes.FLOAT,desc:"X resolution.",lo:1,hi:65536,def:10},{name:"y res",dt:e.datatypes.FLOAT,desc:"Y resolution.",lo:1,hi:65536,def:10}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Plane mesh."}],this.gl=e.renderer.context,this.state={x_res:10,y_res:10},this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(e,t){var s=Math.max(1,Math.min(Math.floor(t),65536));0===e.index&&this.state.x_res!==s?(this.state.x_res=s,this.dirty=!0):1===e.index&&this.state.y_res!==s&&(this.state.y_res=s,this.dirty=!0)},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var e=this.gl;this.mesh=new Mesh(e,e.TRIANGLES,null);for(var t=this.state.x_res,s=this.state.y_res,h=[],r=[],p=[],u=1/t,i=1/s,a=0,n=0,o=0;s>n;n++,o+=i)for(var d=0,f=0;t>d;d++,f+=u,a+=4){h.push(f+u),h.push(o+i),h.push(0),p.push(f+u),p.push(o+i),h.push(f),h.push(o+i),h.push(0),p.push(f),p.push(o+i),h.push(f),h.push(o),h.push(0),p.push(f),p.push(o),h.push(f),h.push(o),h.push(0),p.push(f),p.push(o),h.push(f+u),h.push(o),h.push(0),p.push(f+u),p.push(o),h.push(f+u),h.push(o+i),h.push(0),p.push(f+u),p.push(o+i);for(var _=0;6>_;_++)r.push(0),r.push(0),r.push(1)}for(var _=0;s*t*6*3>_;_+=3)h[_]=2*h[_]-1,h[_+1]=2*h[_+1]-1;this.mesh.vertex_count=s*t*6,this.mesh.stream_count=3,this.mesh.streams_loaded=3,(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(e,VertexBuffer.vertex_type.VERTEX)).bind_data(h),(this.mesh.vertex_buffers.NORMAL=new VertexBuffer(e,VertexBuffer.vertex_type.NORMAL)).bind_data(r),(this.mesh.vertex_buffers.UV0=new VertexBuffer(e,VertexBuffer.vertex_type.UV0)).bind_data(p),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(e){e||this.generate_mesh()};
E2.p=E2.plugins.plot_display=function(t){this.desc="Displays the supplied coordiate on a XY plot.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The location on the x-axis.",lo:0,hi:1,def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The location on the y-axis.",lo:0,hi:1,def:0}],this.output_slots=[]},E2.p.prototype.reset=function(){this.coord=[0,0],this.update_values()},E2.p.prototype.create_ui=function(){var t=make("div");t.css({width:"64px",height:"64px",background:"url('images/plot_display/bg.png')","z-index":"1000",position:"relative"});var o=this.coord_div=make("div");return o.css({width:"7px",height:"7px",background:"url('images/plot_display/point.png')","z-index":"1001",position:"absolute"}),t.append(o),this.reset(),t},E2.p.prototype.update_input=function(t,o){this.coord[t.index]=0>o?0:o>1?1:o,this.update_values()},E2.p.prototype.update_values=function(){this.coord_div&&this.coord_div.css({left:Math.round(55*this.coord[0]),top:Math.round(55-55*this.coord[1])+2})};
E2.p=E2.plugins.quad_mesh_generator=function(e){this.desc="Create a planar quad mesh in the XY-plane of unit size with normals and one set of UV-cordinates.",this.input_slots=[],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Quad mesh."}],this.gl=e.renderer.context,this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(e){if(!e){var t=this.gl;this.mesh=new Mesh(t,t.TRIANGLE_STRIP,null);var r=this.mesh.vertex_buffers.VERTEX=new VertexBuffer(t,VertexBuffer.vertex_type.VERTEX);r.bind_data([1,1,0,-1,1,0,1,-1,0,-1,-1,0]);var s=this.mesh.vertex_buffers.NORMAL=new VertexBuffer(t,VertexBuffer.vertex_type.NORMAL);s.bind_data([0,0,1,0,0,1,0,0,1,0,0,1]);var n=this.mesh.vertex_buffers.UV0=new VertexBuffer(t,VertexBuffer.vertex_type.UV0);n.bind_data([1,1,0,1,1,0,0,0]);var a=this.mesh.index_buffer=new IndexBuffer(t);a.bind_data([3,1,0,3,2,0]),this.mesh.generate_shader()}};
E2.p=E2.plugins.random_float_generator=function(t){this.desc="Emits a random float constant in a specified range.",this.input_slots=[{name:"min",dt:t.datatypes.FLOAT,desc:"Minimum output value.",def:0},{name:"max",dt:t.datatypes.FLOAT,desc:"Maximum output value.",def:1}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Random output value between <b>min</b> and <b>max</b>."}],this.always_update=!0,this.lo=0,this.hi=1,this.value=0},E2.p.prototype.update_input=function(t,a){0===t.index?this.lo=a:1===t.index&&(this.hi=a)},E2.p.prototype.update_state=function(){var t=this.lo,a=this.hi;if(t>a){var e=t;t=a,a=e}this.value=t+Math.random()*(a-t),this.updated=!0},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.record_framebuffer=function(t){this.desc="Grab the current framebuffer and transmit frame size and RGB data to a specified recording server.",this.input_slots=[{name:"record",dt:t.datatypes.BOOL,desc:"Switch recording on or off.",def:!1},{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture output of a graph.",def:null}],this.output_slots=[],this.gl=t.renderer.context,this.url="http://"+window.location.host+"/fd/frame"},E2.p.prototype.reset=function(){this.texture=null,this.img_data=null,this.conv_data=null,this.xhr=null},E2.p.prototype.update_input=function(t,e){0===t.index?this.record=e:1===t.index&&(this.texture=e)},E2.p.prototype.update_state=function(){if(this.record&&this.url&&this.texture&&this.texture.framebuffer){var t=this.gl,e=this.texture.width,i=this.texture.height,r=e*i*4;this.img_data&&this.img_data.byteLength===r||(this.img_data=new Uint8Array(r),this.conv_data=new Uint8Array(e*i*3),this.xhr=new XMLHttpRequest),t.bindFramebuffer(t.FRAMEBUFFER,this.texture.framebuffer),t.readPixels(0,0,e,i,t.RGBA,t.UNSIGNED_BYTE,this.img_data),t.bindFramebuffer(t.FRAMEBUFFER,null);for(var a=this.img_data,s=this.conv_data,h=0,n=0;e*i*3>h;h+=3,n+=4)s[h+2]=a[n],s[h+1]=a[n+1],s[h]=a[n+2];this.xhr.open("POST",this.url+"?width="+e+"&height="+i,!1),this.xhr.setRequestHeader("Content-Type","application/octet-stream"),this.xhr.send(this.conv_data)}};
E2.p=E2.plugins.register_local_read=function(t,e){this.desc="Read from a local register using the name of the node.",this.input_slots=[],this.output_slots=[],this.core=t,this.node=e,this.data=null,this.old_title=e.title?e.title:e.title="reg_"+(e.parent_graph.registers.count()+1)},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.destroy=function(){this.regs.unlock(this,this.node.title)},E2.p.prototype.renamed=function(){this.regs.unlock(this,this.old_title),this.target_reg(this.node.title)},E2.p.prototype.register_dt_changed=function(t){this.dt=t,this.node.change_slot_datatype(E2.slot_type.output,this.slotId,t)},E2.p.prototype.register_updated=function(t){this.updated=!0,this.node.queued_update=1,this.data=t},E2.p.prototype.connection_changed=function(t,e){var s=this.regs.connection_changed(this.node.title,t);t&&1===s&&this.dt===this.core.datatypes.ANY&&this.regs.set_datatype(this.node.title,e.dst_slot.dt)},E2.p.prototype.update_output=function(){return this.data},E2.p.prototype.target_reg=function(t){this.regs.lock(this,t);var e=this.regs.registers[t].dt;this.dt=e,e!==this.core.datatypes.ANY&&(this.register_dt_changed(e),this.data=this.regs.registers[t].value)},E2.p.prototype.state_changed=function(t){if(t)this.node.ui.dom.addClass("register");else{var e=this.node,s=this.node.getDynamicOutputSlots();s.length||this.node.add_slot(E2.slot_type.output,{name:"value",dt:this.core.datatypes.ANY,desc:""}),s=this.node.getDynamicOutputSlots(),this.slotId=s[0].uid,this.regs=e.parent_graph.registers,this.target_reg(e.title)}};
E2.p=E2.plugins.register_local_write=function(t,e){this.desc="Write to a local register using name of the node, the value of which can subsequently be read.",this.input_slots=[],this.output_slots=[],this.core=t,this.node=e,this.old_title=e.title?e.title:e.title="reg_"+(e.parent_graph.registers.count()+1)},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.destroy=function(){this.regs.unlock(this,this.node.title)},E2.p.prototype.register_dt_changed=function(t){this.node.change_slot_datatype(E2.slot_type.input,this.slotId,t)},E2.p.prototype.renamed=function(){this.regs.unlock(this,this.old_title),this.regs.lock(this,this.node.title)},E2.p.prototype.connection_changed=function(t,e){var s=this.regs.connection_changed(this.node.title,t);t&&1===s&&this.regs.set_datatype(this.node.title,e.src_slot.dt)},E2.p.prototype.update_input=function(t,e){this.regs.write(this.node.title,e)},E2.p.prototype.target_reg=function(t){var e=this.node.find_dynamic_slot(E2.slot_type.input,this.slotId);this.regs.lock(this,t);var s=this.regs.registers[t].dt;s!==this.core.datatypes.ANY&&this.register_dt_changed(e.dt)},E2.p.prototype.state_changed=function(t){if(t)this.node.ui.dom.addClass("register");else{var e=this.node,s=this.node.getDynamicInputSlots();s.length||this.node.add_slot(E2.slot_type.input,{name:"value",dt:this.core.datatypes.ANY,desc:""}),s=this.node.getDynamicInputSlots(),this.slotId=s[0].uid,this.regs=e.parent_graph.registers,this.target_reg(e.title)}};
E2.p=E2.plugins.reset_framebuffer_recorder=function(t){this.desc="Instruct the specified framedump server to clear its cache and start recording at from zero.",this.input_slots=[{name:"reset",dt:t.datatypes.BOOL,desc:"Send true to this slot to reset the specified server.",def:!1}],this.output_slots=[],this.url="http://"+window.location.host+"/fd/reset",this.clear=!1},E2.p.prototype.reset=function(){},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.clear=e)},E2.p.prototype.update_state=function(){this.clear&&($.get(this.url).done(function(){msg("Framdumping reset to frame 0")}).fail(function(){msg("ERROR: Failed to reset the speficied framedumping server: "+this.url)}),this.clear=!1)};
E2.p=E2.plugins.rotation_matrix=function(t){this.desc="Create a matrix that performs a rotation around an arbitrary axis.",this.input_slots=[{name:"angle",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate.",lo:-360,hi:360,def:0},{name:"axis",dt:t.datatypes.VECTOR,desc:"Normalized vector describing the axis around which the rotation is performed.",def:[0,0,1]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting rotation matrix.",def:t.renderer.metrix_identity}]},E2.p.prototype.reset=function(){this.angle=0,this.axis=[0,0,1],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,i){0===t.index?this.angle=i%360/180*Math.PI:this.axis=i},E2.p.prototype.update_state=function(){mat4.identity(this.matrix),mat4.rotate(this.matrix,this.angle,this.axis)},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.rotation_xyz_matrix=function(t){this.desc="Create a matrix that rotates individually around the X, Y and Z axis.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the X-axis.",lo:-360,hi:360,def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the Y-axis.",lo:-360,hi:360,def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"Number of degrees to rotate around the Z-axis.",lo:-360,hi:360,def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting rotation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.angles=[0,0,0],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){this.angles[t.index]=e%360/180*Math.PI},E2.p.prototype.update_state=function(){mat4.identity(this.matrix),mat4.rotateX(this.matrix,this.angles[0]),mat4.rotateY(this.matrix,this.angles[1]),mat4.rotateZ(this.matrix,this.angles[2])},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.round_modulator=function(t){this.desc="Emits the input <b>value</b> rounded to the nearest integer.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The input value to be rounded.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The rounded integer.",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.round(e)},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.sample_and_hold_modulator=function(t){this.desc="Emits the input value when 'sample' is true and emits the last sampled value otherwise. Emits zero by default.",this.input_slots=[{name:"sample",dt:t.datatypes.BOOL,desc:"Sending true to this slot updated the output value to match the input value, false inhibits input sampling.",def:!0},{name:"value",dt:t.datatypes.FLOAT,desc:"The input value.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The output value.",def:0}],this.state={value:0}},E2.p.prototype.reset=function(){this.has_updated=!1,this.updated=!0,this.last_state=!0},E2.p.prototype.update_input=function(t,e){0===t.index?this.sample=e:this.buffer=e},E2.p.prototype.update_state=function(){this.sample?this.state.value=this.buffer:this.has_updated&&(this.updated=!1),!this.sample&&this.last_state&&(this.last_state=this.sample,this.has_updated=!1)},E2.p.prototype.update_output=function(){return this.has_updated=!0,this.state.value},E2.p.prototype.state_changed=function(t){t||(this.state.value=0,this.buffer=0,this.sample=!0)};
E2.p=E2.plugins.sawtooth_modulator=function(t){this.desc="Sawtooth oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits ((<b>time</b> % 1) - 0.5) * 2.",lo:-1,hi:1,def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=2*(this.time%1-.5)},E2.p.prototype.update_output=function(){return this.result};
E2.p=E2.plugins.scale_matrix=function(t){this.desc="Create a matrix that scales by the supplied factors for each axis.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Factors to scale each axis by.",def:[1,1,1]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting scale matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){mat4.identity(this.matrix),mat4.scale(this.matrix,e)},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.scale_xyz_matrix=function(t){this.desc="Create a matrix that scales the X, Y and Z axis.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"Amount to scale the X-axis.",def:1},{name:"y",dt:t.datatypes.FLOAT,desc:"Amount to scale the Y-axis.",def:1},{name:"z",dt:t.datatypes.FLOAT,desc:"Amount to scale the Z-axis.",def:1}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting scale matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.factors=vec3.createFrom(1,1,1),this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,e){this.factors[t.index]=e},E2.p.prototype.update_state=function(){mat4.identity(this.matrix),mat4.scale(this.matrix,this.factors)},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.scene_get_bounding_box=function(e){this.desc="Extract the <b>min</b> and <b>max</b> AABB vectors from a supplied <b>scene</b> for use in debugging, camera calibration or other calculations.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The input scene.",def:null}],this.output_slots=[{name:"min",dt:e.datatypes.VECTOR,desc:"The lowest <b>scene</b> extent.",def:e.renderer.vector_origin},{name:"max",dt:e.datatypes.VECTOR,desc:"The highest <b>scene</b> extent.",def:e.renderer.vector_origin}]},E2.p.prototype.update_input=function(e,t){0===e.index&&(this.scene=t)},E2.p.prototype.update_state=function(){if(this.scene){var e=this.scene.bounding_box;this.lo=e.lo,this.hi=e.hi}},E2.p.prototype.update_output=function(e){return 0===e.index?this.lo:this.hi},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.lo=[0,0,0],this.hi=[0,0,0])};
E2.p=E2.plugins.scene_get_mesh_by_index=function(e){this.desc="Extract a single <b>mesh</b> from a <b>scene</b> by <b>index</b> so it can be rendered individually.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to extract a mesh reference from.",def:null},{name:"index",dt:e.datatypes.FLOAT,desc:"The desired mesh index.",def:0}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"The extracted mesh reference."}]},E2.p.prototype.reset=function(){this.changed=!0},E2.p.prototype.update_input=function(e,t){0===e.index?this.scene=t:1===e.index&&(this.index=Math.floor(0>t?-t:t))},E2.p.prototype.update_state=function(){if(this.scene){var e=this.scene.meshes,t=e.length;if(1>t)return;var s=e[this.index%t];if(s!==this.mesh)return void(this.mesh=s)}this.changed||(this.updated=!1),this.changed=!1},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.index=0,this.mesh=null,this.changed=!0)};
E2.p=E2.plugins.scene_get_mesh_count=function(e){this.desc="Emits the number of meshes in the supplied <b>scene</b>. Note that the maximum index is one less than the mesh <b>count</b>.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to obtain the mesh count from.",def:null}],this.output_slots=[{name:"count",dt:e.datatypes.FLOAT,desc:"The number of meshes in the supplied <b>scene</b>. Note that mesh indices are zero-index, so the highest mesh index in a scene is count - 1.",def:0}]},E2.p.prototype.update_input=function(e,t){this.scene=t},E2.p.prototype.update_state=function(){this.count=this.scene?this.scene.meshes.length:0},E2.p.prototype.update_output=function(){return this.count},E2.p.prototype.state_changed=function(e){e||(this.scene=null,this.count=0)};
E2.p=E2.plugins.scene_renderer_emitter=function(e){this.desc="Render the supplied <b>scene</b>. If no <b>shader</b> is specified, the internal shaders of the scene meshes are used.",this.input_slots=[{name:"scene",dt:e.datatypes.SCENE,desc:"The scene to be rendered.",def:null},{name:"material",dt:e.datatypes.MATERIAL,desc:"If a material is specified, internal shaders are generated to render each scene mesh using this material as an overload.",def:null},{name:"camera",dt:e.datatypes.CAMERA,desc:"The camera to use for rendering.",def:null},{name:"transform",dt:e.datatypes.MATRIX,desc:"The scene transform to use for rendering.",def:e.renderer.matrix_identity},{name:"inv. transform",dt:e.datatypes.BOOL,desc:"Send true to this slot to apply <b>transform</b> in inverse order when rendering instances.",def:!1}],this.output_slots=[],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.scene=null,this.shader=null},E2.p.prototype.update_input=function(e,t){if(0===e.index)t!==this.scene&&(this.scene=t,this.ext_camera||(this.camera=this.scene.create_autofit_camera())),this.material_dirty=!0;else if(1===e.index){if(this.material=t,!t)return void(this.material_caps="");var a=Material.get_caps_hash(null,t);this.material_caps!==a&&(this.material_caps=a,this.material_dirty=!0)}else 2===e.index?(this.camera=t,this.ext_camera=t?!0:!1,!this.ext_camera&&this.scene&&(this.camera=this.scene.create_autofit_camera())):3===e.index&&(this.transform=t)},E2.p.prototype.connection_changed=function(e,t,a){e||(0===a.index?this.material_dirty=!0:1===a.index&&(this.material=null,this.material_caps="",this.overload_shaders=null))},E2.p.prototype.update_state=function(){this.scene&&(this.material_dirty&&this.material&&(this.overload_shaders=this.scene.build_overload_shaders(this.material),this.material_dirty=!1),this.transform.invert=this.inv_transform,this.scene.render(this.gl,this.camera,this.transform,this.overload_shaders,this.material))},E2.p.prototype.state_changed=function(e){e||(this.material=null,this.material_caps="",this.material_dirty=!1,this.overload_shaders=null,this.camera=new Camera,this.transform=mat4.create(),mat4.identity(this.transform),this.ext_camera=!1,this.inv_transform=!1)};
E2.p=E2.plugins.screenspace_camera=function(e){this.desc="Create a screen space (2D) camera suitable for display of XY-planar data, like quads.",this.input_slots=[],this.output_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"Screenspace camera."}],this.gl=e.renderer.context},E2.p.prototype.reset=function(){this.camera=new Camera(this.gl)},E2.p.prototype.update_output=function(){return this.camera};
E2.p=E2.plugins.set_matrix_modulator=function(t){this.desc="Set matrix component.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Matrix to set component of.",def:t.renderer.matrix_identity},{name:"row",dt:t.datatypes.FLOAT,desc:"Row to set.",def:0},{name:"column",dt:t.datatypes.FLOAT,desc:"Column to set.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The value to set.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"Modulated matrix."}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.matrix=e:1===t.index?this.row=0>e?0:e>3?3:e:2===t.index?this.column=0>e?0:e>3?3:e:3===t.index&&(this.value=e)},E2.p.prototype.update_state=function(){this.matrix[4*this.row+this.column]=this.value},E2.p.prototype.update_output=function(){return this.matrix},E2.p.prototype.state_changed=function(t){t||(this.matrix=mat4.create(),this.row=0,this.column=0,this.value=0,mat4.identity(this.matrix))};
E2.p=E2.plugins.sin_modulator=function(t){this.desc="Sin(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"sin(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.sin(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.sine_modulator=function(t){this.desc="Sine oscilator. A <b>time</b> value incrementing by one per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits sin(<b>time</b> * 2pi).",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=Math.sin(2*this.time*Math.PI)},E2.p.prototype.update_output=function(){return this.result};
!function(){var t=E2.plugins.slider_float_generator=function(t,e){Plugin.apply(this,arguments),this.desc="Emits a user controllable float value between two specified values.",this.input_slots=[],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits the current value when the slider is adjusted.",def:0}],this.state={val:0,min:0,max:1},this.node=e,this.v_col=null,this.slider=null,this.handle=null,this.pos=0};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,e=make("table"),a=make("tr"),s=[make("td"),make("td"),make("td")],n=$('<input class="lo" type="number" step="0.2" style="width: 50px;" />'),i=$('<input class="hi" type="number" step="0.2" style="width: 50px;" />'),o=make("div"),p=this.handle=make("div"),u=function(e){return function(a){return E2.app.undoManager.end(),document.removeEventListener("mouseup",e.mouseup),document.removeEventListener("mousemove",e.mousemove),t.undoableSetState("val",t.state.val,t._mouseDownValue),a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}},l=function(e){return function(a){var s=a.pageX-e.last_x,n=t.state.max-t.state.min;if(Math.abs(n)>1e-4){e.last_x=a.pageX;var i=t.pos+s;i=0>i?0:i>60?60:i,t.state.val!==i&&t._setValue(i)}return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}},r=function(e,a,s){return function(e){var a={last_x:e.pageX,handle:s};return t._mouseDownValue=t.state.val||0,a.mouseup=u(a),a.mousemove=l(a),document.addEventListener("mouseup",a.mouseup),document.addEventListener("mousemove",a.mousemove),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1}};o.addClass("slider slider-horizontal ui-widget corner-all"),o.css({width:"60px","margin-left":"8px","margin-right":"8px"}),p.addClass("slider-handle state-hover corner-all"),p[0].style.left="0px",p[0].addEventListener("mousedown",r(n,i,p)),o.append(p),e.css("width","150px"),n.css("border","1px solid #999"),i.css("border","1px solid #999"),n.etf=new ExpandableTextfield(this.node,n,3),i.etf=new ExpandableTextfield(this.node,i,3);var d=make("td");d.attr("colspan","3"),d.css("text-align","center"),e.append(a),a.append(s[0]),a.append(s[1]),a.append(s[2]),s[0].append(n),s[1].append(o),s[2].append(i);var h=function(e){return function(){function a(t,e){try{var a=parseFloat(e);if(!isNaN(a))return a}catch(s){}return t}var s=t.state;e===n?t.undoableSetState("min",a(s.min,e.val()),t.state.min):t.undoableSetState("max",a(s.max,e.val()),t.state.max),e.etf.update(),t.update_value(t.state.val)}};n.blur(h(n)),i.blur(h(i));var m=make("tr");return m.append(d),d.append(),e.append(m),this.v_col=d,this.update_value(0),this.slider=o,this.handle=p,this.node.on("pluginStateChanged",this.updateUi.bind(this)),this.ui=e,this.ui},t.prototype.update_output=function(){return this.state.val},t.prototype._setValue=function(t){var e=this,a=t/60;e.state.val=(1-a)*e.state.min+a*e.state.max,e.update_value(e.state.val),e.updated=!0},t.prototype.update_value=function(){this.updated=!0;var t=this.state,e=Math.min(t.min,t.max),a=Math.max(t.min,t.max),s=Math.abs(t.max-t.min);t.val=t.val<e?e:t.val>a?a:t.val,this.pos=1e-4>s?0:Math.abs(t.val-t.min)/s*60,this.handle[0].style.left=""+this.pos+"px",this.v_col.text(this.state.val.toFixed(2))},t.prototype.state_changed=function(t){t&&this.updateUi()},t.prototype.updateUi=function(){if(this.ui){var t=this.ui;this.update_value(this.state.val),t.find(".lo").val(this.state.min),t.find(".hi").val(this.state.max);var e=Math.min(this.state.min,this.state.max),a=(this.state.val-e)/Math.abs(this.state.max-this.state.min);this.state.min>this.state.max&&(a=1-a),this.pos=60*a,this.handle[0].style.left=""+this.pos+"px"}}}();
E2.p=E2.plugins.sphere_mesh_generator=function(e){this.desc="Create a sphere mesh of unit size with normals and one set of UV-cordinates. Vertical and horizontal resolution is customizable.",this.input_slots=[{name:"v res",dt:e.datatypes.FLOAT,desc:"Vertical resolution.",lo:3,hi:250,def:15},{name:"h res",dt:e.datatypes.FLOAT,desc:"Horizontal resolution.",lo:3,hi:250,def:15}],this.output_slots=[{name:"mesh",dt:e.datatypes.MESH,desc:"Sphere mesh."}],this.state={v_res:15,h_res:15},this.gl=e.renderer.context,this.mesh=null},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_input=function(e,t){var s=Math.floor(t);3>s||(s=s>250?250:s,0===e.index&&this.state.v_res!==s?(this.state.v_res=s,this.dirty=!0):1===e.index&&this.state.h_res!==s&&(this.state.h_res=s,this.dirty=!0))},E2.p.prototype.update_state=function(){this.dirty&&this.generate_mesh()},E2.p.prototype.update_output=function(){return this.mesh},E2.p.prototype.generate_mesh=function(){var e=this.gl;msg("Sphere: Generating mesh."),this.mesh=new Mesh(e,e.TRIANGLES,null);for(var t=[],s=[],h=[],r=[],i=Math.PI/this.state.v_res,a=2*Math.PI/this.state.h_res,n=0,p=this.state.v_res,u=this.state.h_res,o=0;p+1>o;o++)for(var d=Math.sin(o*i),f=Math.cos(o*i),_=0;u+1>_;_++){var m=_*a,l=d*Math.sin(m),c=d*Math.cos(m);t.push(l),t.push(f),t.push(c),s.push(l),s.push(f),s.push(c),h.push(_/u),h.push(1-o/p),o!==p&&(r.push(n+u+1),r.push(n),r.push(n+u),r.push(n+u+1),r.push(n+1),r.push(n),n++)}(this.mesh.vertex_buffers.VERTEX=new VertexBuffer(e,VertexBuffer.vertex_type.VERTEX)).bind_data(t),(this.mesh.vertex_buffers.NORMAL=new VertexBuffer(e,VertexBuffer.vertex_type.NORMAL)).bind_data(s),(this.mesh.vertex_buffers.UV0=new VertexBuffer(e,VertexBuffer.vertex_type.UV0)).bind_data(h),(this.mesh.index_buffer=new IndexBuffer(e)).bind_data(r),this.mesh.generate_shader(),this.dirty=!1},E2.p.prototype.state_changed=function(e){e||this.generate_mesh()};
E2.p=E2.plugins.sqrt_modulator=function(t){this.desc="Sqrt(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"sqrt(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.value=Math.sqrt(e))},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.square_modulator=function(t){this.desc="Square oscilator. A <b>time</b> value incrementing by one unit per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits 1 if <b>time</b> % 1 is less than 0.5 and -1 otherwise.",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=this.time%1<.5?1:-1},E2.p.prototype.update_output=function(){return this.result};
E2.p=E2.plugins.stop_emitter=function(t){this.desc="Stops graph playback when a true value is received by the <b>bool</b> slot.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"When true is received by this slot, graph playback is stopped."}],this.output_slots=[],this.core=t,this.stop_seq=!1},E2.p.prototype.reset=function(){this.stop_seq=!1},E2.p.prototype.update_input=function(t,s){this.stop_seq=s},E2.p.prototype.update_state=function(){this.stop_seq&&(E2.app.onStopClicked?E2.app.onStopClicked():this.core.player.schedule_stop(),this.stop_seq=!1)};
E2.p=E2.plugins.string_concatenate_modulator=function(t){this.desc="Concatenates the two supplied strings.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The first string.",def:""},{name:"text",dt:t.datatypes.TEXT,desc:"The second string.",def:""}],this.output_slots=[{name:"result",dt:t.datatypes.TEXT,desc:"The string representing the combination of <b>first</b> + <b>second</b>."}]},E2.p.prototype.reset=function(){this.text_a="",this.text_b="",this.output_val=""},E2.p.prototype.update_input=function(t,e){0===t.index?this.text_a=""+e:this.text_b=""+e},E2.p.prototype.update_state=function(){this.output_val=this.text_a+this.text_b},E2.p.prototype.update_output=function(){return this.output_val};
E2.p=E2.plugins.subtract_modulator=function(t){this.desc="Subtract the second value from the first and emit the result.",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"The first operand.",def:0},{name:"value",dt:t.datatypes.FLOAT,desc:"The second operand.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"The result of <b>first</b> - <b>second</b>.",def:0}]},E2.p.prototype.reset=function(){this.input_val=0,this.sub_val=0,this.output_val=0},E2.p.prototype.update_input=function(t,e){0===t.index?this.input_val=e:this.sub_val=e},E2.p.prototype.update_state=function(){this.output_val=this.input_val-this.sub_val},E2.p.prototype.update_output=function(){return this.output_val};
!function(){var t=E2.plugins.switch_modulator=function(t,e){var n=this;this.desc="Given an <b>index</b>, emit the supplied <b>true</b> value on the output slot matching the index and the <b>false</b> value on all others. If the index is invalid, the <b>false</b> value is emitted on all outputs.",this.input_slots=[{name:"index",dt:t.datatypes.FLOAT,desc:"The selected index.",def:-1},{name:"true",dt:t.datatypes.ANY,desc:"The value to emit on the output slot matching the current index.",def:null},{name:"false",dt:t.datatypes.ANY,desc:"The value to emit on any slot not matching the current index",def:null}],this.output_slots=[],this.state={},this.core=t,this.node=e,this.lsg=new LinkedSlotGroup(t,e,[this.input_slots[1],this.input_slots[2]],[]),this.true_value=null,this.false_value=null,this.node.on("slotAdded",function(){n.updated=!0}),this.node.on("slotRemoved",function(){n.updated=!0})};t.prototype.create_ui=function(){var t=this,e=make("div"),n=makeButton("Remove","Click to remove the last output."),i=makeButton("Add","Click to add another output.");return n.css("width","65px"),i.css({width:"65px","margin-top":"5px"}),i.click(function(){E2.app.graphApi.addSlot(t.node.parent_graph,t.node,{type:E2.slot_type.output,name:t.dynOutputs.length+"",dt:t.core.datatypes.OBJECT})}),n.click(function(){var e=t.dynOutputs;if(e){var n=e[e.length-1].uid;E2.app.graphApi.removeSlot(t.node.parent_graph,t.node,n)}}),e.append(n),e.append(make("br")),e.append(i),e},t.prototype.reset=function(){this.index=-1},t.prototype.connection_changed=function(t,e,n){this.lsg.connection_changed(t,e,n)&&(this.true_value=this.false_value=this.lsg.core.get_default_value(this.lsg.dt))},t.prototype.update_input=function(t,e){0===t.index?this.index=Math.floor(e):1===t.index?this.true_value=e:this.false_value=e},t.prototype.update_output=function(t){return t.index===this.index?this.true_value:this.false_value},t.prototype.state_changed=function(t){if(!t){for(var e=this.dynOutputs=this.node.getDynamicOutputSlots(),n=0,i=e.length;i>n;n++)this.lsg.add_dyn_slot(this.node.find_dynamic_slot(E2.slot_type.output,e[n].uid));this.index=-1,this.true_value=this.false_value=this.lsg.infer_dt()}}}();
E2.p=E2.plugins.tan_modulator=function(t){this.desc="Tan(x).",this.input_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Input value.",def:0}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"tan(<b>value</b>).",def:0}]},E2.p.prototype.reset=function(){this.value=0},E2.p.prototype.update_input=function(t,e){this.value=Math.tan(e)},E2.p.prototype.update_output=function(){return this.value};
E2.p=E2.plugins.text_display=function(t){this.desc="Display the supplied text value on the plugin surface.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"Input text to be displayed.",def:""}],this.output_slots=[]},E2.p.prototype.reset=function(){this.update_value(null)},E2.p.prototype.create_ui=function(){return this.label=make("div"),this.label},E2.p.prototype.connection_changed=function(t){t||this.update_value("")},E2.p.prototype.update_input=function(t,e){this.update_value(e)},E2.p.prototype.update_value=function(t){this.label&&(this.label[0].innerHTML=t)};
!function(){var t=E2.plugins.text_editor_generator=function(t){Plugin.apply(this,arguments),this.desc="Edit a block of text.",this.input_slots=[],this.output_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The currently entered text.",def:"Empty string"}],this.state={text:"{\n\n}"},this.core=t};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.updated=!0},t.prototype.open_editor=function(t){return function(){var e=make("span"),o=$('<pre id="editor"></pre>');e.css({margin:"0px",padding:"2px"}),o.css({margin:"0px",padding:"0px","margin-top":"2px",border:"1px solid #bbb",width:"755px",height:"400px",resize:"none","font-size":"12px","font-family":"Monospace",scroll:"none"}),e.append(o);var n=ace.edit(o[0]);n.setTheme("ace/theme/chrome"),n.getSession().setUseWrapMode(!1),n.setBehavioursEnabled(!1),n.setShowPrintMargin(!1),n.getSession().setMode("ace/mode/json"),n.setValue(t.state.text),n.gotoLine(2),n.session.selection.clearSelection();var i=function(e){return function(o){return o&&"ace_text-input"===o.target.className?!1:void t.undoableSetState("text",e.getValue(),t.state.text)}};t.core.create_dialog(e,"Editor",760,150,i(n,e))}},t.prototype.create_ui=function(){var t=makeButton("Open","Click to edit the contents.");return t.css("width","55px"),t.click(this.open_editor(this)),t},t.prototype.update_output=function(){return this.state.text},t.prototype.state_changed=function(t){t||this.core.add_aux_script("ace/ace.js")}}();
E2.p=E2.plugins.texture_diffuse_shader=function(t){this.desc="Simple shader for rendering meshes with one texture modulated by a diffuse color.",this.input_slots=[{name:"material",dt:t.datatypes.MATERIAL,desc:"The surface material.",def:null},{name:"uv offset",dt:t.datatypes.VECTOR,desc:"UV translation. Only the x and y components are used with the z axis disregarded.",def:[0,0]},{name:"uv scale",dt:t.datatypes.VECTOR,desc:"UV scale. Only the x and y components are used with the z axis factor disregarded.",def:[1,1]},{name:"uv rotation",dt:t.datatypes.FLOAT,desc:"UV rotation in degrees.",def:0}],this.output_slots=[{name:"shader",dt:t.datatypes.SHADER,desc:"The resulting shader."}];var e="attribute vec3 v_pos;attribute vec2 v_uv0;varying vec2 f_uv0;uniform mat4 m_mat;uniform mat4 v_mat;uniform mat4 p_mat;uniform vec2 uv_offset;uniform vec2 uv_scale;uniform float uv_rotation;void main(void) {    gl_Position = p_mat * v_mat * m_mat * vec4(v_pos, 1.0);    float cs = cos(uv_rotation);    float sn = sin(uv_rotation);    f_uv0 = vec2((((v_uv0.x * cs) - (v_uv0.y * sn)) * uv_scale.x) + uv_offset.x, (((v_uv0.x * sn) + (v_uv0.y * cs)) * uv_scale.y) + uv_offset.y);}",i="precision mediump float;varying vec2 f_uv0;uniform sampler2D tex0;uniform vec4 a_col;uniform vec4 d_col;uniform int e2_alpha_clip;void main(void) { vec4 c = texture2D(tex0, f_uv0.st); c *= d_col; c.rgb += a_col.rgb; if(e2_alpha_clip > 0 && c.a < 0.5) discard; gl_FragColor = vec4(c); }",a=this.gl=t.renderer.context;this.def_ambient=vec4.createFrom(0,0,0,1),this.def_diffuse=vec4.createFrom(1,1,1,1),this.s=new ShaderProgram(a),this.vs=new Shader(a,a.VERTEX_SHADER,e),this.ps=new Shader(a,a.FRAGMENT_SHADER,i);var o=this.s.program;this.s.attach(this.vs),this.s.attach(this.ps),this.s.link(),this.s.v_pos=a.getAttribLocation(o,"v_pos"),this.s.v_uv0=a.getAttribLocation(o,"v_uv0"),this.s.m_mat=a.getUniformLocation(o,"m_mat"),this.s.v_mat=a.getUniformLocation(o,"v_mat"),this.s.p_mat=a.getUniformLocation(o,"p_mat"),this.s.a_col=a.getUniformLocation(o,"a_col"),this.s.d_col=a.getUniformLocation(o,"d_col"),this.s.tex0=a.getUniformLocation(o,"tex0"),this.s.uv_offset=a.getUniformLocation(o,"uv_offset"),this.s.uv_scale=a.getUniformLocation(o,"uv_scale"),this.s.uv_rotation=a.getUniformLocation(o,"uv_rotation"),this.s.e2_alpha_clip=a.getUniformLocation(o,"e2_alpha_clip"),this.s.bind_array=function(t,e){return function(t,i,a){var o=VertexBuffer.vertex_type,s=null;if(t===o.VERTEX)s=this.v_pos;else{if(t!==o.UV0)return;s=this.v_uv0}e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(s),e.vertexAttribPointer(s,a,e.FLOAT,!1,0,0)}}(this.s,a),this.s.apply_uniforms=function(t,e){return function(i){var a=t.material?t.material:i.material;e.uniform4fv(t.s.a_col,a.ambient_color?a.ambient_color:this.def_ambient),e.uniform4fv(t.s.d_col,a.diffuse_color?a.diffuse_color:this.def_diffuse),e.enableVertexAttribArray(t.s.v_pos),e.enableVertexAttribArray(t.s.v_uv0),e.uniform2fv(t.s.uv_offset,t.uv_offset),e.uniform2fv(t.s.uv_scale,t.uv_scale),e.uniform1f(t.s.uv_rotation,t.uv_rotation),e.uniform1i(t.s.e2_alpha_clip,a.alpha_clip?1:0);var o=!1;if(t.material){var s=t.material.textures[Material.texture_type.DIFFUSE_COLOR];s&&(e.uniform1i(t.s.tex0Uniform,0),s.enable(e.TEXTURE0),o=!0)}if(!o){var s=i.material.textures[Material.texture_type.DIFFUSE_COLOR];s?(e.uniform1i(this.tex0Uniform,0),s.enable(e.TEXTURE0)):e.bindTexture(e.TEXTURE_2D,null)}a.enable()}}(this,a)},E2.p.prototype.update_input=function(t,e){0===t.index?this.material=e:1===t.index?this.uv_offset=vec2.createFrom(e[0],e[1]):2===t.index?this.uv_scale=vec2.createFrom(e[0],e[1]):3===t.index&&(this.uv_rotation=e%360/180*Math.PI)},E2.p.prototype.update_output=function(){return this.s},E2.p.prototype.state_changed=function(t){t||(this.material=null,this.uv_offset=vec2.createFrom(0,0),this.uv_scale=vec2.createFrom(1,1),this.uv_rotation=0)};
!function(){var t=E2.plugins.texture_filter_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a texture mini- and magnify filter type.",this.input_slots=[],this.output_slots=[{name:"type",dt:t.datatypes.FLOAT,desc:"Emits the selected texture filter type when requested or the selection state changes.",def:"Linear"}],this.gl=t.renderer.context,this.state={type:this.gl.LINEAR}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:this.gl.NEAREST,text:"Nearest"}).appendTo(t),$("<option />",{value:this.gl.LINEAR,text:"Linear"}).appendTo(t),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.update_output=function(){return this.state.type},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
E2.p=E2.plugins.texture_filter_modulator=function(t){this.desc="Sets the rendering primitive type of the supplied mesh.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"Input texture.",def:null},{name:"minify",dt:t.datatypes.FLOAT,desc:"See Generators/Values/Texture filter type.",def:t.renderer.context.LINEAR},{name:"magnify",dt:t.datatypes.FLOAT,desc:"See Generators/Values/Texture filter type.",def:t.renderer.context.LINEAR}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The modified texture."}],this.gl=t.renderer.context},E2.p.prototype.update_input=function(t,e){0===t.index?this.texture=e:1===t.index?this.min_filter=Math.round(e):2===t.index&&(this.mag_filter=Math.round(e))},E2.p.prototype.update_state=function(){this.texture&&(this.texture.min_filter=this.min_filter,this.texture.mag_filter=this.mag_filter)},E2.p.prototype.update_output=function(){return this.texture},E2.p.prototype.state_changed=function(t){t||(this.texture=null,this.min_filter=this.gl.LINEAR,this.mag_filter=this.gl.LINEAR)};
E2.p=E2.plugins.texture_from_text_generator=function(t){this.desc="Create a texture of a (2^n closest to the) given size filled with a rendered version of the supplied text.",this.input_slots=[{name:"text",dt:t.datatypes.TEXT,desc:"The text to be rendered to <b>texture</b>.",def:"Lorem ipsum\nDOLOR SIT AMET"},{name:"width",dt:t.datatypes.FLOAT,desc:"The width of the output <b>texture</b>. Will be rounded to nearest 2^n.",lo:2,hi:1024,def:128},{name:"height",dt:t.datatypes.FLOAT,desc:"The height of the output <b>texture</b>. Will be rounded to nearest 2^n.",lo:2,hi:1024,def:128},{name:"x",dt:t.datatypes.FLOAT,desc:"The x position of the text.",def:10},{name:"y",dt:t.datatypes.FLOAT,desc:"The y position of the text.",def:10},{name:"font style",dt:t.datatypes.TEXT,desc:"The desired font style (CSS standard).",def:"bold 16px arial"},{name:"fill style",dt:t.datatypes.TEXT,desc:"The desired fill style (CSS standard).",def:"#fff"},{name:"stroke style",dt:t.datatypes.TEXT,desc:"The desired stroke style (CSS standard).",def:"none"},{name:"stroke width",dt:t.datatypes.FLOAT,desc:"The desired stroke width in pixels.",def:0},{name:"align",dt:t.datatypes.TEXT,desc:"Text alignment.",def:"center"},{name:"baseline",dt:t.datatypes.TEXT,desc:"Text baseline.",def:"middle"},{name:"line height",dt:t.datatypes.FLOAT,desc:"Line height scalar.",def:1.2}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"Output texture containing the rendered text."}],this.renderer=t.renderer,this.gl=t.renderer.context,this.mesh=null,this.canvas2d=$('<canvas style="display:none" width="128" height="128"></canvas>')[0],this.c2d_ctx=this.canvas2d.getContext("2d")},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.sanitize_size=function(t){var e=Math.log(t)/Math.log(2),i=Math.floor(e);return 1>i?i=1:i>10&&(i=10),Math.pow(2,i)},E2.p.prototype.update_input=function(t,e){0===t.index?this.text=e:1===t.index?this.width=this.sanitize_size(e):2===t.index?this.height=this.sanitize_size(e):3===t.index?this.x=e:4===t.index?this.y=e:5===t.index?this.font_style=e:6===t.index?this.fill_style=e:7===t.index?this.stroke_style=e:8===t.index?this.stroke_width=e:9===t.index?this.align=e:10===t.index?this.baseline=e:11===t.index&&(this.line_height=e)},E2.p.prototype.update_state=function(){var t=this.text.split("\n"),e=this.canvas2d,i=this.c2d_ctx;e.width=this.width,e.height=this.height,i.clearRect(0,0,this.width,this.height),i.fillStyle=this.fill_style,i.lineWidth=this.stroke_width,i.strokeStyle=this.stroke_style,i.font=this.font_style,i.textAlign=this.align,i.textBaseline=this.baseline;for(var s=i.measureText("M").width*this.line_height,d=0,h=t.length;h>d;d++){var n=this.y+d*s,a=t[d];i.strokeText(a,this.x,n),i.fillText(a,this.x,n)}this.texture.upload(e,"Rendered text")},E2.p.prototype.update_output=function(){return this.texture},E2.p.prototype.state_changed=function(t){t||(this.texture=new Texture(this.renderer),this.text="",this.width=128,this.height=128,this.x=10,this.y=10,this.font_style="bold 16px arial",this.fill_style="#fff",this.stroke_style="none",this.stroke_width=0,this.align="center",this.baseline="middle",this.line_height=1.2)};
E2.p=E2.plugins.texture_height_modulator=function(t){this.desc="Emits the supplied texture height.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture to emit the height of.",def:null}],this.output_slots=[{name:"height",dt:t.datatypes.FLOAT,desc:"The supplied texture height."}],this.height=0},E2.p.prototype.reset=function(){this.height=0},E2.p.prototype.update_input=function(t,e){this.height=e?parseInt(e.height,10):0},E2.p.prototype.update_output=function(){return this.height};
!function(){var t=E2.plugins.texture_type_generator=function(t){Plugin.apply(this,arguments),this.desc="Select texture type.",this.input_slots=[],this.output_slots=[{name:"type",dt:t.datatypes.FLOAT,desc:"Emits the selected texture type when requested or the selection state changes.",def:"Diffuse color"}],this.state={type:Material.texture_type.DIFFUSE_COLOR}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=Material.texture_type,e=$("<select />",{selectedIndex:0});return $("<option />",{value:t.DIFFUSE_COLOR,text:"Diffuse color"}).appendTo(e),$("<option />",{value:t.EMISSION_COLOR,text:"Emission color"}).appendTo(e),$("<option />",{value:t.SPECULAR_COLOR,text:"Specular color"}).appendTo(e),$("<option />",{value:t.NORMAL,text:"Normal"}).appendTo(e),e.change(function(t){return function(){t.undoableSetState("type",e.val(),t.state.type)}}(this)),e},t.prototype.update_output=function(){return this.state.type},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
E2.p=E2.plugins.texture_width_modulator=function(t){this.desc="Emits the supplied texture width.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The texture to emit the width of.",def:null}],this.output_slots=[{name:"width",dt:t.datatypes.FLOAT,desc:"The supplied texture width."}],this.width=0},E2.p.prototype.reset=function(){this.width=0},E2.p.prototype.update_input=function(t,e){this.width=e?parseInt(e.width,10):0},E2.p.prototype.update_output=function(){return this.width};
!function(){var t=E2.plugins.texture_wrap_generator=function(t){Plugin.apply(this,arguments),this.desc="Emits a texture UV coordinate wrapping type.",this.input_slots=[],this.output_slots=[{name:"type",dt:t.datatypes.FLOAT,desc:"Emits the selected UV coordinate wrapping type when requested or the selection state changes.",def:"Repeat"}],this.gl=t.renderer.context,this.state={type:this.gl.REPEAT}};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:1});return $("<option />",{value:""+this.gl.CLAMP_TO_EDGE,text:"Clamp"}).appendTo(t),$("<option />",{value:""+this.gl.REPEAT,text:"Repeat"}).appendTo(t),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.update_output=function(){return this.state.type},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
E2.p=E2.plugins.texture_wrap_modulator=function(t){this.desc="Sets the UV-coordinate wrapping type of the supplied texture.",this.input_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"Input texture.",def:null},{name:"wrap s",dt:t.datatypes.FLOAT,desc:"See Generators/Values/Texture wrap type.",def:t.renderer.context.REPEAT},{name:"wrap t",dt:t.datatypes.FLOAT,desc:"See Generators/Values/Texture wrap type.",def:t.renderer.context.REPEAT}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The modified texture."}],this.gl=t.renderer.context},E2.p.prototype.update_input=function(t,e){0===t.index?this.texture=e:1===t.index?this.wrap_s=Math.round(e):2===t.index&&(this.wrap_t=Math.round(e))},E2.p.prototype.update_state=function(){this.texture&&(this.texture.wrap_s=this.wrap_s,this.texture.wrap_t=this.wrap_t)},E2.p.prototype.update_output=function(){return this.texture},E2.p.prototype.state_changed=function(t){t||(this.texture=null,this.wrap_s=this.gl.REPEAT,this.wrap_t=this.gl.REPEAT)};
!function(){var t=E2.plugins.toggle_button=function(t,e){Plugin.apply(this,arguments),this.desc="Toggle button that emits true and false as it is clicked.",this.input_slots=[],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"True or false is emitted on the next update after the buttons has been clicked.",def:"False"}],this.state={enabled:!1},this.core=t,this.node=e};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=this,e=this.ui=makeButton("Off");return e.click(function(){t.undoableSetState("enabled",!t.state.enabled,t.state.enabled)}),this.node.on("pluginStateChanged",this.updateUi.bind(this)),e},t.prototype.update_output=function(){return this.state.enabled},t.prototype.updateUi=function(){if(this.ui){var t=this.ui;t.html(this.state.enabled?"On":"Off"),t.addClass("toggle_btn"),this.state.enabled?t.removeClass("toggle_btn_off"):t.addClass("toggle_btn_off")}},t.prototype.state_changed=function(t){t&&(this.core.add_aux_style("toggle-button/style.css"),this.updateUi())}}();
E2.p=E2.plugins.toggle_modulator=function(t){this.desc="For every continous sequence of 'true' values sent to the 'trigger' input slot the emitted value will switch from true to false and visa versa. The initial value is true.",this.input_slots=[{name:"trigger",dt:t.datatypes.BOOL,desc:"Every time true is sent one or more times in a row, the emitted value will switch between true and false, starting with true.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The current state.",def:!0}],this.state={value:!0}},E2.p.prototype.update_input=function(t,e){e&&(this.triggered=!0,this.state.value=!this.state.value)},E2.p.prototype.update_state=function(){this.triggered||(this.updated=!1),this.triggered=!1},E2.p.prototype.update_output=function(){return this.state.value},E2.p.prototype.state_changed=function(t){t||(this.state.value=!0,this.triggered=!0)};
E2.p=E2.plugins.translation_matrix=function(t){this.desc="Create a matrix that represent a translation.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Translation vector.",def:[0,0,0]}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting translation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,a){var e=this.matrix;e[12]=a[0],e[13]=a[1],e[14]=a[2]},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.translation_xyz_matrix=function(t){this.desc="Create a matrix that tranlates along the X, Y and Z axis.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"Amount to translate along the X-axis.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"Amount to translate along the Y-axis.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"Amount to translate along the Z-axis.",def:0}],this.output_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The resulting translation matrix.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.components=[0,0,0],this.matrix=mat4.create(),mat4.identity(this.matrix)},E2.p.prototype.update_input=function(t,a){this.components[t.index]=a},E2.p.prototype.update_state=function(){var t=this.matrix;mat4.identity(this.matrix),t[12]=this.components[0],t[13]=this.components[1],t[14]=this.components[2]},E2.p.prototype.update_output=function(){return this.matrix};
E2.p=E2.plugins.transpose_matrix_modulator=function(t){this.desc="Emits the transposed version of the supplied <b>matrix</b>.",this.input_slots=[{name:"matrix",dt:t.datatypes.MATRIX,desc:"The input matrix to be transposed.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"transposed",dt:t.datatypes.MATRIX,desc:"Emits the transposed input <b>matrix</b>.",def:t.renderer.matrix_identity}]},E2.p.prototype.reset=function(){this.matrix=mat4.create(),this.transposed=mat4.create(),mat4.identity(this.matrix),mat4.identity(this.transposed)},E2.p.prototype.connection_changed=function(t,e,i){t||i.type!==E2.slot_type.input||(mat4.identity(this.matrix),mat4.identity(this.transposed))},E2.p.prototype.update_input=function(t,e){this.matrix=e},E2.p.prototype.update_state=function(){mat4.transpose(this.matrix,this.transposed)},E2.p.prototype.update_output=function(){return this.transposed};
E2.p=E2.plugins.triangle_modulator=function(t){this.desc="Triangle oscilator. A <b>time</b> value incrementing by one per second will yield a 1Hz output signal.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"The current time in seconds.",def:0}],this.output_slots=[{name:"value",dt:t.datatypes.FLOAT,desc:"Emits ((0.5 - |(<b>time</b> % 1.0) - 0.5|) - 0.25) * 4.",def:0}]},E2.p.prototype.reset=function(){this.time=0,this.result=0},E2.p.prototype.update_input=function(t,e){this.time=e},E2.p.prototype.update_state=function(){this.result=4*(.5-Math.abs(this.time%1-.5)-.25)},E2.p.prototype.update_output=function(){return this.result};
!function(){var t=E2.plugins.tween_in_modulator=function(t){Plugin.apply(this,arguments),this.desc="Perform tween in over time.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time ranging from zero to one.",def:0,lo:0,hi:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits a tween in over <b>time</b>.",def:0}],this.state={type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:0}),e=function(e,a){$("<option />",{value:e,text:a}).appendTo(t)};return e(0,"Circular"),e(1,"Cubic"),e(2,"Exponential"),e(3,"Quadratic"),e(4,"Quartic"),e(5,"Quintic"),e(6,"Sinusoidal"),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.reset=function(){this.result=0,this.time=0},t.prototype.update_input=function(t,e){this.time=0>e?0:e>1?1:e},t.prototype.update_state=function(){var t=0,e=this.time;switch(this.state.type){case 0:t=1-Math.sqrt(1-e*e);break;case 1:t=e*e*e;break;case 2:t=0===e?0:Math.pow(1024,e-1);break;case 3:t=e*e;break;case 4:t=e*e*e*e;break;case 5:t=e*e*e*e*e;break;case 6:t=1-Math.cos(e*Math.PI/2)}this.result=t},t.prototype.update_output=function(){return this.result},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
!function(){var t=E2.plugins.tween_out_modulator=function(t){Plugin.apply(this,arguments),this.desc="Perform tween out over time.",this.input_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Time ranging from zero to one.",def:0,lo:0,hi:1}],this.output_slots=[{name:"result",dt:t.datatypes.FLOAT,desc:"Emits a tween out over <b>time</b>.",def:0}],this.state={type:0}};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){var t=$("<select />",{selectedIndex:0}),e=function(e,a){$("<option />",{value:e,text:a}).appendTo(t)};return e(0,"Circular"),e(1,"Cubic"),e(2,"Exponential"),e(3,"Quadratic"),e(4,"Quartic"),e(5,"Quintic"),e(6,"Sinusoidal"),t.change(function(e){return function(){e.undoableSetState("type",t.val(),e.state.type)}}(this)),t},t.prototype.reset=function(){this.result=0,this.time=0},t.prototype.update_input=function(t,e){this.time=0>e?0:e>1?1:e},t.prototype.update_state=function(){var t=0,e=this.time;switch(this.state.type){case 0:t=Math.sqrt(1- --e*e);break;case 1:t=--e*e*e+1;break;case 2:t=1===e?1:1-Math.pow(2,-10*e);break;case 3:t=e*(2-e);break;case 4:t=1- --e*e*e*e;break;case 5:t=--e*e*e*e*e+1;break;case 6:t=Math.sin(e*Math.PI/2)}this.result=t},t.prototype.update_output=function(){return this.result},t.prototype.state_changed=function(t){t&&t.val(""+this.state.type)}}();
!function(){var t=E2.plugins.url_array_generator=function(t){Plugin.apply(this,arguments),this.desc="Load arbitrary data packed in an PNG from an URL.",this.input_slots=[],this.output_slots=[{name:"array",dt:t.datatypes.ARRAY,desc:"The loaded array."}],this.state={url:""},this.gl=t.renderer.context,this.core=t,this.array=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=a=t,i.updated=!0,i.state_changed()}var e=i.state.url,a=e;FileSelectControl.createTextureSelector(e,function(r){r.template("texture").selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this),Select:t.bind(this)}).on("closed",function(){a!==e&&i.undoableSetState("url",a,e)}).modal()})}var e=makeButton("Source","No texture selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){this.dirty&&(this.img=new Image,this.core.asset_tracker.signal_started(),this.img.onload=function(){var t=document.createElement("canvas"),e=t.getContext("2d");t.width=this.img.width,t.height=this.img.height,e.imageSmoothingEnabled=!1,e.webkitImageSmoothingEnabled=!1,e.globalCompositeOperation="copy",e.drawImage(this.img,0,0);var i=e.getImageData(0,0,this.img.width,this.img.height);this.array=i.data.buffer,this.array.stride=1,this.array.datatype=1,this.updated=!0,msg("INFO: Finished loading data array from "+this.img.src),this.core.asset_tracker.signal_completed()}.bind(this),this.img.onerror=function(){this.core.asset_tracker.signal_failed()}.bind(this),this.img.onabort=function(){this.core.asset_tracker.signal_failed()}.bind(this),this.img.src=this.state.url,this.dirty=!1)},t.prototype.update_output=function(){return this.array},t.prototype.state_changed=function(t){""!==this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
!function(){var t=E2.plugins.url_audio_buffer_generator=function(t){Plugin.apply(this,arguments),this.desc="Load an audio sample from an URL.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"buffer",dt:t.datatypes.OBJECT,desc:"An audio buffer."}],this.state={url:""},this.core=t,this.buffer=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){this.updated=!1},t.prototype.create_ui=function(){var t=makeButton("Source","No audio selected.","url"),e=this;return t.click(function(){FileSelectControl.createAudioSelector(e.state.url).onChange(function(t){e.undoableSetState("url",t,e.state.url)})}),t},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){if(this.dirty){if(this.core.audio_ctx){var t=new XMLHttpRequest;t.open("GET",this.state.url,!0),t.responseType="arraybuffer",this.core.asset_tracker.signal_started(),t.onload=function(e){return function(){e.core.audio_ctx.decodeAudioData(t.response,function(t){return function(e){t.buffer=e,t.updated=!0,t.core.asset_tracker.signal_completed()}}(e),msg)}}(this),t.send()}else msg("ERROR: Cannot create audio buffer. This browser does not support the required API.");this.dirty=!1}},t.prototype.update_output=function(){return this.buffer},t.prototype.state_changed=function(t){""!==this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
!function(){var t=E2.plugins.url_audio_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a sample from an URL. Each sample should be encoded as .wav, .mp3, .mp4 and .ogg, and no extension should be specified. This plugin will load the appropriate filetype for the current execution environment. Hover over the Source button to see the url of the current file.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"audio",dt:t.datatypes.AUDIO,desc:"An audio stream."}],this.state={url:""},this.core=t,this.audio=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=o=t,i.updated=!0,i.state_changed()}var e=i.state.url,o=e;FileSelectControl.createModelSelector("audio",e,function(s){s.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this),Select:t.bind(this)}).on("closed",function(){o!==e&&i.undoableSetState("url",o,e)}).modal()})}var e=makeButton("Source","No audio selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){var t=this;if(this.dirty){if("undefined"==typeof Audio)return msg("Audio: This browser does not support the Audio API.");this.audio&&(this.audio.pause(),delete this.audio),this.audio=new Audio,this.audio.loop=!0,this.audio.preload=!0,this.state.url&&(this.audio.addEventListener("error",function(){msg("ERROR: Audio: Failed to load '"+t.state.url+"'."),t.state.url="",t.audio=null}),msg("Audio: Loading "+this.state.url+"."),this.audio.src=this.state.url),this.dirty=!1}},t.prototype.update_output=function(){return this.audio},t.prototype.state_changed=function(t){this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
!function(){var t=E2.plugins.url_json_generator=function(t){Plugin.apply(this,arguments),this.desc="Load JSON as an object from an URL. Hover over the Source button to see the url of the current file.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"object",dt:t.datatypes.OBJECT,desc:"The object if one has been selected."}],this.state={url:""},this.core=t,this.object={},this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){function t(){function t(t){s.state.url=o=t,s.updated=!0,s.state_changed()}var e=s.state.url,o=e;FileSelectControl.createModelSelector("json",e,function(a){a.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this),Select:t.bind(this)}).on("closed",function(){o!==e&&s.undoableSetState("url",o,e)}).modal()})}var e=makeButton("Source","No JSON selected.","url"),s=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url!==e&&(this.state.url=e,this.state_changed())},t.prototype.update_state=function(){if(this.dirty){var t=this;this.object={},this.core.asset_tracker.signal_started(),$.ajax({url:this.state.url,dataType:"json",success:function(t){return function(e){t.object=e,t.core.asset_tracker.signal_completed(),t.updated=!0}}(t),error:function(t){return function(e,s,o){msg('ERROR: Failed to load JSON "'+t.state.url+'": '+s+", "+o),t.state.url="",t.object={},t.core.asset_tracker.signal_failed()}}(t)}),this.dirty=!1}},t.prototype.update_output=function(){return this.object},t.prototype.state_changed=function(t){""!==this.state.url?(t&&t.attr("title",this.state.url),this.dirty=!0):this.object={}}}();
!function(){var t=E2.plugins.url_scene_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a scene from an URL. Hover over the Change button to see the url of the current file.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"scene",dt:t.datatypes.SCENE,desc:"The loaded scene if one has been selected."}],this.state={url:""},this.core=t,this.scene=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){var t=makeButton("Change","No scene selected.","url"),e=this;return t.click(function(){var n,s=e.state.url;FileSelectControl.createSceneSelector(e.state.url).onChange(function(s){n=e.state.url=s,e.state_changed(null),e.state_changed(t),e.updated=!0}).on("closed",function(){n!==s&&e.undoableSetState("url",n,s)})}),t},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){if(this.dirty){this.scene&&delete this.scene;var t=this;this.scene=Scene.load(this.core.renderer.context,this.state.url,this.core,function(){t.updated=!0}),this.dirty=!1}},t.prototype.update_output=function(){return this.scene},t.prototype.state_changed=function(t){""!==this.state.url&&(t?t.attr("title",this.state.url):this.dirty=!0)}}();
!function(){var t=E2.plugins.url_texture_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a texture from a URL. JPEG and PNG supported. Hover over the Browse button to select an existing image from the library.",this.input_slots=[],this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"URL to fetch image from. The image width and height must be in powers of two, for example 256x512.",def:""}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The loaded texture."}],this.state={url:""},this.gl=t.renderer.context,this.texture=null,this.dirty=!1,this.thumbnail=null};t.prototype=Object.create(Plugin.prototype),t.prototype.create_ui=function(){function t(){function t(t){n.state.url=i=t,n.updated=!0,n.state_changed()}var e=n.state.url,i=e;FileSelectControl.createTextureSelector(e,function(r){r.template("texture").selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this),Select:t.bind(this)}).on("closed",function(){i!==e&&n.undoableSetState("url",i,e)}).modal()})}var e=make("div"),i=makeButton("Browse","No texture selected.","url"),n=this;return this.thumbnail=make("div"),this.thumbnail.css({width:"71px",height:"71px","z-index":"3003",border:"2px solid #8e8e8e","border-radius":"5px","background-image":"url('images/no_texture.png')","background-size":"cover","margin-bottom":"3px"}),i.click(t),this.thumbnail.click(t),e.append(this.thumbnail),e.append(i),this.node.on("pluginStateChanged",this.updateUi.bind(this)),e},t.prototype.update_input=function(t,e){this.state.url!==e&&(this.state.url=e,this.state_changed())},t.prototype.update_state=function(){this.dirty&&(this.texture=this.core.renderer.texture_cache.get(this.state.url),this.dirty=!1)},t.prototype.update_output=function(){return this.texture},t.prototype.state_changed=function(){this.state.url&&(this.updateUi(),this.dirty=!0)},t.prototype.updateUi=function(){this.thumbnail&&this.thumbnail.css({"background-image":"url('"+this.state.url+"')"})}}();
!function(){var t=E2.plugins.url_video_generator=function(t){Plugin.apply(this,arguments),this.desc="Load a Ogg/Theora video from an URL.",this.input_slots=[{name:"url",dt:t.datatypes.TEXT,desc:"Use this to load from a URL supplied as a string.",def:""}],this.output_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"An video stream."}],this.state={url:""},this.gl=t.renderer.context,this.core=t,this.URL_VIDEO_ROOT="data/video/",this.video=null,this.dirty=!1};t.prototype=Object.create(Plugin.prototype),t.prototype.reset=function(){},t.prototype.create_ui=function(){function t(){function t(t){i.state.url=o=t,i.updated=!0,i.state_changed()}var e=i.state.url,o=e;FileSelectControl.createModelSelector("video",e,function(s){s.selected(e).onChange(t.bind(this)).buttons({Cancel:t.bind(this),Select:t.bind(this)}).on("closed",function(){o!==e&&i.undoableSetState("url",o,e)}).modal()})}var e=makeButton("Source","No video selected.","url"),i=this;return e.click(t),e},t.prototype.update_input=function(t,e){this.state.url=e,this.state_changed(null)},t.prototype.update_state=function(){this.dirty&&(null!==this.video&&(this.video.pause(),delete this.video),this.video=document.createElement("video"),this.video.crossOrigin="Anonymous","undefined"!==this.video?(this.video.loop=!0,this.video.preload="auto",this.video.controls=!1,this.video.addEventListener("error",function(t){return function(){msg("ERROR: Video: Failed to load '"+t.state.url+"'."),t.video=null,t.state.url=""}}(this)),msg("Video: Loading "+this.state.url+"."),this.video.src=this.state.url):(msg("Video: This browser does not support the Video API."),this.video=null),this.dirty=!1)},t.prototype.update_output=function(){return this.video},t.prototype.state_changed=function(t){""!==this.state.url&&(t&&t.attr("title",this.state.url),this.dirty=!0)}}();
E2.p=E2.plugins.vector=function(t){this.desc="Create a vector from individual X, Y and Z components.",this.input_slots=[{name:"x",dt:t.datatypes.FLOAT,desc:"The input x-component.",def:0},{name:"y",dt:t.datatypes.FLOAT,desc:"The input y-component.",def:0},{name:"z",dt:t.datatypes.FLOAT,desc:"The input z-component.",def:0}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The resulting vector.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){this.xyz[t.index]=e},E2.p.prototype.update_output=function(){return this.xyz},E2.p.prototype.state_changed=function(t){t||(this.xyz=[0,0,0])};
E2.p=E2.plugins.vector_add=function(t){this.desc="Adds the X, Y and Z components of the supplied vectors and emits the result.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"vector",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Fx + Sx, Fy + Sy, Fz + Sz.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){var t=this.result,e=this.vector_a,o=this.vector_b;t[0]=e[0]+o[0],t[1]=e[1]+o[1],t[2]=e[2]+o[2]},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=[0,0,0],this.vector_b=[0,0,0],this.result=[0,0,0])};
E2.p=E2.plugins.vector_cross=function(t){this.desc="Emits the cross products of the two supplied vectors.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"vector",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits F cross S.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){vec3.cross(this.vector_a,this.vector_b,this.result)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=[0,0,0],this.vector_b=[0,0,0],this.result=[0,0,0])};
E2.p=E2.plugins.vector_display=function(t){this.desc="Displays the supplied vector as a three-cell row of values.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The vector to be displayed.",def:t.renderer.vector_origin}],this.output_slots=[]},E2.p.prototype.reset=function(){this.vec=["-","-","-"],this.update_values()},E2.p.prototype.create_ui=function(){var t=make("table"),e=make("tr"),s={"text-align":"right","padding-left":"10px"};this.columns=[make("td"),make("td"),make("td")];for(var o=0;3>o;o++){var p=this.columns[o];p.text("-"),p.css(s),e.append(p)}return t.append(e),t},E2.p.prototype.connection_changed=function(t){t||this.reset(null)},E2.p.prototype.update_input=function(t,e){for(var s=0;3>s;s++)this.vec[s]=e[s].toFixed(2);this.update_values()},E2.p.prototype.update_values=function(){if(this.columns)for(var t=0;3>t;t++)this.columns[t].text(this.vec[t])};
E2.p=E2.plugins.vector_dot=function(t){this.desc="Emits the dot products of the two supplied vectors.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"vector",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"float",dt:t.datatypes.FLOAT,desc:"Emits F dot S.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){this.result=vec3.dot(this.vector_a,this.vector_b)},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=[0,0,0],this.vector_b=[0,0,0],this.result=0)};
E2.p=E2.plugins.vector_magnitude=function(t){this.desc="Emits the magnitude (length) of the supplied vector.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector to compute the length of.",def:t.renderer.vector_origin}],this.output_slots=[{name:"mag",dt:t.datatypes.FLOAT,desc:"Emits the magnitude of the input vector.",def:0}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.vector=e)},E2.p.prototype.update_state=function(){var t=this.vector[0],e=this.vector[1],o=this.vector[2];this.mag=Math.sqrt(t*t+e*e+o*o)},E2.p.prototype.update_output=function(){return this.mag},E2.p.prototype.state_changed=function(t){t||(this.vector=[0,0,0],this.mag=0)};
E2.p=E2.plugins.vector_multiply=function(t){this.desc="Multiples the X, Y and Z components of the supplied vectors and emits the result.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The first operand.",def:t.renderer.vector_origin},{name:"vector",dt:t.datatypes.VECTOR,desc:"The second operand.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Fx * Sx, Fy * Sy, Fz * Sz.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector_a=e:1===t.index&&(this.vector_b=e)},E2.p.prototype.update_state=function(){var t=this.result,e=this.vector_a,o=this.vector_a;t[0]=e[0]*o[0],t[1]=e[1]*o[1],t[2]=e[2]*o[2]},E2.p.prototype.update_output=function(){return this.result},E2.p.prototype.state_changed=function(t){t||(this.vector_a=[0,0,0],this.vector_b=[0,0,0],this.result=[0,0,0])};
E2.p=E2.plugins.vector_normalize=function(t){this.desc="Emit a normalized version of the supplied vector with a magnitude of 1.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The input vector to be normalised.",def:t.renderer.vector_origin}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the normalised input vector.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index&&(this.vector=e)},E2.p.prototype.update_state=function(){var t=this.vector[0],e=this.vector[1],o=this.vector[2],i=this.normalized,r=Math.sqrt(t*t+e*e+o*o);r?1===r?(i[0]=t,i[1]=e,i[2]=o):(r=1/r,i[0]=t*r,i[1]=e*r,i[2]=o*r):(i[0]=0,i[1]=0,i[2]=0)},E2.p.prototype.update_output=function(){return this.normalized},E2.p.prototype.state_changed=function(t){t||(this.vector=[0,0,0],this.normalized=[0,0,0])};
E2.p=E2.plugins.vector_scale=function(t){this.desc="Scale the X, Y and Z components of the supplied vector by the supplied factor.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"The input vector to be scaled.",def:t.renderer.vector_origin},{name:"scale",dt:t.datatypes.FLOAT,desc:"The scale factor.",def:1}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits Vx * s, Vy *s, Vz * s.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.scale=e)},E2.p.prototype.update_state=function(){var t=this.scale,e=this.scaled,s=this.vector;e[0]=s[0]*t,e[1]=s[1]*t,e[2]=s[2]*t},E2.p.prototype.update_output=function(){return this.scaled},E2.p.prototype.state_changed=function(t){t||(this.vector=[0,0,0],this.scaled=[0,0,0],this.scale=1)};
E2.p=E2.plugins.vector_to_screenspace=function(t){this.desc="Transform a vector from world to screenspace given a specified camera.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector (in worldspace) to transform.",def:t.renderer.vector_origin},{name:"camera",dt:t.datatypes.CAMERA,desc:"Camera to use for transformation.",def:t.renderer.camera_screenspace}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the transformed input vector.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.camera=e)},E2.p.prototype.update_state=function(){var t=mat4.create();mat4.multiply(this.camera.projection,this.camera.view,t),mat4.multiplyVec3(t,this.vector,this.transformed)},E2.p.prototype.update_output=function(){return this.transformed},E2.p.prototype.state_changed=function(t){t||(this.vector=[0,0,0],this.transformed=[0,0,0],this.camera=new Camera)};
E2.p=E2.plugins.vector_transform=function(t){this.desc="Transform a vector by the supplied matrix.",this.input_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Input vector to transform.",def:t.renderer.vector_origin},{name:"matrix",dt:t.datatypes.MATRIX,desc:"Transformation matrix to multiply the vector by.",def:t.renderer.matrix_identity}],this.output_slots=[{name:"vector",dt:t.datatypes.VECTOR,desc:"Emits the transformed input vector.",def:t.renderer.vector_origin}]},E2.p.prototype.update_input=function(t,e){0===t.index?this.vector=e:1===t.index&&(this.matrix=e)},E2.p.prototype.update_state=function(){mat4.multiplyVec3(this.matrix,this.vector,this.transformed)},E2.p.prototype.update_output=function(){return this.transformed},E2.p.prototype.state_changed=function(t){t||(this.vector=[0,0,0],this.transformed=[0,0,0],this.matrix=mat4.create(),mat4.identity(this.matrix))};
E2.p=E2.plugins.video_get_current_time_modulator=function(t){this.desc="Get the current playback time of the supplied video in seconds.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"Input video.",def:null}],this.output_slots=[{name:"time",dt:t.datatypes.FLOAT,desc:"Current playback time.",def:0}]},E2.p.prototype.reset=function(){this.time=0},E2.p.prototype.update_input=function(t,e){this.time=e?e.currentTime:0},E2.p.prototype.update_output=function(){return this.time};
E2.p=E2.plugins.video_get_duration_modulator=function(t){this.desc="Get the duration of the supplied video in seconds.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"Input video.",def:null}],this.output_slots=[{name:"duration",dt:t.datatypes.FLOAT,desc:"Duration in seconds.",def:0}]},E2.p.prototype.reset=function(){this.duration=0},E2.p.prototype.update_input=function(t,o){this.duration=o?o.duration:0},E2.p.prototype.update_output=function(){return this.duration};
E2.p=E2.plugins.video_player=function(t,e){this.desc="Play a video stream. Playback loops by default.",this.input_slots=[{name:"video",dt:t.datatypes.VIDEO,desc:"The video stream to play.",def:null},{name:"play",dt:t.datatypes.BOOL,desc:"Send true to start playback and false to stop.",def:!1},{name:"muted",dt:t.datatypes.BOOL,desc:"Is audio muted?",def:!0},{name:"volume",dt:t.datatypes.FLOAT,desc:"Set playback volume.",lo:0,hi:0,def:.5},{name:"time",dt:t.datatypes.FLOAT,desc:"Set playback time.",def:0}],this.output_slots=[{name:"texture",dt:t.datatypes.TEXTURE,desc:"The current video frame."}],this.core=t,this.node=e,this.video=null,this.playing=!1,this.should_play=!1,this.muted=!0,this.volume=.5,this.time=null,this.texture=null},E2.p.prototype.play=function(){this.video&&!this.playing&&this.should_play&&(this.playing=this.should_play=!0,this.video.play())},E2.p.prototype.pause=function(){this.video&&this.playing&&(this.playing=!1,this.should_play=!0,this.video.pause())},E2.p.prototype.stop=function(){this.video&&(this.playing&&(this.playing=this.should_play=!1,this.video.pause()),this.video.readyState>=2&&(this.video.currentTime=0))},E2.p.prototype.update_input=function(t,e){0===t.index?(this.video=e,this.texture=null,this.playing=!1):1===t.index?this.should_play=e:2===t.index?this.muted=e:3===t.index?this.volume=0>e?0:e>1?1:e:4===t.index&&(this.time=e)},E2.p.prototype.update_state=function(){var t=this.video;!t||t.readyState<2||(this.playing!==this.should_play&&t&&(this.should_play?t.play():t.pause(),this.playing=this.should_play),this.playing&&(t&&(t.videoWidth>0&&t.videoHeight>0&&(this.texture||(this.texture=new Texture(this.core.renderer)),this.texture.upload(t)),t.muted=this.muted,t.volume=this.volume,this.time&&t.readyState>=2&&(t.currentTime=this.time,this.time=null)),this.updated=!0))},E2.p.prototype.update_output=function(){return this.node.queued_update=1,this.texture?this.texture:this.core.renderer.default_tex};
E2.p=E2.plugins.viewport_height_generator=function(e,t){this.desc="Emits current renderer view height.",this.input_slots=[],this.output_slots=[{name:"height",dt:e.datatypes.FLOAT,desc:"The current renderer viewport height."}],this.core=e,this.canvas=e.renderer.canvas[0],this.delegate=this._onResize.bind(this),this.node=t,this.core.renderer.on("resize",this.delegate)},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.renderer.off("resize",this.delegate)},E2.p.prototype.update_output=function(){return this.node.parent_graph.plugin&&this.node.parent_graph.plugin.framebuffer?this.node.parent_graph.plugin.getHeight():this.canvas.height},E2.p.prototype._onResize=function(){this.updated=!0};
E2.p=E2.plugins.viewport_width_generator=function(e,t){this.desc="Emits current renderer view width.",this.input_slots=[],this.output_slots=[{name:"width",dt:e.datatypes.FLOAT,desc:"The current renderer viewport width."}],this.core=e,this.canvas=e.renderer.canvas[0],this.delegate=this._onResize.bind(this),this.core.renderer.on("resize",this.delegate),this.node=t},E2.p.prototype.reset=function(){},E2.p.prototype.destroy=function(){this.core.renderer.off("resize",this.delegate)},E2.p.prototype.update_output=function(){return this.node.parent_graph.plugin&&this.node.parent_graph.plugin.framebuffer?this.node.parent_graph.plugin.getWidth():this.canvas.width},E2.p.prototype._onResize=function(){this.updated=!0};
E2.p=E2.plugins.vr_acceleration_generator=function(e){this.desc="Supplies linear and angular acceleration data from the current VR sensor device.",this.input_slots=[],this.output_slots=[{name:"linear",dt:e.datatypes.VECTOR,desc:"The current linear acceleration of the sensor.",def:[0,0,0]},{name:"angular",dt:e.datatypes.VECTOR,desc:"The current angular acceleration of the sensor.",def:[0,0,0]}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_sensor;if(t){var r=t.getState(),n=null;return n=0===e.index?r.linearAcceleration:r.angularAcceleration,[n.x,n.y,n.z]}return[0,0,0]};
E2.p=E2.plugins.vr_camera_info_generator=function(e){this.desc="Supplies left / right FOV and translation of the current VR device camera.",this.input_slots=[],this.output_slots=[{name:"left FOV",dt:e.datatypes.FLOAT,desc:"Left eye FOV.",def:75},{name:"right FOV",dt:e.datatypes.FLOAT,desc:"Right eye FOV.",def:75},{name:"left offset",dt:e.datatypes.FLOAT,desc:"Left eye translation.",def:0},{name:"right offset",dt:e.datatypes.FLOAT,desc:"Right eye translation.",def:0}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_hmd,r={eyeTranslation:0,recommendedFieldOfView:{leftDegrees:75,rightDegrees:75}},i=r,d=r;return t&&(void 0!==t.getEyeParameters?(i=t.getEyeParameters("left"),d=t.getEyeParameters("right")):(i={eyeTranslation:t.getEyeTranslation("left"),recommendedFieldOfView:t.getRecommendedEyeFieldOfView("left")},d={eyeTranslation:t.getEyeTranslation("right"),recommendedFieldOfView:t.getRecommendedEyeFieldOfView("right")})),0===e.index?i.recommendedFieldOfView.leftDegrees:1===e.index?d.recommendedFieldOfView.rightDegrees:2===e.index?i.eyeTranslation:d.getEyeTranslation};
E2.p=E2.plugins.vr_camera_modulator=function(e){this.desc="Modifies the supplied camera to conform to the current VR HMD.",this.input_slots=[{name:"camera",dt:e.datatypes.CAMERA,desc:"The input camera to modify for VR use."}],this.output_slots=[{name:"left camera",dt:e.datatypes.CAMERA,desc:"The left eye camera."},{name:"right camera",dt:e.datatypes.CAMERA,desc:"The right eye camera."}],this.renderer=e.renderer},E2.p.prototype.update_input=function(e,t){this.camera=t},E2.p.prototype.update_state=function(){var e,t;this.camera_l.view=mat4.create(this.camera.view),this.camera_r.view=mat4.create(this.camera.view);var a=function(e){var t=2/(e.leftTan+e.rightTan),a=(e.leftTan-e.rightTan)*t*.5,r=2/(e.upTan+e.downTan),i=(e.upTan-e.downTan)*r*.5;return{scale:[t,r],offset:[a,i]}},r=function(e,t,r,i){var n=-1,c=a({upTan:Math.tan(t.upDegrees*Math.PI/180),downTan:Math.tan(t.downDegrees*Math.PI/180),leftTan:Math.tan(t.leftDegrees*Math.PI/180),rightTan:Math.tan(t.rightDegrees*Math.PI/180)});e[0]=c.scale[0],e[1]=0,e[2]=c.offset[0]*n,e[3]=0,e[4]=0,e[5]=c.scale[1],e[6]=-c.offset[1]*n,e[7]=0,e[8]=0,e[9]=0,e[10]=i/(r-i)*-n,e[11]=-.02,e[12]=0,e[13]=0,e[14]=n,e[15]=0,mat4.transpose(e)},i=this.renderer.vr_hmd;if(i){void 0!==i.getEyeParameters?(e=i.getEyeParameters("left"),t=i.getEyeParameters("right")):(e={eyeTranslation:i.getEyeTranslation("left"),recommendedFieldOfView:i.getRecommendedEyeFieldOfView("left")},t={eyeTranslation:i.getEyeTranslation("right"),recommendedFieldOfView:i.getRecommendedEyeFieldOfView("right")});var n=e.eyeTranslation,c=vec3.length(vec3.create([n.x,n.y,n.z]));r(this.camera_l.projection,e.recommendedFieldOfView,.01,1e4),r(this.camera_r.projection,t.recommendedFieldOfView,.01,1e4),mat4.translate(this.camera_l.view,vec3.create([-c,0,0])),mat4.translate(this.camera_r.view,vec3.create([c,0,0]))}else this.camera_l.projection=mat4.create(this.camera.projection),this.camera_r.projection=mat4.create(this.camera.projection)},E2.p.prototype.update_output=function(e){return 0===e.index?this.camera_l:this.camera_r},E2.p.prototype.state_changed=function(e){e||(this.camera=new Camera,this.camera_l=new Camera,this.camera_r=new Camera)};
E2.p=E2.plugins.vr_hmd_available_generator=function(e){this.desc="Emits true if a VR Head Mounted Device is available and false otherwise.",this.input_slots=[],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"True if a VR display device is available."}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.renderer.vr_hmd?!0:!1};
E2.p=E2.plugins.vr_hmd_info_generator=function(e){this.desc="Supplies various information about the current VR HMD device.",this.input_slots=[],this.output_slots=[{name:"device name",dt:e.datatypes.TEXT,desc:"The active VR device name.",def:""},{name:"display width",dt:e.datatypes.FLOAT,desc:"The HMD display width in pixels.",def:0},{name:"display height",dt:e.datatypes.FLOAT,desc:"The HMD display height in pixels.",def:0},{name:"render width",dt:e.datatypes.FLOAT,desc:"The HMD render target width in pixels.",def:0},{name:"render height",dt:e.datatypes.FLOAT,desc:"The HMD render target height in pixels.",def:0}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_hmd;return 0===e.index?t?t.deviceName:"":1===e.index?t?t.displaySize.width:0:2===e.index?t?t.displaySize.height:0:3===e.index?t?t.renderTargetSize.width:0:t?t.renderTargetSize.height:0};
E2.p=E2.plugins.vr_sensor_available_generator=function(e){this.desc="Emits true if a VR position sensor is available and false otherwise.",this.input_slots=[],this.output_slots=[{name:"bool",dt:e.datatypes.BOOL,desc:"True if a VR position sensor is available."}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(){return this.renderer.vr_sensor?!0:!1};
E2.p=E2.plugins.vr_sensor_info_generator=function(t){this.desc="Supplies the position and orientation of the current VR HMD.",this.input_slots=[],this.output_slots=[{name:"position",dt:t.datatypes.VECTOR,desc:"The position of the current HMD device."},{name:"orientation",dt:t.datatypes.MATRIX,desc:"The orientation of the current HMD device."}],this.renderer=t.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(t){var e=this.renderer.vr_sensor;if(this.updated=!0,0===t.index){if(e){var r=e.getState();if(!r.position)return[0,0,0];var i=r.position;return[i.x,i.y,i.z]}return[0,0,0]}if(e){var r=e.getState();if(!r.orientation){var n=mat4.create();return mat4.identity(n),n}var o=r.orientation;return quat4.toMat4(quat4.createFrom(o.x,o.y,o.z,o.w))}var n=mat4.create();return mat4.identity(n),n};
E2.p=E2.plugins.vr_velocity_generator=function(e){this.desc="Supplies linear and angular velocity data from the current VR sensor device.",this.input_slots=[],this.output_slots=[{name:"linear",dt:e.datatypes.VECTOR,desc:"The current linear velocity of the sensor.",def:[0,0,0]},{name:"angular",dt:e.datatypes.VECTOR,desc:"The current angular velocity of the sensor.",def:[0,0,0]}],this.renderer=e.renderer},E2.p.prototype.reset=function(){this.updated=!0},E2.p.prototype.update_output=function(e){var t=this.renderer.vr_sensor;if(t){var r=t.getState(),n=null;return n=0===e.index?r.linearVelocity:r.angularVelocity,[n.x,n.y,n.z]}return[0,0,0]};
E2.p=E2.plugins.wschannel_receive=function(e){this.desc="Emits all messages received via a Web Socket PubSub Channel sent by other peers in that channel.",this.input_slots=[{name:"channelName",dt:e.datatypes.TEXT,desc:"Channel name"}],this.output_slots=[{name:"message",dt:e.datatypes.OBJECT,desc:"Messages received"}],e.add_aux_script("wschannel/wschannel.js")},E2.p.prototype.update_input=function(e,n){var t=this;wsChannel.off(this._channelName),this._channelName=n,wsChannel.join(this._channelName),wsChannel.on(this._channelName,function(e){t.updated=!0,t._message=e})},E2.p.prototype.reset=function(){this._message=null},E2.p.prototype.update_output=function(){return this._message};
E2.p=E2.plugins.wschannel_send=function(e){this.desc="Sends messages to Web Socket PubSub Channel for other peers in the channel to receive.",this.input_slots=[{name:"channelName",dt:e.datatypes.TEXT,desc:"Channel name"},{name:"message",dt:e.datatypes.OBJECT,desc:"Message to send"}],this.output_slots=[],e.add_aux_script("wschannel/wschannel.js")},E2.p.prototype.update_input=function(e,n){switch(e.index){case 0:this._channelName=n,wsChannel.join(this._channelName);break;case 1:this._channelName&&wsChannel.send(this._channelName,n)}},E2.p.prototype.reset=function(){this._channelName=null};
E2.p=E2.plugins.xor_modulator=function(t){this.desc="Emits true when the values of the two inputs are different and false when they're identical.",this.input_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"The first operand.",def:!1},{name:"bool",dt:t.datatypes.BOOL,desc:"The second operand.",def:!1}],this.output_slots=[{name:"bool",dt:t.datatypes.BOOL,desc:"Emits true if <b>first</b> does not equal <b>second</b> and false otherwise.",def:!1}]},E2.p.prototype.reset=function(){this.conds=[!1,!1],this.state=!1},E2.p.prototype.update_input=function(t,e){this.conds[t.index]=e},E2.p.prototype.update_state=function(){this.state=this.conds[0]?!this.conds[1]:this.conds[1]},E2.p.prototype.update_output=function(){return this.state};
function Player(){var e=this;this.state={STOPPED:0,PLAYING:1,PAUSED:2},this.app=E2.app,this.core=E2.core,this.interval=null,this.abs_time=0,this.last_time=(new Date).getTime(),this.current_state=this.state.STOPPED,this.frames=0,this.scheduled_stop=null,this.core.active_graph=this.core.root_graph=new Graph(this.core,null,"root"),this.core.graphs.push(this.core.root_graph),E2.core.on("ready",function(){e.select_active_graph()})}function CreatePlayer(e,t){$(document).ajaxError(function(e,t,r,a){if("string"==typeof a)return void console.log(a);var s="ERROR: Script exception:\n";a.fileName&&(s+="	Filename: "+a.fileName),a.lineNumber&&(s+="	Line number: "+a.lineNumber),a.message&&(s+="	Message: "+a.message),console.log(s)}),new Core(e),E2.dom.webgl_canvas=$("#webgl-canvas"),E2.app={},E2.app.player=new Player(e,E2.dom.webgl_canvas,null),E2.core.on("ready",t)}Player.prototype.play=function(){this.current_state!==this.state.PLAYING&&(this.core.root_graph.play(),this.current_state=this.state.PLAYING,this.last_time=(new Date).getTime(),this.interval=requestAnimFrame(this.on_anim_frame.bind(this)))},Player.prototype.pause=function(){this.current_state=this.state.PAUSED,null!==this.interval&&(cancelAnimFrame(this.interval),this.interval=null),this.core.root_graph.pause()},Player.prototype.schedule_stop=function(e){this.scheduled_stop=e},Player.prototype.stop=function(){null!==this.interval&&(cancelAnimFrame(this.interval),this.interval=null),this.core.root_graph.stop(),this.abs_time=0,this.frames=0,this.current_state=this.state.STOPPED,this.core.abs_t=0,this.core.root_graph.reset(),this.core.renderer.begin_frame(),this.core.renderer.end_frame(),E2.app&&E2.app.updateCanvas&&E2.app.updateCanvas(!1)},Player.prototype.on_anim_frame=function(){this.interval=requestAnimFrame(this.on_anim_frame.bind(this)),this.on_update()},Player.prototype.on_update=function(){if(this.scheduled_stop)return this.stop(),this.scheduled_stop(),void(this.scheduled_stop=null);var e=(new Date).getTime(),t=.001*(e-this.last_time);this.core.update(this.abs_time,t)&&E2.app.updateCanvas&&E2.app.updateCanvas(!1),this.last_time=e,this.abs_time+=t,this.frames++},Player.prototype.select_active_graph=function(){E2.app&&E2.app.onGraphSelected&&E2.app.onGraphSelected(this.core.active_graph)},Player.prototype.load_from_json=function(e,t){this.load_from_object(JSON.parse(e),t)},Player.prototype.load_from_object=function(e,t){var r=this.core;r.renderer.texture_cache.clear(),r.renderer.shader_cache.clear(),r.deserialiseObject(e),t&&t()},Player.prototype.load_from_url=function(e,t){var r=this;$.ajax({url:e,dataType:"text",headers:{},success:function(e){r.load_from_json(e,t)}})},Player.prototype.set_parameter=function(e,t){this.core.root_graph.registers.write(e,t)},Player.prototype.add_parameter_listener=function(e,t){var r={register_dt_changed:function(){},register_updated:function(e){return function(t){e(t)}}(t)};return this.core.root_graph.registers.lock(r,e),r},Player.prototype.remove_parameter_listener=function(e,t){this.core.registers.unlock(t,e)};
function play(){E2.app.player.play()}function load(){$("#fs").click(function(){E2.app.player.core.renderer.set_fullscreen(!0)});var e=$("canvas[data-graph-url]"),r=e.data("graph-url"),a=e.data("autoplay");E2.app.player.core.asset_tracker.add_listener(progress),E2.app.player.load_from_url(r),a&&play(),$(window).trigger("vizorLoaded")}function findVrDevices(e){var r=null,a=null;e.some(function(e){return e instanceof HMDVRDevice?(r=e,!0):void 0}),r&&e.some(function(e){return e instanceof PositionSensorVRDevice&&e.hardwareUnitId===r.hardwareUnitId?(a=e,!0):void 0}),CreatePlayer([r,a],load)}function progress(){var e=E2.app.player.core.asset_tracker,r=$(".progress-bar"),a=Math.floor((e.failed+e.completed)/e.started*100);$(".progress").show(),100===a&&$(".progress").hide(),r.css("width",a+"%")}$(document).ready(function(){navigator.getVRDevices?navigator.getVRDevices().then(findVrDevices):navigator.mozGetVRDevices?navigator.mozGetVRDevices(findVrDevices):CreatePlayer([null,null],load)});